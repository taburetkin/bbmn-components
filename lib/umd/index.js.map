{"version":3,"file":"index.js","sources":["process/helpers.js","process/register.js","process/process.js","process/startable-mixin.js","app/index.js","model-schemas/schema.js","model-schemas/property-schema.js","model-schemas/model-schema.js","class-store/index.js","model-schemas/store.js","model-schemas/model-mixin.js","views/views.js","views/atom-text.js","views/text-view.js","validator/rules.js","validator/validate.js","validator/index.js","user/index.js","bearer-token/index.js","view-stack/index.js","store/fake.js","store/store.js","store/index.js","notifier/model.js","notifier/notifies.js","notifier/notify.js","notifier/notify-view.js","notifier/notifier.js","notifier/sync-with-notify-mixin.js","actions/action.js","actions/store.js","actions/actionable-mixin.js","actions/index.js","modals/views.js","modals/config.js","modals/index.js","selector/init-selector-mixin.js","selector/index.js"],"sourcesContent":["import _ from 'underscore';\r\n\r\nexport function isPromisable(arg){\r\n\treturn arg instanceof Promise || _.isFunction(arg && arg.then);\r\n}\r\n\r\nexport function asArray(arg) {\r\n\tif(_.isArray(arg))\r\n\t\treturn arg;\r\n\telse if(arg == null || arg === '')\r\n\t\treturn [];\r\n\telse\r\n\t\treturn [arg];\r\n}\r\n\r\nexport function race(...promises){\r\n\treturn Promise.race(promises);\r\n}\r\n\r\nexport function valueToPromise(arg){\r\n\tif(!isPromisable(arg)) {\r\n\t\tlet result = arg;\r\n\t\targ = arg == null || arg === '' ? Promise.resolve() : Promise.reject(result);\r\n\t}\r\n\treturn arg;\t\t\r\n}\r\n","import _ from 'underscore';\r\nexport default function registerProcess (Process, context, name, opts) {\r\n\r\n\tcontext[name] = function(...args){\r\n\t\t\r\n\t\tlet process = new Process(context, name, _.extend({}, opts));\r\n\t\tlet concurrent = process.concurrencyCheck();\r\n\r\n\t\tif (concurrent)\r\n\t\t\treturn concurrent;\r\n\t\telse\r\n\t\t\treturn process.run(...args);\r\n\r\n\t};\r\n\r\n}\r\n","import _ from 'underscore';\r\nimport { triggerMethodOn, camelCase, betterResult } from 'bbmn-utils';\r\nimport { isPromisable, race, asArray, valueToPromise } from './helpers.js';\r\nimport { BaseClass } from 'bbmn-core';\r\n\r\nimport register from './register.js';\r\n\r\n\r\nconst Process = BaseClass.extend({\r\n\tconstructor(context, name, opts){\r\n\t\t\r\n\t\tBaseClass.apply(this, arguments);\r\n\r\n\t\tthis._initDefaults(name, context);\r\n\t\tthis._initCancelation();\r\n\t\tthis._mergeOptions(opts);\r\n\t},\r\n\r\n\r\n\t// initialize methods\r\n\r\n\t_initDefaults(name, context){\r\n\t\tif(name == null || name === '')\r\n\t\t\tthrow new Error('Process requires two arguments: name [string], context [object]. name missing');\r\n\t\t\r\n\t\tif(!_.isObject(context))\r\n\t\t\tthrow new Error('Process requires two arguments: name [string], context [object]. context is not an object');\r\n\r\n\t\tthis.cid = _.uniqueId('process');\r\n\t\tthis.name = name;\r\n\t\tthis.context = context;\r\n\t\tthis.errors = [];\r\n\t},\r\n\r\n\t_initCancelation(){\r\n\t\tthis.cancelPromise = new Promise((resolve, reject) => {\r\n\t\t\tthis.cancel = () => reject('cancel'); \r\n\t\t});\r\n\t},\r\n\t_mergeOptions(opts = {}){\r\n\t\tlet options = _.omit(opts, 'cid', 'name', 'context', 'cancelPromise', 'cancel', 'errors');\r\n\t\t_(options).each((value, key) => this[key] = value);\r\n\t\tif (this.exposeSelf == null) {\r\n\t\t\tthis.exposeSelf = true;\r\n\t\t}\r\n\t},\r\n\r\n\t\r\n\tconcurrencyCheck(){\r\n\r\n\t\tlet previous = this.getProcessFromContext();\r\n\t\t//console.log(previous, this.context);\r\n\t\tif(!previous) return;\r\n\t\r\n\t\tlet concurrent = this.concurrent;\t\r\n\t\t\r\n\t\tif (concurrent === false) {\r\n\t\r\n\t\t\tthis.cancel();\r\n\t\r\n\t\t} else if (concurrent == 'first') {\r\n\t\r\n\t\t\treturn previous.promise;\r\n\t\r\n\t\t} else if (concurrent == 'last') {\r\n\t\r\n\t\t\tprevious.cancel();\r\n\t\r\n\t\t}\t\t\r\n\t},\r\n\r\n\r\n\t// life cycle methods\t\r\n\r\n\trun(...args){\r\n\t\tthis.updateProcessInContext(this);\r\n\t\tthis.args = args || [];\r\n\t\tthis.promise = this._createLifeCyclePromise();\r\n\t\treturn this.promise;\r\n\t},\r\n\r\n\r\n\t_createLifeCyclePromise(){\r\n\r\n\r\n\t\treturn this._notCanceled()\r\n\t\t\t.then(() => this._begin())\r\n\t\t\t.then(() => this._beforeStart())\r\n\t\t\t.then(() => this._canBeStarted())\r\n\t\t\t.then(() => this._waitOtherPromises())\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis.triggerComplete();\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t})\r\n\t\t\t.catch(error => {\r\n\t\t\t\tthis.triggerError(error);\r\n\t\t\t\tlet jsError;\r\n\t\t\t\tif(error instanceof Error) {\r\n\t\t\t\t\tthrow error;\r\n\t\t\t\t} else if ((jsError = this.getJsError())) {\r\n\t\t\t\t\tthrow jsError;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Promise.reject(this);\r\n\t\t\t\t}\r\n\t\t\t});\t\t\r\n\t},\r\n\r\n\r\n\r\n\r\n\t_notCanceled() {\r\n\t\treturn this._cancelationRace(Promise.resolve());\r\n\t},\r\n\t_begin(){\r\n\t\treturn this._getHookResultAsPromise('begin');\r\n\t},\r\n\t_beforeStart(){\r\n\t\treturn this._getHookResultAsPromise('before');\r\n\t},\r\n\t_canBeStarted(){\r\n\t\tlet contextMethod = 'can:not:' + this.name;\r\n\t\tlet promise = this.invokeOnContext(contextMethod);\r\n\t\tif(!isPromisable(promise)) {\r\n\t\t\tpromise = (promise == null || promise === '') \r\n\t\t\t\t? Promise.resolve()\r\n\t\t\t\t: Promise.reject(promise);\r\n\t\t}\r\n\t\treturn this._cancelationRace(promise);\r\n\t},\r\n\t_waitOtherPromises(){\r\n\t\tlet contextMethod = `get:${this.name}:promises`;\r\n\t\t\r\n\t\tlet promises = asArray(this.invokeOnContext(contextMethod));\r\n\r\n\t\treturn this._cancelationRace(Promise.all(promises));\r\n\t},\r\n\r\n\t_getHookResultAsPromise(hookName){\r\n\t\tlet procMethod = camelCase('on:' + hookName);\r\n\t\tlet procHook = _.isFunction(this[procMethod]) && this[procMethod](this.context, ...this.args) || undefined;\r\n\t\tlet result = valueToPromise(procHook).then(() => {\r\n\t\t\tlet cntxHook = this.triggerOnContext(hookName);\r\n\t\t\treturn valueToPromise(cntxHook);\r\n\t\t});\r\n\r\n\t\treturn this._cancelationRace(result);\r\n\r\n\t},\r\n\r\n\t// trigger methods\r\n\r\n\ttriggerComplete() { \r\n\r\n\t\tthis.updateProcessInContext(null);\r\n\r\n\t\tif (_.isFunction(this.onComplete))\r\n\t\t\tthis.onComplete(this.context, ...this.args);\r\n\r\n\t\tthis.triggerOnContext();\r\n\r\n\t\tthis.triggerEnd();\r\n\t\t\r\n\t\r\n\t},\r\n\ttriggerError(errors){\r\n\r\n\r\n\t\tthis.updateProcessInContext(null);\t\t\r\n\r\n\t\tif(!_.isArray(errors))\r\n\t\t\terrors = [errors];\r\n\r\n\t\tthis.errors.push(...errors);\r\n\r\n\t\t\r\n\t\tif (_.isFunction(this.onError))\r\n\t\t\tthis.onError(this.context, ...this.errors);\r\n\t\t\r\n\t\tthis.triggerOnContext('error', ...this.errors);\r\n\t\t\r\n\t\tthis.triggerEnd();\r\n\r\n\t\t\r\n\t},\r\n\ttriggerEnd(){\r\n\t\tthis.triggerOnContext('end');\r\n\t},\r\n\r\n\r\n\r\n\t// helpers methods\r\n\r\n\tgetJsError(context){\r\n\t\t!context && (context = this);\r\n\t\tif(context != this && (!_.isObject(context) || !_.isArray(context.errors)))\r\n\t\t\treturn;\r\n\r\n\t\treturn _(context.errors).filter(f => f instanceof Error)[0];\r\n\t},\t\r\n\r\n\t_cancelationRace(promise){\r\n\t\treturn race(this.cancelPromise, promise);\r\n\t},\r\n\r\n\r\n\tgetContextProcessKey(){\r\n\t\treturn camelCase(`_process:${this.name}:executing`);\r\n\t},\r\n\tgetProcessFromContext(){\r\n\t\tlet key = this.getContextProcessKey();\r\n\t\treturn this.context[key];\r\n\t},\r\n\tupdateProcessInContext(process){\r\n\t\tlet key = this.getContextProcessKey();\t\t\r\n\t\tthis.context[key] = process;\r\n\t},\r\n\r\n\r\n\r\n\ttriggerOnContext (eventName) {\r\n\t\r\n\t\tlet context = this.context; \r\n\t\tif(!_.isFunction(context.trigger))\r\n\t\t\treturn;\r\n\t\t\r\n\t\tlet event = (eventName ? eventName + ':' : '') + this.name;\r\n\t\tlet triggerArgs = [context, event];\r\n\t\tif (this.exposeSelf) {\r\n\t\t\ttriggerArgs.push(this);\r\n\t\t}\r\n\t\ttriggerArgs.push(...this.args);\r\n\t\treturn triggerMethodOn(...triggerArgs);\r\n\t\r\n\t},\r\n\r\n\tinvokeOnContext(methodName)\r\n\t{\r\n\t\tlet method = camelCase(methodName);\r\n\t\tlet context = this.context;\r\n\t\tlet args = this.args;\r\n\t\treturn betterResult(context, method, { args });\r\n\r\n\t}\r\n\r\n}, {\r\n\tregister(context, name, opts) {\r\n\t\treturn register(this, context, name, opts);\r\n\t}\r\n});\r\n\r\n\r\n// Process.register = function(context, name, opts) {\r\n// \treturn register(this, context, name, opts);\r\n// };\r\n\r\nexport default Process;\r\n","import _ from 'underscore';\r\nimport Process from './process.js';\r\nimport { getOption } from 'bbmn-utils';\r\n\r\nconst defaultStartableOptions  = {\r\n\tconcurrent: false,\r\n\texposeSelf: true,\r\n\t//good place to supply own state collecting logic\r\n\tstoreState(){\r\n\r\n\t\tthis.contextState = [{\r\n\t\t\tkey: 'startable.status',\r\n\t\t\tvalue: this.context['startable.status']\r\n\t\t}];\r\n\r\n\r\n\t\t/*\r\n\r\n\t\tfor example: take all simple values from context\r\n\r\n\t\tfor(var key in this.context){\r\n\t\t\tlet value = this.context[key];\r\n\t\t\tif (value == null || !_.isObject(value.valueOf()))\r\n\t\t\t\tthis.contextState.push({ key, value });\r\n\t\t}\r\n\r\n\t\t*/\r\n\r\n\t},\r\n\trestoreState(){\r\n\t\t_(this.contextState || []).each(keyValue => {\r\n\t\t\tthis.context[keyValue.key] = keyValue.value;\r\n\t\t});\r\n\t},\r\n\tonBefore(...args){\r\n\t\tthis.storeState();\r\n\t\tthis.ensureState();\r\n\t\tthis.context['startable.status'] = this.processingName;\r\n\t\tthis.context['startable.start.lastArguments'] = args;\r\n\t},\r\n\tonComplete(){\r\n\t\tthis.context['startable.status'] = this.processedName;\r\n\t},\t\r\n\tonError(){\r\n\t\tthis.restoreState();\r\n\t},\r\n\tensureState(shouldThrow = true){\r\n\t\tlet other = this.name == 'start' ? 'stop' : 'start';\r\n\t\tlet error = this.name == 'start' ? 'not:stopped' : 'not:started';\r\n\t\tlet status = this.context['startable.status'];\r\n\t\tswitch(status){\r\n\t\tcase 'stopping':\r\n\t\tcase 'starting':\r\n\t\t\tif(shouldThrow) throw new Error('not:iddle');\r\n\t\t\telse return 'not:iddle';\r\n\t\tcase 'iddle':\r\n\t\t\tif(this.name == 'start') return;\r\n\t\t\telse if(shouldThrow) throw new Error(error);\r\n\t\t\telse return error;\r\n\t\tcase other:\r\n\t\t\tif(shouldThrow) throw new Error(error);\r\n\t\t\telse return error;\t\t\t\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst defaultStartOptions  = {\r\n\tprocessingName: 'starting',\r\n\tprocessedName: 'started'\r\n};\r\nconst defaultStopOptions  = {\r\n\tprocessingName: 'stopping',\r\n\tprocessedName: 'stopped'\r\n};\r\n\r\n\r\n\r\nexport default Base => Base.extend({\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeStartable();\r\n\t},\r\n\t_initializeStartable(){\r\n\t\tif (this._startableInitialized) return;\r\n\r\n\t\tlet startable = _.extend({}, defaultStartableOptions, getOption(this, 'startableOptions', {args:[this]}));\r\n\r\n\t\tlet start = _.extend({}, startable, defaultStartOptions, getOption(this, 'startOptions', {args:[this]}));\r\n\t\tlet stop = _.extend({}, startable, defaultStopOptions, getOption(this, 'stopOptions', {args:[this]}));\r\n\r\n\t\tProcess.register(this, 'start', start);\r\n\t\tProcess.register(this, 'stop', stop);\r\n\t\t\r\n\t\tthis._startableInitialized = true;\r\n\t},\r\n\tisStarted(){\r\n\t\treturn this['startable.status'] === 'started';\r\n\t},\r\n\tisStopped(){\r\n\t\treturn this['startable.status'] == null || this['startable.status'] === 'stopped' || this['startable.status'] === 'iddle';\r\n\t},\r\n\tisNotIddle(){\r\n\t\treturn this['startable.status'] === 'stopping' || this['startable.status'] === 'starting';\r\n\t},\r\n\trestart(){\r\n\t\tif(this.isNotIddle())\r\n\t\t\tthrow new Error('Restart not allowed while startable instance is not iddle: ', this['startable.status']);\r\n\t\tlet stop = this.isStarted() ? this.stop() : Promise.resolve();\r\n\t\tlet args = this['startable.start.lastArguments'] || [];\r\n\t\treturn stop.then(() => this.start(...args));\r\n\t}\t\r\n},{ StartableMixin: true });\r\n","import _ from 'underscore';\r\nimport { BaseClass, Events, Region, isClass } from 'bbmn-core';\r\nimport { startableMixin } from '../process/index.js';\r\nimport { mix, getOption, triggerMethod, buildViewByKey } from 'bbmn-utils';\r\n\r\nconst BaseApp = mix(BaseClass).with(Events, startableMixin);\r\n\r\nexport default BaseApp.extend({\r\n\tconstructor(options = {}){\r\n\t\tthis.options = _.clone(options);\r\n\t\tthis._startPromises = [];\r\n\t\tBaseApp.apply(this, arguments);\r\n\t\tthis.initialize(options);\r\n\t\tthis.triggerMethod('initialize', options);\t\r\n\t},\r\n\ttriggerMethod,\r\n\tgetOption(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t},\r\n\tgetStartPromises(){\r\n\t\t\r\n\t\tif(!this._startPromises) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn _.map(this._startPromises, item =>{\r\n\t\t\tif (_.isFunction(item)) {\r\n\t\t\t\treturn item.call(this, this);\r\n\t\t\t} else {\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\taddStartPromise(...args){\r\n\t\tthis._startPromises.push(...args);\r\n\t},\r\n\tinitialize:() => {},\r\n\tdoOnResolve(promise, callback, ...args){\r\n\t\treturn promise.then(() => {\r\n\t\t\treturn callback.apply(this, args);\r\n\t\t});\r\n\t},\r\n\tisRendered(){\r\n\t\treturn this.layoutView && this.layoutView.isRendered();\r\n\t},\r\n\trender(){\r\n\t\tthis.triggerMethod('before:layout:ready');\r\n\t\tthis.renderLayout();\r\n\t\tthis.triggerMethod('layout:ready');\r\n\t},\r\n\trenderLayout(options){\r\n\t\tif (!this.layoutView) {\r\n\t\t\tlet layout = this.buildLayout(options);\r\n\t\t\tif(!layout) { return; }\r\n\t\t\tlet region = this.getRegion();\r\n\t\t\tregion.show(layout);\r\n\r\n\t\t\tthis.layoutView = layout;\r\n\t\t}\r\n\t\treturn this.layoutView;\r\n\t},\r\n\tbuildLayout(options){\r\n\t\treturn buildViewByKey(this, 'layout', { options });\r\n\t},\r\n\tgetRegion(){\r\n\t\tif (this._region) return this._region;\r\n\t\tthis._region = this.buildRegion();\r\n\t\treturn this._region;\r\n\t},\r\n\t_buildRegion(region, options){\r\n\t\tif (region == null) {\r\n\t\t\treturn new Region(options);\r\n\t\t} else if (isClass(region, Region)) {\r\n\t\t\treturn new region(options);\r\n\t\t} else if (_.isFunction(region)) {\r\n\t\t\treturn this._buildRegion(region.call(this, this), options);\r\n\t\t} else if (_.isObject(region)) {\r\n\t\t\tlet RegionClass = region.regionClass || Region;\r\n\t\t\tlet newOptions = _.extend({}, _.omit(region, 'regionClass'));\r\n\t\t\tif(!newOptions.el) {\r\n\t\t\t\tnewOptions.el = options.el;\r\n\t\t\t}\r\n\t\t\tif(newOptions.replaceElement == null) {\r\n\t\t\t\tnewOptions.replaceElement = options.replaceElement;\r\n\t\t\t}\r\n\t\t\treturn new RegionClass(newOptions);\r\n\t\t}\r\n\t},\r\n\tbuildRegion(){\r\n\t\tlet el = this.getOption('appEl') || 'body';\r\n\t\tlet opts = { el, replaceElement: true };\r\n\t\treturn this._buildRegion(this.getOption('region', { args: [this] }), opts);\r\n\t},\r\n});\r\n","import { BaseClass, Events } from 'bbmn-core';\r\nimport { getOption, triggerMethod, mix } from 'bbmn-utils';\r\n\r\nconst Schema = mix(BaseClass).with(Events).extend({\r\n\tgetOption: function(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t},\r\n\ttriggerMethod\r\n});\r\n\r\nexport default Schema;\r\n","import _ from 'underscore';\r\nimport { betterResult, clone, isEmptyValue, toBool, getFlag } from 'bbmn-utils';\r\nimport Schema from './schema.js';\r\n\r\n\r\nexport default Schema.extend({\r\n\tconstructor(options = {}){\r\n\t\tSchema.apply(this, arguments);\r\n\t\tlet { name, property, modelSchema, order = 0 } = options;\r\n\t\tthis.name = name;\r\n\t\tthis.schema = _.extend({}, property);\t\r\n\t\tthis.modelSchema = modelSchema;\r\n\t\tif (this.schema.order != null)\r\n\t\t\torder = this.schema.order;\r\n\t\tthis.order = order;\r\n\t},\r\n\t_getByKey(key, options = {}){\r\n\t\tlet hash = betterResult(this.schema, key, { args: [options, {property:this,model:this.modelSchema}], default: {} });\r\n\t\treturn clone(hash, { functions: true });\r\n\t},\r\n\tgetValidation(options) {\r\n\t\treturn this._getByKey('validation', options);\r\n\t},\r\n\tgetType(options) {\r\n\t\tlet type = this._getByKey('value', options);\r\n\t\tif(!('multiple' in type)) {\r\n\t\t\ttype.multiple = false;\r\n\t\t}\r\n\t\treturn type;\r\n\t},\r\n\tgetDisplay(options){\r\n\t\treturn this._getByKey('display', options);\r\n\t},\r\n\tgetLabel(model){\r\n\t\tlet label = this.getDisplay().label;\r\n\t\treturn betterResult({ label },'label', { context: model || this, args: [model] });\r\n\t},\r\n\tgetEdit(options = {}){\r\n\t\tlet editOptions = this._getByKey('edit', options);\r\n\t\tif (editOptions === false) return false;\r\n\t\tlet valueOptions = this.getType(options);\r\n\t\tlet label = this.getLabel(options.model);\r\n\t\tlet compiled = _.extend({ name: this.name, label, schema: this }, options, editOptions, { valueOptions });\r\n\t\treturn compiled;\r\n\t},\r\n\t// accepts: value, model, options\r\n\tgetDisplayValue(val, model, options = {}){\r\n\r\n\t\t_.defaults(options, { value: val, allValues: model && model.toJSON && model.toJSON(), model });\r\n\t\tlet display = this.getDisplay(options);\r\n\t\tlet type = this.getType(options);\r\n\r\n\t\toptions = _.extend(options, { display, type, property: this });\r\n\t\tif (display) {\r\n\t\t\t\r\n\t\t\tif (_.isFunction(display.transform)) {\r\n\t\t\t\tval = display.transform.call(model, val, options);\r\n\t\t\t} else if (type.type == 'boolean' && type.sourceValues) {\r\n\r\n\t\t\t\tif (_.isString(val)) {\r\n\t\t\t\t\tval = toBool(val);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_.some(type.sourceValues, (label, key) => {\r\n\t\t\t\t\tif(toBool(key) === val) {\r\n\t\t\t\t\t\tval = label;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (type.type == 'enum' && type.sourceValues) {\r\n\t\t\t\tlet sourceValues = betterResult({ sourceValues: type.sourceValues }, 'sourceValues', { context: model, args:[ model ]});\r\n\t\t\t\tlet result = getFlag(sourceValues, val);\r\n\t\t\t\tif(result)\r\n\t\t\t\t\tval = result;\r\n\t\t\t}\r\n\r\n\t\t\tif (isEmptyValue(val) && display.ifEmpty && !options.ignoreIfEmpty) {\r\n\t\t\t\tval = betterResult(display, 'ifEmpty', { context: model, args: [model, options] });\r\n\t\t\t} else if (!isEmptyValue(val) && display.ifNotEmpty && !options.ignoreIfNotEmpty) {\r\n\t\t\t\tval = display.ifNotEmpty;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn val;\r\n\t},\r\n\tonPropertyChange(property, opts = {}){\r\n\t\tif (this.modelSchema) {\r\n\t\t\tthis.modelSchema.triggerMethod('property:change', property, opts);\r\n\t\t}\r\n\t},\r\n\tgetDependedOn(name){\r\n\t\tlet depended = this.schema.dependOn;\r\n\t\tif (!depended) {\r\n\t\t\tdepended = [];\r\n\t\t} else if (_.isString(depended)) {\r\n\t\t\tdepended = depended.split(/\\s*,\\s*/g).map(name => ({ name }));\r\n\t\t} else if (!_.isArray(depended) && _.isObject(depended)) {\r\n\t\t\tdepended = _.map(depended, (value, name) => {\r\n\t\t\t\tvalue.name = name;\r\n\t\t\t\treturn value;\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tdepended = [];\r\n\t\t}\r\n\t\tif(!name)\r\n\t\t\treturn depended;\r\n\t\telse \r\n\t\t\treturn _.findWhere(depended, { name });\r\n\t},\r\n\tisDependedOn(name){\r\n\t\tlet depended = this.getDependedOn(name);\r\n\t\treturn !!depended;\r\n\t},\r\n\tresetValues(opts = {}, depended = {}){\r\n\t\tlet { model, allValues, silent } = opts;\r\n\t\tlet dependedValue = allValues[depended.name];\r\n\t\tlet value = betterResult(depended, 'value', { args:[ dependedValue, this.modelSchema && this.modelSchema.getProperty(depended.name) ]});\r\n\t\tif (model) {\r\n\t\t\tmodel.set(this.name, value, { silent });\r\n\t\t} else if(allValues) {\r\n\t\t\tallValues[this.name] = value;\r\n\t\t}\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport Schema from './schema.js';\r\nimport PropertySchema from './property-schema.js';\r\nimport { isEmptyValue } from 'bbmn-utils';\r\n\r\nexport default Schema.extend({\r\n\tconstructor(properties = {}, options = {}){\r\n\t\tthis.options = _.clone(options);\r\n\t\tthis.properties = {};\r\n\t\tSchema.apply(this,arguments);\r\n\t\tthis.setProperties(properties);\r\n\t},\r\n\tpropertySchema: PropertySchema,\r\n\t_createProperty(property){\r\n\t\tlet props = this.getProperties();\r\n\t\tlet order = _.size(props);\r\n\t\tlet Schema = this.getOption('propertySchema');\r\n\t\tlet options = { name: property.name, property, modelSchema: this, order };\r\n\t\treturn this.createProperty(Schema, options);\r\n\t},\r\n\tcreateProperty(Schema, options){\r\n\t\treturn new Schema(options);\r\n\t},\r\n\tsetProperties(properties){\r\n\t\treturn _.map(properties, (property, name) => {\r\n\t\t\tif(!_.isObject(property)) { return; }\r\n\r\n\t\t\tlet propertyName = _.isString(name) ? name : property.name;\r\n\t\t\tif (isEmptyValue(propertyName)) {\r\n\t\t\t\tthrow new Error('property name missing: ' + name);\r\n\t\t\t}\t\t\t\r\n\t\t\treturn this.setProperty(propertyName, property);\r\n\r\n\t\t});\r\n\t},\r\n\tgetProperties(){\r\n\t\treturn this.properties;\r\n\t},\r\n\tgetPropertiesArray(){\r\n\t\tlet props = this.getProperties();\r\n\t\treturn _.toArray(props)\r\n\t\t\t.sort((p1,p2) => p1.order - p2.order);\t\t\r\n\t},\r\n\tgetPropertiesNames(){\r\n\t\tlet props = this.getPropertiesArray();\r\n\t\treturn _.pluck(props, 'name');\r\n\t},\r\n\tgetProperty(name, { create = false } = {}){\r\n\t\tlet properties = this.getProperties() || {};\r\n\t\tlet property = properties[name];\r\n\t\tif(property || !create) {\r\n\r\n\t\t\treturn property;\r\n\t\t}\r\n\t\tproperty = this._createProperty(name);\r\n\t\treturn this.setProperty(name, property);\r\n\t},\r\n\t_setProperty(name, property){\r\n\t\tif(!_.isObject(property)){\r\n\t\t\tthrow new Error('property is not an object', property);\r\n\t\t}\r\n\t\tif(isEmptyValue(name)){\r\n\t\t\tthrow new Error('property has no name', property);\r\n\t\t}\r\n\r\n\t\tif (isEmptyValue(property.name)) {\r\n\t\t\tproperty.name = name;\r\n\t\t}\r\n\r\n\t\tif(!(property instanceof PropertySchema)){\r\n\t\t\tproperty = this._createProperty(property);\r\n\t\t}\r\n\r\n\t\tlet properties = this.getProperties();\r\n\t\tproperties[property.name] = property;\r\n\r\n\t\treturn property;\r\n\t},\r\n\tsetProperty(name, property) {\r\n\t\tif(_.isObject(name)){\r\n\t\t\tproperty = name;\r\n\t\t\tname = property.name;\r\n\t\t}\r\n\t\treturn this._setProperty(name, property);\r\n\t},\r\n\tgetValidation(name) {\r\n\t\tlet property = this.getProperty(name);\r\n\t\treturn property && property.getValidation() || {};\r\n\t},\r\n\tgetType(name) {\r\n\t\tlet property = this.getProperty(name);\r\n\t\treturn property && property.getType() || {};\r\n\t},\r\n\tgetLabel(name){\r\n\t\tlet property = this.getProperty(name);\r\n\t\treturn property && property.getLabel() || '';\r\n\t},\r\n\tonPropertyChange(property, opts = {}){\r\n\t\tlet arr = this.getPropertiesArray();\r\n\t\t_.each(arr, prop => {\r\n\t\t\tlet depended = prop.getDependedOn(property);\r\n\t\t\tif (!depended) return;\r\n\t\t\tprop.resetValues(opts, depended);\r\n\t\t});\r\n\t}\r\n\r\n});\r\n","import _ from 'underscore';\r\nimport { BaseClass } from 'bbmn-core';\r\n\r\nconst ClassStore = BaseClass.extend({\t\r\n\tconstructor(options = {}){\r\n\t\tBaseClass.apply(this, arguments);\r\n\t\t_.extend(this, _.omit(options, 'createStore'));\r\n\t\tlet key = _.uniqueId('__classstore');\r\n\t\tthis._createStore = options.createStore;\r\n\t\tthis.instanceNameKey = options.instanceNameKey || key;\r\n\t\tthis.ctorNameKey = options.ctorNameKey || key;\r\n\t\tthis.items = {};\r\n\t},\r\n\tonExists: () => false,\r\n\tcreateStore(arg, ...rest){\r\n\t\tif (this.isExists(arg)) {\r\n\t\t\treturn this.onExists();\r\n\t\t}\r\n\t\tlet context = this.getCreateStoreContext(arg);\t\r\n\t\tlet store = this.buildStore(context, ...rest);\t\t\r\n\t\tthis.setStore(context, store);\r\n\t\treturn store;\r\n\t},\r\n\tgetStoreName(arg, generate){\r\n\t\tif(_.isString(arg) && arg !== '') {\r\n\t\t\treturn arg;\r\n\t\t}\r\n\t\tlet store;\r\n\t\tif (_.isFunction(arg)) {\r\n\t\t\tstore = this.getStoreByCtor(arg);\r\n\t\t} else if (_.isObject(arg)) {\r\n\t\t\tstore = this.getStoreByInstance(arg);\r\n\t\t}\r\n\t\tif (store) {\r\n\t\t\treturn store.name;\r\n\t\t}\r\n\t\tif (generate) {\r\n\t\t\treturn _.uniqueId('modelSchema');\t\t\r\n\t\t}\r\n\t},\r\n\tisExists(arg){\r\n\t\treturn this.getStore(arg) != null;\r\n\t},\r\n\tgetStoreByName(name){\r\n\t\treturn this.items[name];\r\n\t},\t\r\n\tgetStoreByInstance(instance){\r\n\t\tlet item;\r\n\t\tlet name = instance[this.instanceNameKey];\r\n\t\tif(name) {\r\n\t\t\titem = this.getStoreByName(name);\r\n\t\t\tif(item){ return item; }\r\n\t\t}\r\n\t\treturn this.getStoreByCtor(instance.constructor);\r\n\t},\r\n\tgetStoreByCtor(ctor){\r\n\t\tlet item;\r\n\t\tlet name = ctor[this.ctorNameKey];\r\n\t\tif(name) {\r\n\t\t\titem = this.getStoreByName(name);\r\n\t\t\tif(item){ return item; }\r\n\t\t}\r\n\t\treturn _.find(this.items, f => f.ctor === ctor);\r\n\t},\r\n\tgetStore(arg){\r\n\t\tif (_.isString(arg)) {\r\n\t\t\treturn this.getStoreByName(arg);\r\n\t\t} else if (_.isFunction(arg)) {\r\n\t\t\treturn this.getStoreByCtor(arg);\r\n\t\t} else if(_.isObject(arg)) {\r\n\t\t\treturn this.getStoreByInstance(arg);\r\n\t\t}\r\n\t},\r\n\tsetStore({ name, ctor, instance } = {}, store){\r\n\t\tthis.items[name] = store;\r\n\t\tthis.setStoreNameOn(instance || ctor, name);\r\n\t},\r\n\tsetStoreNameOn(arg, name){\r\n\t\tif(_.isFunction(arg)) {\r\n\t\t\targ[this.ctorNameKey] = name;\r\n\t\t\treturn;\r\n\t\t} else if(_.isObject(arg)) {\r\n\t\t\targ[this.instanceNameKey] = name;\r\n\t\t\treturn this.setStoreNameOn(arg.constructor, name);\r\n\t\t}\r\n\t},\r\n\tgetCreateStoreContext(arg){\r\n\t\tlet ctor = _.isFunction(arg) \r\n\t\t\t? arg \r\n\t\t\t: _.isObject(arg) ? arg.constructor\r\n\t\t\t\t: undefined;\r\n\r\n\t\tlet instance = !_.isFunction(arg) && _.isObject(arg) && arg || undefined;\r\n\r\n\t\tlet name = this.getStoreName(arg, true);\r\n\t\t\r\n\t\treturn { instance, ctor, name };\r\n\t},\r\n});\r\n\r\nexport default ClassStore;\r\n","import _ from 'underscore';\r\nimport ModelSchema from './model-schema.js';\r\nimport ClassStore from '../class-store';\r\n\r\nconst store = new ClassStore({\r\n\tctorNameKey: '__schemaName',\r\n\tinstanceNameKey: '__schemaName',\r\n\tonExists: () => { throw new Error('Schema already exists'); },\r\n\tbuildStore(context, schema = {}, options) {\r\n\t\tlet { name, ctor } = context;\r\n\t\tif(!(schema instanceof ModelSchema) && _.isObject(schema)){\r\n\t\t\tschema = new ModelSchema(schema, options);\r\n\t\t} else {\r\n\t\t\tschema = new ModelSchema({}, options);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tname, ctor, schema\r\n\t\t};\r\n\t},\r\n\tget(arg) {\r\n\t\tlet cache = this.getStore(arg);\r\n\t\treturn cache && cache.schema || undefined;\r\n\t},\r\n\tinitialize(){\r\n\t\tlet store = this.createStore(...arguments);\r\n\t\treturn store.schema;\r\n\t}\r\n});\r\n\r\n\r\nexport default store;\r\n","import ModelSchemas from './store.js';\r\nexport default Model => Model.extend({\r\n\tgetSchema(){\r\n\t\treturn ModelSchemas.get(this);\r\n\t},\r\n\tgetPropertySchema(key){\r\n\t\tlet schema = this.getSchema();\r\n\t\tif(schema) {\r\n\t\t\treturn schema.getProperty(key);\r\n\t\t}\r\n\t},\r\n\tdisplay(key, options = {}){\r\n\t\tlet value = this.get(...arguments);\r\n\t\tlet property = this.getPropertySchema(key);\r\n\t\tif (property) {\t\t\t\r\n\t\t\treturn property.getDisplayValue(value, this, options);\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\tdisplayLabel(key){\r\n\t\tlet property = this.getPropertySchema(key);\r\n\t\tif (property) {\r\n\t\t\treturn property.getLabel(this);\r\n\t\t}\r\n\t}\r\n});\r\n","import { View, CollectionView } from 'backbone.marionette';\r\nimport { mix } from 'bbmn-utils';\r\nimport { cssClassModifiersMixin, customsMixin, emptyFetchMixin, improvedIndexesMixin, optionsMixin } from 'bbmn-mixins';\r\n\r\n\r\nfunction _initializeRenderOnModelChange(){\r\n\tlet romc = this.getOption('renderOnModelChange', { args: [this.model, this]});\r\n\tif (romc && this.model) {\r\n\t\tthis.listenTo(this.model, 'change', () => this.render());\r\n\t}\r\n}\r\n\r\n\r\nconst BaseView = mix(View)\r\n\t.with(\r\n\t\toptionsMixin, \r\n\t\tcssClassModifiersMixin,\r\n\t\t{\r\n\t\t\t_initializeRenderOnModelChange\r\n\t\t}\t\t\r\n\t);\r\n\r\n\r\n\r\nconst ExtView = BaseView.extend({\r\n\tconstructor(){\r\n\t\tBaseView.apply(this, arguments);\r\n\t\tthis._initializeRenderOnModelChange();\r\n\t},\r\n});\r\n\r\nconst BaseCollectionVIew = mix(CollectionView)\r\n\t.with(\r\n\t\toptionsMixin, \r\n\t\tcssClassModifiersMixin, \r\n\t\tcustomsMixin, \r\n\t\temptyFetchMixin, \r\n\t\timprovedIndexesMixin,\r\n\t\t{\r\n\t\t\t_initializeRenderOnModelChange\r\n\t\t}\r\n\t);\r\n\r\nconst ExtCollectionVIew = BaseCollectionVIew.extend({\r\n\tconstructor(){\r\n\t\tBaseCollectionVIew.apply(this, arguments);\r\n\t\tthis._initializeRenderOnModelChange();\r\n\t},\r\n});\r\n\r\nexport {\r\n\tExtView as View,\r\n\tExtCollectionVIew as CollectionView\r\n};\r\n","import _ from 'underscore';\r\nimport { View } from './views';\r\nimport { isEmptyValue } from 'bbmn-utils';\r\n\r\nconst templates = {\r\n\tdefault: _.template('<span><%= _v.getText() %></span>'),\r\n\tsmall: _.template('<small><%= _v.getText() %></small>'),\r\n\tlabeledText: _.template('<label><%= _v.getHeader() %></label><span><%= _v.getText() %></span><% if(_v.hasSmallText()){ %><small>_v.getSmallText()</small><% } %>'),\r\n\tfull: _.template('<% if(_v.hasTopText()){ %><i><%= _v.getTopText() %></i><% } %><span><%= _v.getText() %></span><% if(_v.hasSmallText()){ %><small><%= _v.getSmallText() %></small><% } %><% if(_v.hasBottomText()){ %><b><%= _v.getBottomText() %></b><% } %>')\r\n};\r\nconst AtomText = View.extend({\r\n\tautodetectTemplate: true,\r\n\tconstructor(){\r\n\t\tView.apply(this, arguments);\r\n\t\tthis.addCssClassModifier(\r\n\t\t\t'atom-text',\r\n\t\t\t(m,v) => 'atom-' + v.getType()\r\n\t\t);\t\t\r\n\t},\r\n\t_hasAnyProperty(...properties){\r\n\t\treturn _.some(properties, prop => {\r\n\t\t\treturn (!!this[prop] || this.options[prop]);\r\n\t\t});\r\n\t},\r\n\tisFull(){\r\n\t\treturn this.getOption('type') == 'full' || this._hasAnyProperty('topText','bottomText');\r\n\t},\r\n\tisSmall(){\r\n\t\treturn this.getOption('type') == 'small';\r\n\t},\r\n\tisLabeledText(){\r\n\t\treturn this.getOption('type') == 'labeledText' || this._hasAnyProperty('header');\r\n\t},\r\n\tgetType(){\r\n\t\tlet type = this.getOption('type') || 'default';\r\n\t\tif(type != 'default') { return type; }\r\n\t\tif(this.getOption('autodetectTemplate')) {\r\n\t\t\tif (this.isFull()) {\r\n\t\t\t\treturn 'full';\r\n\t\t\t} else if (this.isLabeledText()){\r\n\t\t\t\treturn 'labeledText';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn type;\r\n\t},\r\n\tgetTemplate(){\r\n\t\tlet type = this.getType();\r\n\t\treturn templates[type];\r\n\t},\r\n\t_getText(key){\r\n\t\treturn this.getOption(key, { args: [ this.model, this ] });\r\n\t},\r\n\r\n\thasHeader(){\r\n\t\treturn !isEmptyValue(this.getHeader());\r\n\t},\r\n\tgetHeader(){ return this._getText('header'); },\r\n\r\n\thasTopText(){\r\n\t\treturn !isEmptyValue(this.getTopText());\r\n\t},\r\n\tgetTopText(){ return this._getText('topText'); },\r\n\r\n\tgetText(){ return this._getText('text'); },\r\n\r\n\thasSmallText(){\r\n\t\treturn !isEmptyValue(this.getSmallText());\r\n\t},\r\n\tgetSmallText(){ return this._getText('smallText'); },\r\n\r\n\thasBottomText(){\r\n\t\treturn !isEmptyValue(this.getBottomText());\r\n\t},\t\r\n\tgetBottomText(){ return this._getText('bottomText'); },\r\n\r\n\ttemplateContext(){\r\n\t\treturn {\r\n\t\t\t_v: this,\r\n\t\t};\r\n\t}\r\n}, {\r\n\tsmall(arg1, arg2){\r\n\t\tlet defs = { type: 'small' };\r\n\t\tlet uopts = {};\r\n\t\tif(_.isString(arg1) || !arg1) {\r\n\t\t\tdefs.text = arg1;\r\n\t\t\tuopts = arg2;\r\n\t\t} else {\r\n\t\t\tuopts = arg1;\r\n\t\t}\r\n\t\treturn new AtomText(_.extend({}, uopts, defs));\r\n\t},\r\n\tbyModel(model, options){\r\n\t\tlet keys =  ['header', 'topText', 'text', 'smallText', 'bottomText'];\r\n\t\tlet values = _.reduce(keys,(memo, key) => {\r\n\t\t\tif(model.has(key) && !isEmptyValue(model.get(key))) {\r\n\t\t\t\tmemo[key] = model.get(key);\r\n\t\t\t}\r\n\t\t\treturn memo;\r\n\t\t}, {});\r\n\t\treturn new AtomText(_.extend({}, values, options));\r\n\t}\r\n});\r\n\r\nexport default AtomText;\r\n","import _ from 'underscore';\r\nimport { BackboneView } from 'bbmn-core';\r\nimport { triggerMethod, getOption } from 'bbmn-utils';\r\n\r\n\r\nexport const TextView = BackboneView.extend({\r\n\tdisplayInsteadGet: true,\r\n\tshouldEscapeValue: true,\r\n\tconstructor(options = {}){\r\n\t\tthis.options = options;\r\n\t\tlet { text, value, shouldEscapeValue, property, schema, customValue } = options;\r\n\t\tif (!property && schema) {\r\n\t\t\tproperty = schema.name;\r\n\t\t}\r\n\t\tthis.setValue(text || value, { shouldEscapeValue, preventRender: true });\r\n\r\n\t\t\r\n\t\tBackboneView.apply(this, arguments);\r\n\t\tif (this.model && property) {\r\n\t\t\tthis.customValue = customValue;\r\n\t\t\tthis.schema = schema;\r\n\t\t\tthis.property = property;\r\n\t\t\tthis.applyPropertyValue({ preventRender: true });\r\n\t\t\tproperty && this.listenTo(this.model, 'change:' + property, this.applyPropertyValue);\r\n\t\t}\r\n\t},\r\n\tgetOption(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t},\r\n\trender(){\r\n\t\tthis.setNodeValue();\r\n\t},\r\n\tsetValue(value, opts = {}){\r\n\t\t\r\n\t\tthis.value = value;\r\n\t\tlet { preventRender, shouldEscapeValue } = opts;\r\n\r\n\t\tif(shouldEscapeValue != null){\r\n\t\t\tthis.shouldEscapeValue = shouldEscapeValue;\r\n\t\t}\r\n\r\n\t\tif (!preventRender) {\r\n\t\t\tthis.setNodeValue();\r\n\t\t}\r\n\t},\r\n\tgetValue({ asIs, shouldEscapeValue } = {}){\r\n\t\tlet value = this.value;\r\n\t\tif (asIs){\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\t\r\n\t\tif(!_.isString(value)) {\r\n\t\t\tvalue = value == null ? '' : value.toString();\r\n\t\t}\r\n\r\n\t\tif (shouldEscapeValue == null) {\r\n\t\t\tshouldEscapeValue = this.shouldEscapeValue;\r\n\t\t}\r\n\r\n\t\tif (shouldEscapeValue) {\r\n\t\t\tvalue = _.escape(value);\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\tsetNodeValue() {\r\n\t\tthis.el.innerHTML = this.getValue();\r\n\t},\r\n\tapplyPropertyValue(opts){\r\n\t\tlet value = this.getPropertyValue();\r\n\t\tthis.setValue(value, opts);\r\n\t},\r\n\tgetPropertyValue(){\r\n\t\t\r\n\t\tif (_.isFunction(this.customValue)) {\r\n\t\t\treturn this.customValue.call(this, this.property, this.model, this);\r\n\t\t}\r\n\r\n\t\tlet val = this.model.get(this.property);\r\n\t\tlet useDisplay = this.getOption('displayInsteadGet');\r\n\t\tif (useDisplay && this.schema) {\r\n\t\t\treturn this.schema.getDisplayValue(val, this.model, { allValues: this.getOption('allValues') });\r\n\t\t} else {\r\n\t\t\treturn val;\r\n\t\t}\r\n\t},\r\n\ttriggerMethod,\r\n\tdestroy(){\r\n\t\tif (this._isDestroyed || this._isDestroying) { return this; }\r\n\t\tthis._isDestroying = true;\r\n\t\t\r\n\t\tthis.off();\r\n\r\n\t\tthis.remove();\r\n\r\n\t\tthis._isDestroyed = true;\r\n\t\r\n\t\treturn this;\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport { isEmptyValue } from 'bbmn-utils';\r\n\r\nconst rules = [\r\n\t{\r\n\t\tname: 'required',\r\n\t\tmessage: 'required',\r\n\t\tvalidate: (value) => {\r\n\t\t\tif (isEmptyValue(value)) {\r\n\t\t\t\treturn 'required';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: 'email',\r\n\t\tmessage: 'not a email',\r\n\t\tvalidate: (value) => {\r\n\t\t\t\r\n\t\t\tif(isEmptyValue(value)) { return; }\r\n\r\n\t\t\tif (!_.isString(value)) {\r\n\t\t\t\treturn 'type:mismatch';\r\n\t\t\t}\r\n\r\n\t\t\tlet chunks = value.split('@');\r\n\t\t\tlet left = chunks[0];\r\n\t\t\tlet right = chunks[1];\r\n\t\t\r\n\t\t\tif(\r\n\t\t\t\tchunks.length != 2\r\n\t\t\t\t|| !/^[a-z0-9\\-_.+]+$/gmi.test(left)\r\n\t\t\t\t|| !/^[a-z0-9\\-_]+\\.[a-z0-9\\-_]+(\\.[a-z0-9\\-_]+)*$/gmi.test(right)\r\n\t\t\t) {\r\n\t\t\t\treturn 'pattern:mismatch';\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'valueIn',\r\n\t\tmessage: 'given value is not one of allowed values',\r\n\t\tvalidate: (value, { valueIn } = {}) => {\r\n\t\t\tif(_.isArray(valueIn) && valueIn.indexOf(value) === -1) {\r\n\t\t\t\treturn 'value:not:in';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'valueNotIn',\r\n\t\tmessage: 'given value is one of forbiden values',\r\n\t\tvalidate: (value, { valueNotIn } = {}) => {\r\n\t\t\tif(_.isArray(valueNotIn) && valueNotIn.indexOf(value) > -1) {\r\n\t\t\t\treturn 'value:in';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'shouldBeEqual',\r\n\t\tmessage: 'given value is not equal',\r\n\t\tvalidate: (value, { shouldBeEqual, allValues } = {}) => {\r\n\t\t\t\r\n\t\t\tlet compare = _.isFunction(shouldBeEqual) \r\n\t\t\t\t? shouldBeEqual(allValues) \r\n\t\t\t\t: shouldBeEqual;\r\n\r\n\t\t\tif (value !== compare) {\r\n\t\t\t\treturn 'value:not:equal';\r\n\t\t\t}\r\n\t\t}\r\n\t},\t\r\n\t{\r\n\t\tname:'shouldNotBeEqual',\r\n\t\tmessage: 'given value is forbiden',\r\n\t\tvalidate: (value, { shouldNotBeEqual, allValues } = {}) => {\r\n\r\n\t\t\tlet compare = _.isFunction(shouldNotBeEqual) \r\n\t\t\t\t? shouldNotBeEqual(allValues) \r\n\t\t\t\t: shouldNotBeEqual;\r\n\r\n\t\t\tif (value !== compare) {\r\n\t\t\t\treturn 'value:equal';\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif(_.isFunction(shouldNotBeEqual)) {\r\n\t\t\t\treturn value !== shouldNotBeEqual(allValues);\r\n\t\t\t} else {\r\n\t\t\t\treturn value !== shouldNotBeEqual;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'minLength',\r\n\t\tmessage: ({ ruleValue } = {}) => 'length is less than ' + ruleValue,\r\n\t\tvalidate: (value, { minLength } = {}) => {\r\n\t\t\tif (_.isNumber(minLength) && (value || '').toString().length < minLength) {\r\n\t\t\t\treturn 'min:length';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'maxLength',\r\n\t\tmessage: ({ ruleValue } = {}) => 'length is greater than ' + ruleValue,\r\n\t\tvalidate: (value, { maxLength } = {}) => {\r\n\t\t\tif (_.isNumber(maxLength) && (value || '').toString().length > maxLength) {\r\n\t\t\t\treturn 'max:length';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'minValue',\r\n\t\tmessage: ({ ruleValue } = {}) => 'value is less than ' + ruleValue,\r\n\t\tvalidate: (value, { minValue } = {}) => {\r\n\t\t\tif (_.isNumber(minValue)) {\r\n\t\t\t\tlet numValue = parseFloat(value, 10);\r\n\t\t\t\tif (isEmptyValue(numValue) || numValue < minValue) {\r\n\t\t\t\t\treturn 'min:value';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'maxValue',\r\n\t\tmessage: ({ ruleValue } = {}) => 'value is greater than ' + ruleValue,\r\n\t\tvalidate: (value, { maxValue } = {}) => {\r\n\t\t\tif (_.isNumber(maxValue)) {\r\n\t\t\t\tlet numValue = parseFloat(value, 10);\r\n\t\t\t\tif (isEmptyValue(numValue) || numValue > maxValue) {\r\n\t\t\t\t\treturn 'max:value';\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'pattern',\r\n\t\tmessage: 'value is not in pattern',\r\n\t\tvalidate: (value, { pattern } = {}) => {\r\n\t\t\tvalue = (value || '').toString();\r\n\r\n\t\t\tif(_.isString(pattern) && !isEmptyValue(pattern)) {\r\n\t\t\t\tpattern = new RegExp(pattern);\r\n\t\t\t}\r\n\t\t\tif(!_.isRegExp(pattern)) { return; }\r\n\r\n\t\t\tif (!pattern.test(value)) {\r\n\t\t\t\treturn 'pattern';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: 'validate',\r\n\t\tvalidate: (value, options = {}) => {\r\n\t\t\tlet { ruleValue } = options;\r\n\t\t\tif(!_.isFunction(ruleValue)) return;\r\n\t\t\treturn ruleValue(value, options);\r\n\t\t},\r\n\t},\t\r\n];\r\n\r\nreIndex(false);\r\n\r\nexport function reIndex(sortBefore = true) {\r\n\tif (sortBefore) {\r\n\t\trules.sort((a,b) => a.index - b.index);\r\n\t}\r\n\t_.each(rules, (rule, index) => {\r\n\t\trule.index = index;\r\n\t});\r\n}\r\n\r\nexport default rules;\r\n","import _ from 'underscore';\r\nimport rules from './rules.js';\r\nimport { isEmptyValue } from 'bbmn-utils';\r\n\r\nfunction normalizeValidationContext(context){\r\n\tif (context === 'required') {\r\n\t\treturn { required: true };\r\n\t} else if(_.isFunction(context)) {\r\n\t\treturn { validate: context };\r\n\t} else if(_.isObject(context)) {\r\n\t\treturn context;\r\n\t}\r\n}\r\n\r\nfunction getRuleContexts(rule = {}){\r\n\tlet founded = _.reduce(rule, (taken, ruleValue, name) => {\r\n\t\tlet found = _.findWhere(rules, { name });\r\n\t\tif(!found) return taken;\r\n\r\n\t\tlet message = rule[name + 'Message'];\r\n\t\ttaken.push({\r\n\t\t\trule: found,\r\n\t\t\truleValue,\r\n\t\t\tmessage,\r\n\t\t\tindex: found.index\r\n\t\t});\r\n\r\n\t\treturn taken;\r\n\r\n\t}, []);\r\n\tfounded.sort((a,b) => a.index - b.index);\r\n\treturn founded;\r\n}\r\n\r\nfunction check(value, ruleContext = {}) {\r\n\t\r\n\tlet { rule = {}, ruleValue, allValues, errors = [] } = ruleContext;\r\n\tif (rule.skipIfInvalid && errors.length) {\r\n\t\treturn Promise.reject();\r\n\t}\r\n\tlet message = ruleContext.message || rule.message;\r\n\tlet buildMessage = _.isFunction(message) ? message : ({ error } = {}) => isEmptyValue(message) ? error : message;\r\n\r\n\tlet validate = rule.validate;\r\n\tlet validateOptions = {\r\n\t\truleName: rule.name,\r\n\t\truleValue,\r\n\t\t[rule.name]: ruleValue,\r\n\t\tallValues,\r\n\t\tmessage: buildMessage({ value, allValues, ruleValue }),\r\n\t\terrors,\r\n\t};\r\n\tif (!_.isFunction(validate)) return Promise.resolve(value);\r\n\r\n\t\r\n\tlet result = validate(value, validateOptions);\r\n\r\n\tif (!result) {\r\n\t\treturn Promise.resolve(value);\r\n\t} else if(result && _.isFunction(result.then)) {\r\n\t\treturn result.then(\r\n\t\t\t() => Promise.resolve(value),\r\n\t\t\t(error) => Promise.reject(buildMessage({ error, value, allValues, ruleValue }))\r\n\t\t);\r\n\t} else {\r\n\t\treturn Promise.reject(buildMessage({ error: result, value, allValues, ruleValue }));\r\n\t}\r\n}\r\n\r\n\r\n\r\nexport default function validate(value, rule, { allValues = {} } = {}){\r\n\trule = normalizeValidationContext(rule);\r\n\tlet contexts = getRuleContexts(rule);\r\n\t\r\n\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet errors = [];\r\n\r\n\t\tlet rulesPromise = _.reduce(contexts, (promise, ruleContext) => {\r\n\r\n\t\t\tpromise = promise.then(() => {\r\n\t\t\t\treturn check(value, _.extend({}, ruleContext, { allValues, errors }));\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tif(error != null)\r\n\t\t\t\t\terrors.push(error);\r\n\t\t\t});\r\n\r\n\t\t\treturn promise;\r\n\r\n\t\t}, Promise.resolve(value));\r\n\r\n\t\trulesPromise.then(() => {\r\n\t\t\tif(errors.length){\r\n\t\t\t\treject(errors);\r\n\t\t\t} else {\r\n\t\t\t\tresolve(value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\n\r\n\r\n","import _ from 'underscore';\r\n\r\nimport rules, { reIndex } from './rules.js';\r\n\r\nimport { isEmptyValue } from 'bbmn-utils';\r\n\r\nimport validate from './validate.js';\r\n\r\nfunction removeRule(name){\r\n\tlet found = _.findIndex(rules, { name });\r\n\tif (found === -1) return;\r\n\tlet removed = rules.splice(found, 1);\r\n\treIndex();\r\n\treturn removed;\r\n}\r\n\r\nfunction setRule(rule){\r\n\tif (rule.index == null) {\r\n\t\trule.index = rules.length;\r\n\t}\r\n\trules.push(rule);\r\n\treIndex();\r\n\treturn rule;\r\n}\r\n\r\nexport default {\r\n\tsetRule(name, rule = {}){\r\n\t\tif(_.isObject(name)) {\r\n\t\t\trule = name;\r\n\t\t\tname = rule.name;\r\n\t\t}\r\n\r\n\t\tif(isEmptyValue(name)) {\r\n\t\t\tthrow new Error('rule name not specified');\r\n\t\t}\r\n\r\n\t\tif(rule == null){\r\n\t\t\treturn removeRule(name);\r\n\t\t} else if (!_.isObject(rule)) {\r\n\t\t\tthrow new Error('validation rule must be an object');\r\n\t\t} else {\r\n\t\t\tif (rule.name != name) {\r\n\t\t\t\trule.name = name;\r\n\t\t\t}\r\n\t\t\treturn setRule(rule);\r\n\t\t}\r\n\t},\r\n\tremoveRule(name) {\r\n\t\treturn removeRule(name);\r\n\t},\r\n\tgetRule(name){\r\n\t\treturn _.findWhere(rules, { name });\r\n\t},\r\n\tsetMessage(name, message){\r\n\t\tif(!_.isString(name) || isEmptyValue(name)) {\r\n\t\t\tthrow new Error('name must be not empty string');\r\n\t\t}\r\n\t\tif(!(_.isString(message) || _.isFunction(message))) {\r\n\t\t\tthrow new Error('message must be not empty string or a function returning a string');\r\n\t\t}\r\n\t\tlet rule = _.findWhere(rules, { name });\r\n\t\tif (!rule) { return; }\r\n\t\trule.message = message;\r\n\t},\r\n\tsetMessages(hash = {}){\r\n\t\t_.each(hash, (message, name) => this.setMessage(name, message));\r\n\t},\r\n\tvalidate,\r\n\t_rules: rules,\r\n};\r\n","import { Model } from 'bbmn-core';\r\nimport _ from 'underscore';\r\n\r\n/*\r\nBy default expects token on initialize\r\nnew User({...}, { token });\r\nyou can use bbmn-components bearer-token for that\r\nor something else\r\nbut token should have this defined properties:\r\n\ttoken.ready - promise\r\n\ttoken.hasToken() - should return true or flase\r\n\ttoken.update() - invokes on user change event, should receive refreshed token\r\n\r\n*/\r\nexport default Model.extend({\r\n\t\r\n\tshouldRequestOnInitialize: true,\r\n\r\n\tconstructor(hash, opts){\r\n\t\tthis._waitFor = [];\r\n\t\tthis.initializeToken(opts);\r\n\t\tModel.apply(this, arguments);\r\n\r\n\t\tif (this.shouldRequestOnInitialize) {\r\n\t\t\tthis.getReady();\r\n\t\t}\r\n\t},\r\n\tinitializeToken(opts = {}){\r\n\t\tlet { token } = opts;\r\n\t\tif (!token) return;\r\n\t\tthis.listenTo(token, 'changed', this.refresh);\r\n\t\tthis.token = token;\r\n\t\ttoken.ready && this._waitFor.push(token.ready);\r\n\t},\r\n\tgetReady(){\r\n\t\tif(this.ready) return this.ready;\r\n\t\t\r\n\r\n\t\tthis.ready = new Promise((resolve) => {\r\n\t\t\tthis.once('changed', () => resolve());\r\n\t\t\tPromise.all(this._waitFor).then(\r\n\t\t\t\t() => this.refresh(),\r\n\t\t\t\t() => this.reflectChanges({ clear: true })\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\treturn this.ready;\r\n\t},\r\n\tlogoff(options){\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tthis.once('changed', () => resolve());\r\n\t\t\tif (this.token) {\r\n\t\t\t\tthis.token.update(undefined, options);\r\n\t\t\t} else {\r\n\t\t\t\tthis.reflectChanges(_.extend({}, options, { clear: true }));\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t//override this for getting auth status\r\n\tgetState(){\r\n\t\treturn this.isLogged() ? 'auth' : 'anonym';\r\n\t},\r\n\tisLogged(){\r\n\t\treturn this.get('authenticated') === true;\r\n\t},\r\n\thasToken(){\r\n\t\treturn this.token && this.token.hasToken();\r\n\t},\r\n\trefresh(tokenOptions){\t\t\r\n\t\tif (this._refreshing) { return this._refreshing; }\r\n\t\tlet promise = this._refreshing = new Promise((resolve) => {\r\n\t\t\t\r\n\t\t\tlet currentAttrs = _.clone(this.attributes);\r\n\r\n\t\t\tif (!this.hasToken()) {\r\n\t\t\t\tthis.reflectChanges(_.extend({}, tokenOptions, { clear: true }), currentAttrs);\r\n\t\t\t\tresolve();\r\n\t\t\t} else {\r\n\t\t\t\t\r\n\t\t\t\tthis.fetch().then(() => {\r\n\t\t\t\t\tthis.reflectChanges(tokenOptions, currentAttrs);\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}, () => {\t\t\t\t\r\n\t\t\t\t\tthis.reflectChanges(_.extend({}, tokenOptions, { store: false }), currentAttrs);\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\t\t\r\n\t\tpromise.then(() => {\r\n\t\t\tdelete this._refreshing;\r\n\t\t});\r\n\t\treturn promise;\r\n\t},\r\n\treflectChanges(opts = {}, prevAttrs){\r\n\t\tlet { silent, clear, store = true } = opts;\r\n\t\tclear && this.clear();\r\n\t\tstore && this.store(clear);\r\n\t\tlet options = _.omit(opts, 'clear', 'store');\r\n\t\t!silent && this.trigger('changed', this, options);\r\n\t\tthis.afterReflectChanges(prevAttrs, opts);\r\n\t},\r\n\tafterReflectChanges(prevAttrs, opts) {},\r\n\tisMe(arg){\r\n\t\tlet me = this.get(this.idAttribute);\r\n\t\treturn _.isEqual(me, arg);\r\n\t},\r\n\t// implement by your own\r\n\tstore(){},\r\n});\r\n","import _ from 'underscore';\r\n\r\nimport { Model, ajax as _nativeAjax } from 'bbmn-core';\r\nimport Backbone from 'backbone';\r\n\r\nlet nativeAjax = _nativeAjax;\r\n\r\nconst tokenizedAjax = function(...args){\r\n\tlet options;\r\n\r\n\tif(args && args.length == 1 && _.isObject(args[0])){\r\n\t\toptions = args[0];\r\n\t}\r\n\tif(args && args.length == 2 && !_.isObject(args[0]) && _.isObject(args[1])){\r\n\t\toptions = args[1];\r\n\t}\r\n\r\n\toptions && (options.headers = _.extend({}, options.headers, this.getAjaxHeaders()));\r\n\r\n\treturn nativeAjax.apply(null, args);\r\n};\r\n\r\n\r\nconst Token = Model.extend({\r\n\r\n\ttokenAttribute: 'access_token',\r\n\trefreshTokenAttribute: 'refresh_token',\r\n\tendPoint: 'auth/token',\r\n\tsecondsOffset: 0,\r\n\r\n\tshouldRequestOnInitialize: true,\r\n\r\n\tconstructor(){\r\n\t\tthis.ajaxHeaders = {};\r\n\t\tthis.flows = {};\r\n\t\tthis.initializeFlows();\r\n\t\tthis.setExpiration(null);\r\n\r\n\t\tModel.apply(this, arguments);\r\n\r\n\t\tif (this.shouldRequestOnInitialize) {\r\n\t\t\tthis.getReady();\r\n\t\t}\r\n\t},\r\n\r\n\tgetReady(){\r\n\t\tif(this.ready) return this.ready;\r\n\t\t\r\n\t\tif (!this.hasToken()) {\r\n\t\t\tthis.ready = Promise.resolve();\r\n\t\t} else {\r\n\t\t\tthis.ready = this.refresh({force: true}).catch(() => {\r\n\t\t\t\tthis.update(null);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.ready;\r\n\t},\r\n\t\r\n\r\n\tinitializeFlows(){\r\n\r\n\t\tthis.setFlow('password', {\r\n\t\t\turl: this.endPoint,\r\n\t\t\tmethod: 'POST'\r\n\t\t});\r\n\t\tthis.setFlow('refresh', {\r\n\t\t\turl: this.endPoint,\r\n\t\t\tmethod: 'POST'\r\n\t\t});\r\n\r\n\t},\r\n\tgetFlow(key){\r\n\t\treturn _.clone(this.flows[key] || {});\r\n\t},\r\n\tsetFlow(key, value){\r\n\t\tthis.flows[key] = value;\r\n\t},\r\n\r\n\r\n\r\n\thasToken(){\r\n\t\treturn this.getToken() != null;\r\n\t},\r\n\tgetToken(){\r\n\t\treturn this.get(this.tokenAttribute);\r\n\t},\r\n\r\n\tgetRefreshToken(){\r\n\t\treturn this.get(this.refreshTokenAttribute);\r\n\t},\r\n\r\n\tgetAjaxHeaders(){\t\t\r\n\t\treturn this.ajaxHeaders;\r\n\t},\t\r\n\r\n\tparse(data){\r\n\t\treturn data;\r\n\t},\r\n\r\n\tfetch(options = {}, userOptions ) {\r\n\t\tif (this._fetching) return this._fetching;\t\t\r\n\t\tthis._fetching = nativeAjax(options).then(\r\n\t\t\t(json) => {\r\n\r\n\t\t\t\tlet parsed = this.parse(_.clone(json));\r\n\t\t\t\tthis.update(parsed, userOptions);\r\n\t\t\t\tdelete this._fetching;\r\n\t\t\t\treturn Promise.resolve(json);\r\n\t\t\t}, \r\n\t\t\t(xhr) => {\r\n\t\t\t\t\r\n\t\t\t\tdelete this._fetching;\r\n\t\t\t\t\r\n\t\t\t\toptions.clearOnFail !== false \r\n\t\t\t\t\t&& this.update(null, userOptions);\r\n\r\n\t\t\t\tlet error = this.handleError(xhr);\r\n\t\t\t\tif(error){\r\n\r\n\t\t\t\t\treturn Promise.reject(error);\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Promise.reject(xhr);\r\n\t\t\t\t}\r\n\t\t\t});\t\r\n\t\treturn this._fetching;\r\n\t},\r\n\thandleError(){},\r\n\tupdate(hash, opts = {}){\r\n\t\tlet { silent } = opts;\r\n\t\tif (hash == null) {\r\n\r\n\t\t\tthis.clear(opts);\r\n\r\n\t\t} else {\r\n\t\t\tlet fullhash = _.extend({}, this.attributes, hash);\r\n\t\t\tlet unset = [];\r\n\t\t\tlet shouldUnset = !!opts.unset;\r\n\t\t\tlet setHash = _(fullhash).reduce((memo, value, key) => {\r\n\t\t\t\tif (key in hash) {\r\n\t\t\t\t\tmemo[key] = value;\r\n\t\t\t\t} else if (shouldUnset) {\r\n\t\t\t\t\tunset.push(key);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmemo[key] = undefined;\r\n\t\t\t\t}\r\n\t\t\t\treturn memo;\r\n\t\t\t}, {});\r\n\r\n\t\t\tsetHash = this.parse(setHash);\r\n\t\t\tthis.set(setHash, { silent });\r\n\t\t\t_(unset).each(key => this.unset(key, { silent }));\r\n\t\t}\r\n\r\n\t\tlet reflectOptions = _.extend({}, _.omit(opts, 'silent', 'store'));\r\n\t\tthis.reflectTokenChanges(reflectOptions);\r\n\r\n\t},\r\n\r\n\treplaceBackboneAjax(){\t\t\r\n\t\tif(!this.hasToken())\r\n\t\t\tBackbone.ajax = nativeAjax;\r\n\t\telse\r\n\t\t\tBackbone.ajax = (...args) => this.ajax(...args);\r\n\t},\r\n\tupdateAjaxHeaders(token){\r\n\t\ttoken || (token = this.getToken());\r\n\t\tlet headers = this.getAjaxHeaders();\r\n\t\tif (token) {\r\n\t\t\theaders.Authorization = 'Bearer ' + token;\r\n\t\t\theaders.Accept = 'application/json';\r\n\t\t} else {\r\n\t\t\tdelete headers.Authorization;\r\n\t\t}\r\n\t},\r\n\r\n\t//implement by your own\r\n\tstoreToken(){},\r\n\r\n\treflectTokenChanges(opts = {}){\r\n\t\tlet { silent, store = true } = opts;\r\n\t\tthis.updateAjaxHeaders();\r\n\t\tthis.replaceBackboneAjax();\r\n\t\tif (store)\r\n\t\t\tthis.storeToken();\r\n\t\tif (!silent) {\r\n\t\t\tlet options = _.omit(opts, 'silent', 'store');\r\n\t\t\tthis.trigger('changed', options);\r\n\t\t}\r\n\t},\r\n\r\n\tajax(...args){\r\n\t\treturn this.refresh().then(\r\n\t\t\t() => tokenizedAjax.apply(this, args),\r\n\t\t\terror => Promise.reject(error)\r\n\t\t);\r\n\t},\t\r\n\trefresh(opts = {}){\t\t\r\n\r\n\t\t// if token is fresh enough and there is no force refresh\r\n\t\t// pass\r\n\t\tif (!this.isExpired() && !opts.force) {\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t\tlet options = this.getFlow('refresh');\r\n\t\toptions.data = this.getRefreshTokenData();\r\n\t\treturn this.fetch(options);\r\n\t},\r\n\tgetRefreshTokenData(){\r\n\t\treturn {\r\n\t\t\t'grant_type':'refresh_token',\r\n\t\t\t'refresh_token': this.getRefreshToken(),\r\n\t\t};\r\n\t},\r\n\r\n\tsetExpiration(arg){\r\n\r\n\t\tif (arg === null) {\r\n\t\t\tthis.expiresAt = null;\r\n\t\t}\r\n\r\n\t\tlet date;\r\n\t\tlet now = new Date();\r\n\r\n\t\tif (_.isDate(arg)) {\r\n\t\t\tdate = arg;\r\n\t\t} else if(_.isObject(arg)) {\r\n\t\t\tdate = new Date();\r\n\t\t\t\r\n\t\t\tlet { seconds, minutes, hours, days } = arg;\r\n\t\t\tdate.setDate(date.getDate() + (days || 0));\r\n\t\t\tdate.setHours(date.getHours() + (hours || 0));\r\n\t\t\tdate.setMinutes(date.getMinutes() + (minutes || 0));\r\n\t\t\tdate.setSeconds(date.getSeconds() + (seconds || 0));\r\n\t\t}\r\n\r\n\t\tif(!_.isDate(date) || isNaN(date.valueOf()) || date < now) {\r\n\t\t\tdate = new Date();\r\n\t\t\tdate.setSeconds(now.getSeconds() + 90);\r\n\t\t}\r\n\r\n\t\tthis.expiresAt = date;\r\n\t},\r\n\tgetExpiration(){\r\n\t\treturn this.expiresAt;\r\n\t},\r\n\tisExpired(){\r\n\t\tlet date = this.getExpiration();\r\n\t\tif(!_.isDate(date) || isNaN(date.valueOf()))\r\n\t\t\treturn true;\r\n\t\treturn date.valueOf() < Date.now() + (this.secondsOffset * 1000);\r\n\t},\r\n\tlogin(username, password, opts){\r\n\r\n\t\tlet options = this.getFlow('password');\r\n\t\toptions.data = { grant_type:'password', username, password };\r\n\t\toptions.clearOnFail = false;\r\n\t\treturn this.fetch(options, opts);\r\n\r\n\t},\r\n\r\n});\r\n\r\nToken.setNativeAjax = function(arg){\r\n\tlet old = nativeAjax;\r\n\tnativeAjax = arg;\r\n\treturn old;\r\n};\r\n\r\nexport default Token;\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\n\r\nimport { Events, BaseClass } from 'bbmn-core';\r\nimport { triggerMethod, getOption, mergeOptions, mix } from 'bbmn-utils';\r\n\r\nconst Stack = mix(BaseClass).with(Events).extend({\r\n\r\n\tdestroyOnRemove: true,\r\n\tremoveOnOutsideClick: true,\r\n\tremoveOnEsc: true,\r\n\tclearBeforeAdd: false,\r\n\r\n\tconstructor(options){\r\n\t\tthis.cid = _.uniqueId('stack');\r\n\t\tthis.unremovableKey = `_${this.cid}_preventRemove`;\r\n\t\tthis.options = options;\r\n\t\tthis.stack = [];\r\n\t\tBaseClass.apply(this, arguments);\t\t\t\r\n\t},\r\n\r\n\r\n\r\n\r\n\tadd(view, options){\r\n\t\tif(!_.isObject(view)) { return; }\r\n\t\tif (this.getOption('clearBeforeAdd')) {\r\n\t\t\tthis.removeAll();\r\n\t\t}\r\n\t\tthis.triggerMethod('before:add');\r\n\r\n\t\tthis.stack.push(view);\r\n\t\tthis._setupView(view, options);\r\n\r\n\t\tthis._stackChanged(1, view);\r\n\r\n\t},\r\n\t_setupView(view, { preventRemove } = {}){\r\n\t\tif (preventRemove) {\r\n\t\t\tlet key = this.getUnremovableKey();\r\n\t\t\tview[key] = true;\r\n\t\t}\r\n\t\tthis.listenToOnce(view, 'destroy', () => this._removeView(view, { selfDestroy: true }));\t\t\r\n\t},\t\r\n\r\n\tgetLast(){\r\n\t\treturn _.last(this.stack);\r\n\t},\r\n\r\n\r\n\tremoveLast(){\r\n\t\tlet view = this.getLast();\r\n\t\tthis.remove(view);\r\n\t},\r\n\tdestroyLast(){\r\n\t\tlet view = this.getLast();\r\n\t\tthis.remove(view, { destroy: true });\r\n\t},\r\n\tremove(view, { destroy } = {}){\r\n\t\tlet destroyOnRemove = this.getOption('destroyOnRemove');\r\n\t\tlet removed = this._removeView(view);\r\n\t\tif (removed && (destroy || destroyOnRemove)) {\r\n\t\t\tthis._destroyView(view);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeView(view, { selfDestroy } = {}){\r\n\t\tif (!_.isObject(view)) { return; }\r\n\r\n\t\tif (this.isViewUnremovable(view, selfDestroy)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._cleanUpView(view);\r\n\r\n\t\tlet index = this.stack.indexOf(view);\r\n\t\tif (index === -1) return;\r\n\r\n\t\tif (index == this.stack.length - 1)\r\n\t\t\tthis.stack.pop();\r\n\t\telse\r\n\t\t\tthis.stack.splice(index, 1);\r\n\t\t\t\r\n\t\tthis._stackChanged(-1);\r\n\r\n\t\treturn view;\r\n\t},\r\n\r\n\t_cleanUpView(view){\r\n\t\tthis.stopListening(view);\r\n\t\tdelete view[this.getUnremovableKey()];\r\n\t},\r\n\r\n\t_destroyView(view) {\r\n\t\tif (_.isObject(view) && _.isFunction(view.destroy)) { \r\n\t\t\tview.destroy();\r\n\t\t}\r\n\t},\r\n\r\n\t_stackChanged(change, view){\r\n\t\tif (change > 0) {\r\n\t\t\tthis._setDocumentListeners();\t\t\t\r\n\t\t\tthis.triggerMethod('add', view);\r\n\t\t} else {\r\n\t\t\tthis._unsetDocumentListeners();\t\t\t\r\n\t\t\tthis.triggerMethod('remove', view);\r\n\t\t}\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tUnremovable view methods\r\n\t\tsometimes you want to prevent view to be removed from the stack\t\t\r\n\t*/\r\n\tgetUnremovableKey(){\r\n\t\treturn this.getOption('unremovableKey');\r\n\t},\r\n\t// options is for internal use only.\r\n\t// self destroy flag filled when a view destroyed outside the stack\r\n\tisViewUnremovable(view, { selfDestroy } = {}){\r\n\t\tif (selfDestroy) return false;\r\n\t\tlet key = this.getUnremovableKey();\r\n\t\treturn view[key];\r\n\t},\t\t\r\n\r\n\t/*\r\n\t\tDOM listeners logic\r\n\t\t- esc handler\r\n\t\t- outside click handler\r\n\t*/\r\n\tgetViewDomElement(view){\r\n\t\treturn view && view.el;\r\n\t},\r\n\tisElementOutsideOfView(eventElement, view){\r\n\t\tlet viewElement = this.getViewDomElement(view);\r\n\t\tif (!viewElement) return;\r\n\t\treturn !$.contains(viewElement, eventElement);\r\n\t},\r\n\tgetViewIfElementOutside(eventElement){\r\n\t\tlet view = this.getLast();\r\n\t\tif (!view) return;\r\n\t\tif(this.isElementOutsideOfView(eventElement, view)) {\r\n\t\t\treturn view;\r\n\t\t}\r\n\t},\r\n\toutsideClickHandler(event){\r\n\t\tif (!this.stack.length) { return; }\r\n\r\n\t\tlet view = this.getViewIfElementOutside(event.target);\r\n\t\tif (!view) { return; }\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\t\tthis.remove(view);\r\n\r\n\t},\r\n\tescapePressHandler(event){\r\n\t\tif (!this.stack.length || event.keyCode !== 27 ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\t\tthis.removeLast();\r\n\r\n\t},\r\n\r\n\t_setDocumentListeners(){\r\n\t\tif (this._documentListeners || !this.stack.length) return;\r\n\t\tlet $doc = this.getDocument();\r\n\t\tif (this._shouldRemoveOnEsc()) {\t\t\t\r\n\t\t\tthis._escapePressHandler = _.bind(this.escapePressHandler, this);\r\n\t\t\t$doc.on('keyup', this._escapePressHandler);\r\n\t\t\tthis.triggerMethod('dom:listeners:escape:on');\r\n\t\t}\r\n\t\tif (this._shouldRemoveOnOutsideClick()) {\r\n\t\t\tthis._outsideClickHandler = _.bind(this.outsideClickHandler, this);\r\n\t\t\t$doc.on('click', this._outsideClickHandler);\r\n\t\t\tthis.triggerMethod('dom:listeners:click:on');\r\n\t\t}\r\n\t\tthis.triggerMethod('dom:listeners:on');\r\n\t\tthis._documentListeners = true;\r\n\t},\r\n\t_unsetDocumentListeners(){\r\n\t\tif (!(this._documentListeners && !this.stack.length)) return;\r\n\t\tlet $doc = this.getDocument();\r\n\t\tif (this._escapePressHandler) {\r\n\t\t\t$doc.off('keyup', this._escapePressHandler);\r\n\t\t\tdelete this._escapePressHandler;\r\n\t\t\tthis.triggerMethod('dom:listeners:escape:off');\r\n\t\t}\r\n\t\tif(this._outsideClickHandler) {\r\n\t\t\t$doc.off('click', this._outsideClickHandler);\r\n\t\t\tdelete this._outsideClickHandler;\r\n\t\t\tthis.triggerMethod('dom:listeners:click:off');\r\n\t\t}\r\n\t\tthis.triggerMethod('dom:listeners:off');\r\n\t\tthis._documentListeners = false;\r\n\t},\r\n\t_shouldRemoveOnEsc(){\r\n\t\treturn this.getOption('removeOnEsc') === true;\r\n\t},\r\n\t_shouldRemoveOnOutsideClick(){\r\n\t\treturn this.getOption('removeOnOutsideClick') === true;\r\n\t},\r\n\r\n\r\n\t/* helpers */\r\n\r\n\tmergeOptions,\r\n\ttriggerMethod,\r\n\tgetOption() { return getOption(this, ...arguments); },\r\n\r\n\tgetDocument(){\r\n\t\treturn this.$doc || $(document);\r\n\t},\r\n\tisDestroyed(){\r\n\t\treturn this._isDestroyed || this._isDestroying;\r\n\t},\r\n\tremoveAll(){\r\n\t\twhile(this.stack.length){\r\n\t\t\tthis.destroyLast();\r\n\t\t}\r\n\t},\r\n\tdestroy(){\r\n\t\tif(this._isDestroyed || this._isDestroying) { return; }\t\t\r\n\t\tthis._isDestroying = true;\r\n\r\n\t\tthis.triggerMethod('before:destroy');\r\n\r\n\t\tthis.removeAll();\r\n\r\n\t\tlet $doc = this.getDocument();\r\n\t\t$doc.off('keyup', this._onKeyUp);\r\n\t\t$doc.off('click', this._outsideClick);\r\n\r\n\t\tthis._isDestroyed = true;\r\n\t\tthis.triggerMethod('destroy');\r\n\t},\r\n\r\n\r\n});\r\n\r\nexport default Stack;\r\n","import _ from 'underscore';\r\nimport { BaseClass } from 'bbmn-core';\r\nconst _disallowedKeys = ['setItem', 'key', 'getItem', 'removeItem', 'clear'];\r\nconst allowedKey = key => _disallowedKeys.indexOf(key) < 0;\r\n\r\nconst FakeStore = BaseClass.extend({\r\n\tconstructor(){\r\n\t\tBaseClass.apply(this, arguments);\r\n\t\tthis.store = {};\r\n\t},\r\n\tsetItem(id, val) {\r\n\t\tif (!allowedKey(id)) return;\r\n\t\treturn this.store[id] = String(val);\r\n\t},\r\n\tgetItem(id) {\r\n\t\tif (!allowedKey(id)) return;\r\n\t\treturn this.store[id];\r\n\t},\r\n\tremoveItem(id) {\r\n\t\tif (!allowedKey(id)) return;\r\n\t\tdelete this.store[id];\r\n\t},\r\n\tclear() {\r\n\t\tlet keys = _(this).keys();\r\n\t\t_(keys).each(key => this.removeItem(key));\r\n\t}\r\n});\r\n\r\nexport default FakeStore;\r\n","import Fake from './fake.js';\r\n\r\nlet session = (typeof sessionStorage === 'undefined') \r\n\t? new Fake() : sessionStorage;\r\n\r\nlet local = (typeof localStorage === 'undefined') \r\n\t? new Fake() : localStorage;\r\n\r\nexport {\r\n\tsession,\r\n\tlocal\r\n};\r\n","import _ from 'underscore';\r\nimport { session, local } from './store.js';\r\n\r\nconst getStore = (opts = {}) => opts.local === true ? local : session;\r\n\r\nconst SECONDS = 1000;\r\nconst MINUTES = SECONDS * 60;\r\nconst HOURS = MINUTES * 60;\r\nconst DAYS = HOURS * 24;\r\n\r\nvar store = {\r\n\r\n\t_normalizeValue(value) {\r\n\t\tvar normValue = value;\r\n\t\tif (_.isObject(value) && _.isFunction(value.toJSON))\r\n\t\t\tnormValue = value.toJSON();\r\n\t\tif (_.isDate(value) && !_.isNaN(value.valueOf()))\r\n\t\t\tnormValue = 'date(' + normValue + ')';\r\n\t\treturn normValue;\r\n\t},\r\n\r\n\t_createItem(value, expireAt) {\r\n\t\treturn { expireAt: expireAt, value: value };\r\n\t},\r\n\r\n\tjsonParse(key, value) {\r\n\t\tvar datePattern = /^date\\((\\d{4,4}-\\d{2,2}-\\d{2,2}([T\\s]\\d{2,2}:\\d{2,2}:\\d{2,2}(\\.\\d*)?Z?)?)\\)$/;\r\n\t\tif (_.isString(value) && datePattern.test(value)) {\r\n\t\t\tvar textDate = value.replace(datePattern, '$1');\r\n\t\t\treturn new Date(textDate);\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t_jsonParse(key, value, context) {\r\n\t\tif (!key) return value;\r\n\t\treturn this.jsonParse(key, value, context);\r\n\t},\r\n\t_parse(raw) {\r\n\t\tlet _this = this;\r\n\t\tlet item = JSON.parse(raw, function (key, value) { return _this._jsonParse(key, value, this); });\r\n\t\tif ('expireAt' in item && 'value' in item)\r\n\t\t\treturn item;\r\n\t\telse\r\n\t\t\treturn this._createItem(item, 0);\r\n\t},\r\n\t_get(key, opts) {\r\n\t\tlet raw = getStore(opts).getItem(key);\r\n\t\tif (raw == null) return;\r\n\t\treturn this._parse(raw);\r\n\t},\r\n\tget(key, opts = {}) {\r\n\r\n\t\tlet { checkExpire = true } = opts;\r\n\r\n\t\tlet item = this._get(key, opts);\t\t\r\n\t\tif (item == null) return;\r\n\r\n\t\tlet expired = this._isExpired(item);\r\n\t\tif (!expired || !checkExpire) {\r\n\r\n\t\t\treturn item.value;\r\n\t\t}\r\n\t\telse if (expired) {\r\n\t\t\tthis.remove(key, opts);\r\n\t\t}\r\n\t},\r\n\tset(key, value, opts = {}) {\r\n\r\n\t\tlet expireAt = Date.now() + this.getExpireAt(opts);\r\n\t\tlet normValue = this._normalizeValue(value);\r\n\t\tlet item = this._createItem(normValue, expireAt);\r\n\t\tthis._set(key, item, opts);\r\n\t\t\r\n\t},\r\n\tremove(key, opts) {\r\n\t\tgetStore(opts).removeItem(key);\r\n\t},\r\n\texpire(key, opts) {\r\n\t\tlet item = this._get(key, opts);\r\n\t\tif (!item) return;\r\n\t\titem.expireAt = 0;\r\n\t\tthis._set(key, item, opts);\r\n\t},\r\n\tgetExpireAt ({ expireAt, seconds, minutes, hours, days }) {\r\n\t\tif (expireAt != null)\r\n\t\t\treturn expireAt;\r\n\r\n\t\tlet offset = 0;\r\n\r\n\t\t_.isNumber(seconds) && (offset += seconds * SECONDS);\r\n\t\t_.isNumber(minutes) && (offset += minutes * MINUTES);\r\n\t\t_.isNumber(hours) && (offset += hours * HOURS);\r\n\t\t_.isNumber(days) && (offset += days * DAYS);\r\n\r\n\t\toffset === 0 && (offset += 10 * MINUTES);\r\n\r\n\t\treturn offset;\r\n\t},\r\n\t_set(key, item, opts) {\r\n\t\tlet text = JSON.stringify(item);\r\n\t\tgetStore(opts).setItem(key, text);\r\n\t},\r\n\tisExpired(key, opts) {\r\n\t\tlet item = this._get(key, opts);\r\n\t\tif (item == null) return true;\r\n\t\treturn this._isExpired(item);\r\n\t},\r\n\t_isExpired(item) {\r\n\t\treturn item.expireAt < Date.now();\r\n\t},\r\n};\r\n\r\nexport default store;\r\n","import _ from 'underscore';\r\nimport { Model } from 'bbmn-core';\r\n\r\nconst NotifyModel = Model.extend({\r\n\tconstructor(){\r\n\t\tModel.apply(this, arguments);\r\n\t\tif(!_.isDate(this.get('date')))\r\n\t\t\tthis.set('date', new Date(), { silent: true });\t\r\n\r\n\t\tthis._setupDelays();\t\t\r\n\t},\r\n\t_setupDelays(){\r\n\t\tthis.on('change:viewedDelay', () => this._setDelay('viewed'));\r\n\t\tthis.on('change:removedDelay', () => this._setDelay('removed'));\r\n\t\tthis._setDelay('viewed');\r\n\t\tthis._setDelay('removed');\r\n\t\tthis.on('destroy', () => {\r\n\t\t\tthis._clearTimeout('viewed');\r\n\t\t\tthis._clearTimeout('removed');\r\n\t\t});\r\n\t},\r\n\t_clearTimeout(name){\r\n\t\tlet timeoutKey = name + 'Timeout';\r\n\t\tclearTimeout(this[timeoutKey]);\r\n\t},\r\n\t_setTimeout(name){\r\n\t\tlet delay = this.get(name + 'Delay');\r\n\t\tif (!_.isNumber(delay) || delay === 0) { return; }\r\n\t\tlet timeoutKey = name + 'Timeout';\r\n\t\tthis[timeoutKey] = setTimeout(() => {\r\n\t\t\tthis[name]();\r\n\t\t}, delay * 1000);\r\n\t},\r\n\t_setDelay(name){\r\n\t\tthis._clearTimeout(name);\r\n\t\tthis._setTimeout(name);\r\n\t},\r\n\r\n\r\n\t//we need to use id but there is no any endpoint behind\r\n\tisNew(){\r\n\t\treturn true;\r\n\t},\r\n\tisViewed(){\r\n\t\treturn this.get('viewed') === true;\r\n\t},\r\n\tsetViewed(){\r\n\t\tthis.set({\r\n\t\t\tviewed:true,\r\n\t\t\tviewedDelay: undefined\r\n\t\t});\r\n\t\tif (this.get('store') === false) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t},\t\r\n\tgetDate(){\r\n\t\treturn this.get('date');\r\n\t},\r\n\tremoved(){\r\n\t\tthis.trigger('removed');\r\n\t},\r\n\tviewed(){\r\n\t\tthis.trigger('viewed');\r\n\t},\r\n\tgetType(){\r\n\t\treturn this.get('type');\r\n\t},\r\n\tgetName(){\r\n\t\treturn this.get('name');\r\n\t}\r\n});\r\n\r\nexport default NotifyModel;\r\n","\r\nimport { Collection } from 'bbmn-core';\r\nimport Model from './model';\r\n\r\nconst Notifies = Collection.extend({\r\n\tmodel: Model,\r\n\thasNotViewed(){\r\n\t\tlet counts = this.getCount();\r\n\t\treturn !!counts.notViewed;\r\n\t},\r\n\tgetCount(){\r\n\t\treturn this.reduce((memo, model) => {\r\n\t\t\tmemo.total++;\r\n\t\t\tif(model.isViewed())\r\n\t\t\t\tmemo.viewed++;\r\n\t\t\telse\r\n\t\t\t\tmemo.notViewed++;\r\n\r\n\t\t\treturn memo;\r\n\t\t}, { total: 0, viewed: 0, notViewed: 0});\r\n\t},\r\n\tgetCountAsText(){\r\n\t\tlet counts = this.getCount();\r\n\t\tif(!counts.total) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\treturn counts.notViewed + '/' + counts.total;\r\n\t},\r\n\ttoggle(){\r\n\t\tthis.mode = this.mode != 'all' ? 'all' : 'notViewed';\r\n\t\tthis.trigger('toggle', this.mode);\r\n\t}\r\n\r\n});\r\n\r\nexport default new Notifies([]);\r\n","import _ from 'underscore';\r\nimport notifies from './notifies';\r\n\r\n\r\nexport default function notify(hash){\r\n\tlet model = notifies.get(hash);\r\n\tif(model) {\r\n\t\tmodel.wasShown = false;\r\n\t\thash.viewed = false;\r\n\t}\r\n\treturn notifies.add(hash, { merge: true, update: true});\r\n}\r\n\r\n\r\nfunction normalizeOptions(arg1){\r\n\tif(_.isString(arg1)) {\r\n\t\treturn { text: arg1 };\r\n\t} else if(_.isObject(arg1)) {\r\n\t\treturn arg1;\r\n\t}\r\n}\r\n\r\nnotify.wait = function(arg){\r\n\tlet options = _.extend({ \r\n\t\ttype: 'wait', id: _.uniqueId('waitNotify') \r\n\t}, \r\n\tnormalizeOptions(arg));\r\n\treturn notify(options);\r\n};\r\n\r\nnotify.error = function(arg){\r\n\tlet options = _.extend({ \r\n\t\ttype: 'error', id: _.uniqueId('waitNotify') \r\n\t}, \r\n\tnormalizeOptions(arg));\r\n\treturn notify(options);\r\n};\r\nnotify.success = function(arg){\r\n\tlet options = _.extend({ \r\n\t\ttype: 'success', id: _.uniqueId('waitNotify') \r\n\t}, \r\n\tnormalizeOptions(arg));\r\n\treturn notify(options);\r\n};\r\nnotify.message = function(arg){\r\n\tlet options = _.extend({ \r\n\t\ttype: 'message', \t\t\r\n\t\tid: _.uniqueId('waitNotify'),\r\n\t\tviewedDelay: 3,\r\n\t\tremovedDelay: 600\r\n\t}, \r\n\tnormalizeOptions(arg));\r\n\treturn notify(options);\r\n};\r\n","import _ from 'underscore';\r\nimport { CollectionView, View, AtomTextView } from '../views';\r\n\r\n\r\nconst IconView = View.extend({\r\n\tconstructor(){\r\n\t\tView.apply(this, arguments);\r\n\t\tthis.addCssClassModifier('icon');\r\n\t},\r\n\ttemplate: _.template('<i></i>'),\t\r\n});\r\n\r\nconst IconButtonView = View.extend({\r\n\ttagName: 'button',\r\n\tconstructor(){\r\n\t\tView.apply(this, arguments);\r\n\t\tthis.addCssClassModifier('icon-btn');\r\n\t},\r\n\ttemplate: _.template('<i></i>'),\t\r\n});\r\n\r\n\r\nconst NotifyView = CollectionView.extend({\r\n\trenderAllCustoms: true,\r\n\tcssClassModifiers:[\r\n\t\t() => 'notify',\r\n\t\tm => m.getType(),\t\t\r\n\t\tm => m.getName(),\r\n\t\tm => m.isViewed() ? 'viewed' : 'not-viewed',\r\n\t\tm => m.wasShown ? '' : 'accent'\r\n\t],\r\n\tcustoms:[\r\n\t\t(v) => v.getTypeView(),\r\n\t\t(v) => v.getMessageView(),\r\n\t\t(v) => v.getStateView()\r\n\t],\r\n\tevents:{\r\n\t\t'click .state':'changeModelState'\r\n\t},\r\n\tmodelEvents:{\r\n\t\t'viewed': 'markAsViewed',\r\n\t\t'removed': 'destroyModel',\r\n\t\t'change:text': 'render',\r\n\t},\r\n\tchangeModelState(){\r\n\t\tif(this.model.isViewed()) {\r\n\t\t\tthis.destroyModel();\r\n\t\t} else {\r\n\t\t\tthis.markAsViewed();\r\n\t\t}\r\n\t},\r\n\tdestroyModel(){\r\n\t\tthis.disappear().then(() => this.model.destroy());\r\n\t},\r\n\tmarkAsViewed(){\r\n\t\tif (this.getOption('mode') != 'all') {\r\n\t\t\tthis.disappear().then(() => this.model.setViewed());\r\n\t\t} else {\r\n\t\t\tthis.model.setViewed();\r\n\t\t}\r\n\t},\r\n\tdisappear() {\r\n\t\tlet promise = new Promise((resolve) => {\r\n\t\t\tif(this.isAttached()) {\r\n\t\t\t\tthis.$el.animate({\r\n\t\t\t\t\theight: 'toggle',\r\n\t\t\t\t\twidth: 'toggle',\r\n\t\t\t\t}, 500, resolve);\r\n\t\t\t} else {\r\n\t\t\t\tresolve();\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn promise;\t\t\r\n\t},\t\r\n\tonBeforeAttach(){\r\n\t\tthis.$el.attr('style','');\r\n\t},\r\n\tonBeforeRender(){\r\n\t\tthis.dismissAccent = false;\r\n\t},\r\n\tonRender(){\r\n\t\tif(!this.model.wasShown) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.model.wasShown = true;\r\n\t\t\t\tthis.refreshCssClass();\r\n\t\t\t}, 2000);\r\n\t\t}\r\n\t},\r\n\r\n\tgetTypeView(){\r\n\t\treturn new IconView({ className: 'type-icon' });\r\n\t},\r\n\tgetMessageView(){\r\n\t\treturn AtomTextView.byModel(this.model, { className: 'message' });\r\n\t},\r\n\tgetStateView(){\r\n\t\treturn new IconButtonView({ className: 'state' });\r\n\t},\r\n\r\n\r\n\r\n});\r\n\r\nexport default NotifyView;\r\n","import { CollectionView } from '../views';\r\nimport { nextCollectionViewMixin } from 'bbmn-mixins';\r\nimport notifies from './notifies';\r\nimport childView from './notify-view';\r\n\r\n\r\n\r\nconst Notifier = nextCollectionViewMixin(CollectionView).extend({\r\n\tinitialize(){\r\n\t\tthis.setFilter(this.unviewedFilter, { preventRender: true });\r\n\t\tthis.listenTo(this.collection, 'change:viewed', this.sort);\r\n\t},\r\n\tchildView,\r\n\tcollection: notifies,\r\n\tcollectionEvents: {\r\n\t\ttoggle() {\r\n\t\t\tlet current = this.getFilter();\r\n\t\t\tif(current == this.allFilter) {\r\n\t\t\t\tthis.setFilter(this.unviewedFilter, { preventRender: true });\r\n\t\t\t} else {\r\n\t\t\t\tthis.setFilter(this.allFilter, { preventRender: true });\r\n\t\t\t}\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t},\r\n\r\n\tviewComparator(v1,v2){\r\n\t\treturn v2.model.getDate() - v1.model.getDate();\r\n\t},\r\n\tallFilter(){\r\n\t\treturn true;\r\n\t},\r\n\tunviewedFilter(v){\r\n\t\treturn !v.model.isViewed();\r\n\t},\r\n\tchildViewOptions(){\r\n\t\treturn {\r\n\t\t\tmode: this.collection.mode\r\n\t\t};\r\n\t}\r\n});\r\n\r\n\r\nexport default Notifier;\r\n","import _ from 'underscore';\r\nimport { ModelSchemas } from '../model-schemas';\r\nimport notify from './notify';\r\n\r\nfunction convertOptionsToNotify(opts = {}){\r\n\tlet defs =_.pick(opts, 'notifyId', 'notifyStore');\r\n\tdefs = {\r\n\t\tid: defs.notifyId,\r\n\t\tstore: defs.notifyStore\r\n\t};\r\n\tlet raw = _.pick(opts, 'notifyWait', 'notifyError', 'notifySuccess');\r\n\tlet result = _.reduce(raw, (memo, val, key) => {\r\n\t\tlet parsedKey = key.replace(/^notify(\\w)/, (match, letter) => { return letter.toLowerCase(); });\r\n\t\tif(_.isString(val)){\r\n\t\t\tval = {\r\n\t\t\t\ttext: val\r\n\t\t\t};\r\n\t\t}\r\n\t\tmemo[parsedKey] = val;\r\n\t}, {});\r\n\tif (!_.size(result)) {\r\n\t\treturn;\r\n\t}\r\n\treturn _.extend(defs, result);\r\n}\r\n\r\nexport default Base => Base.extend({\r\n\tgetNotifyOptions(method, opts = {}){\r\n\t\tlet notify = convertOptionsToNotify(opts);\r\n\t\tlet schema = ModelSchemas.get(this);\r\n\t\tif (schema) {\r\n\t\t\tlet notifies = schema.getOption('notifies') || {};\r\n\t\t\tlet byMethod = notifies[method];\r\n\t\t\tnotify = _.extend({}, byMethod, notify);\r\n\t\t}\r\n\r\n\t\tif(!_.size(notify)) {\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\treturn notify;\r\n\t\t}\r\n\r\n\r\n\t},\r\n\tsync(method, model, options){\r\n\t\tlet notifyOptions = this.getNotifyOptions(method, options);\r\n\t\tlet note;\r\n\t\tif(notifyOptions && notifyOptions.wait){\r\n\t\t\tnote = notify.wait(notifyOptions.wait);\r\n\t\t}\r\n\t\tlet xhr = Base.prototype.sync.apply(this, arguments);\r\n\t\tif (!notifyOptions) {\r\n\t\t\treturn xhr;\r\n\t\t}\r\n\t\txhr.then(\r\n\t\t\t() => {\r\n\t\t\t\tif (!notifyOptions.success) {\r\n\t\t\t\t\tif (note) {\r\n\t\t\t\t\t\tnote.removed();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (note) {\r\n\t\t\t\t\tnotifyOptions.success.id = note.id;\r\n\t\t\t\t}\r\n\t\t\t\tnotify.success(notifyOptions.success);\r\n\t\t\t},\r\n\t\t\txhr => {\r\n\t\t\t\tif (!notify.error) {\r\n\t\t\t\t\tif (note) {\r\n\t\t\t\t\t\tnote.removed();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (note) {\r\n\t\t\t\t\tnotifyOptions.error.id = note.id;\r\n\t\t\t\t\tnotifyOptions.error.xhr = xhr;\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\tnotify.error(notifyOptions.error);\t\t\t\t\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn xhr;\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport { BaseClass, Model } from 'bbmn-core';\r\nimport { getByPath } from 'bbmn-utils';\r\n\r\nfunction createExec(actionInstance, actionMethod){\r\n\treturn function exec(instance, ...args){\r\n\t\tlet decline = actionInstance.isNotAllowed(instance, args);\r\n\t\tif (decline) {\r\n\t\t\treturn actionInstance.onExecuteNotAllowed(instance, decline, args);\r\n\t\t}\r\n\t\t\r\n\t\tif (_.isFunction(actionMethod)) {\r\n\t\t\treturn instance ? actionMethod.apply(instance, args) : actionMethod(...args);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn actionInstance.onActionMissing(instance);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n\r\nconst ActionModel = Model.extend({\r\n\tconstructor(attrs, options = {}){\r\n\t\t_.extend(this, _.pick(options, 'action','instance', 'order'));\r\n\t\tModel.apply(this, arguments);\r\n\t},\r\n\tdefaults: {\r\n\t\tname: undefined,\r\n\t\tlabel: undefined,\r\n\t\torder: 0,\r\n\t},\r\n\texec(){\r\n\t\tif (!this.action) {\r\n\t\t\tthrow new Error('no action under the hood');\t\t\t\r\n\t\t}\r\n\t\t// if(!this.instance) {\r\n\t\t// \tthrow new Error('no instance defined');\r\n\t\t// }\r\n\t\treturn this.action.exec(this.instance, ...arguments);\r\n\t}\r\n});\r\n\r\n\r\nconst instanceProperties = ['name', 'label', 'order', 'hidden'];\r\n\r\nconst Action = BaseClass.extend({\r\n\tconstructor(options = {}){\r\n\t\tlet { action } = options;\r\n\t\tdelete options.action;\r\n\t\t_.extend(this, _.pick(options, ...instanceProperties));\r\n\t\t\r\n\t\tthis.options = _.omit(options, ...instanceProperties);\r\n\t\t\r\n\t\tBaseClass.apply(this, arguments);\r\n\r\n\t\tthis.exec = createExec(this, action);\r\n\t},\r\n\r\n\tgetOption(key){\r\n\t\treturn getByPath(this.options, key);\r\n\t},\r\n\r\n\tgetLabel(){ return this.label || this.name; },\r\n\r\n\tis (arg) { return this == arg || this.name == arg; },\r\n\tisVisible () { return this.hidden !== true; },\r\n\tisHidden () { return this.hidden == true; },\r\n\t\r\n\tisNotAllowed () { },\r\n\tonExecuteNotAllowed () { },\r\n\tonActionMissing () { },\r\n\r\n\ttoModel(instance, attrs) {\r\n\t\t// if (instance == null)  {\r\n\t\t// \tthrow new Error('instance undefined and action model must have one');\r\n\t\t// }\r\n\t\tlet hash = _.extend({\r\n\t\t\tid: this.name, \r\n\t\t\tlabel: this.getLabel(), \r\n\t\t\torder: this.order \r\n\t\t}, attrs);\r\n\r\n\t\tlet options =  { \r\n\t\t\taction: this, \r\n\t\t\torder: this.order,\r\n\t\t\tinstance\r\n\t\t};\r\n\r\n\t\treturn new ActionModel(hash, options);\r\n\t}\r\n});\r\n\r\nexport default Action;\r\n","import _ from 'underscore';\r\nimport { BaseClass } from 'bbmn-core';\r\nimport BaseAction from './action.js';\r\nimport ClassStore from '../class-store';\r\n\r\nconst BaseActionStore = BaseClass.extend({\r\n\tconstructor(options = {}){\r\n\t\tBaseClass.apply(this, arguments)\r\n\t\t_.extend(this, options);\r\n\t\tif(!_.isFunction(this.buildAction)){\r\n\t\t\tthis.buildAction = i => i;\r\n\t\t}\r\n\t\tthis.actions = [];\r\n\t\tthis.actionsByNames = [];\r\n\t},\r\n\tbuildAction: raw => raw,\r\n\tregisterActions(raw){\r\n\t\t_.each(raw, item => this.registerAction(item));\r\n\t},\r\n\tregisterAction(raw){\r\n\t\tlet { actionsByNames, buildAction, Action } = this;\r\n\t\tlet options = _.pick(this, 'name', 'ctor', 'Action');\r\n\r\n\t\tlet action = this.buildAction(raw, options);\r\n\t\tif(_.isFunction(buildAction)){\r\n\t\t\taction = buildAction(action, options);\r\n\t\t}\r\n\t\tif (!action.name) return;\r\n\t\tif(!(action instanceof Action)){\r\n\t\t\taction = new Action(action);\r\n\t\t}\r\n\r\n\t\tif (!(action.name in actionsByNames)) {\r\n\t\t\tactionsByNames[action.name] = action;\r\n\t\t\tthis.actions.push(action);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nconst store = new ClassStore({\r\n\tAction: BaseAction,\r\n\tctorNameKey: '__actionsStoreName',\r\n\tinstanceNameKey: '__actionsStoreName',\r\n\tonExists: () => false,\r\n\tbuildStore(context, actions = [], { Action, buildAction } = {}) {\r\n\t\tAction || (Action = this.Action);\r\n\t\tlet { ctor, name } = context;\r\n\t\tlet store = new BaseActionStore({ name, ctor, buildAction, Action });\r\n\t\tstore.registerActions(actions);\t\t\r\n\t\treturn store;\r\n\t},\r\n\r\n\tinitialize(){\r\n\t\tlet store = this.createStore(...arguments);\r\n\t\treturn store.schema;\r\n\t},\r\n\t_preInit(arg, args){\r\n\t\tlet store = this.getStore(arg);\r\n\t\tif(!store) {\r\n\t\t\tstore = this.createStore(arg, [], ...args);\r\n\t\t}\r\n\t\treturn store;\r\n\t},\r\n\tregisterActions(arg, actions, ...createArguments){\r\n\t\tlet store = this._preInit(arg, createArguments);\r\n\t\tstore.registerActions(actions);\r\n\t},\r\n\tregisterAction(arg, action, ...createArguments){\r\n\t\tlet store = this._preInit(arg, createArguments);\r\n\t\tstore.registerAction(action);\r\n\t},\t\r\n\r\n\tgetActions(arg, options = {}){\r\n\t\tlet cache = this.getStore(arg);\r\n\t\tif(!cache) return [];\r\n\t\tvar actions = _.filter(cache.actions, (action, index) => this.filter(action, index, options));\r\n\t\tlet { asModels, instance } = options;\r\n\t\tif (asModels) {\r\n\t\t\treturn _.map(actions, action => action.toModel(instance));\r\n\t\t}\r\n\t\treturn actions;\r\n\t},\r\n\tgetAction(store, action){\r\n\t\tlet cache = this.getStore(store);\r\n\t\tif (!cache) return;\r\n\t\tlet name = _.isString(action) ? action : action.name;\r\n\t\treturn cache.actionsByNames[name];\r\n\t},\r\n\texec(store, action, instance, ...args) {\r\n\t\tlet found = this.getAction(store, action);\r\n\t\tif (!found) {\r\n\t\t\tthrow new Error('action not found:' + action);\r\n\t\t} else {\r\n\t\t\treturn found.exec(instance, ...args);\r\n\t\t}\r\n\t},\r\n\tfilter: () => true,\t\r\n});\r\n\r\n\r\nexport default store;\r\n","import _ from 'underscore';\r\n\r\nimport { betterResult } from 'bbmn-utils';\r\n\r\nimport ActionStore from './store.js';\r\n\r\n\r\nfunction getFromPrototypes(instance, property, { exclude, process } = {}) {\r\n\tif(exclude && !_.isArray(exclude)) {\r\n\t\texclude = [exclude];\r\n\t}\r\n\tif(!_.isFunction(process)) {\r\n\t\tprocess = value => value;\r\n\t}\r\n\tlet prototype = instance.__proto__;\r\n\tlet result = [];\r\n\twhile(prototype){\r\n\t\tlet value = prototype[property];\r\n\t\tprototype = prototype.__proto__;\r\n\r\n\t\tif (value == null) { continue; }\r\n\r\n\t\tif(exclude && exclude.indexOf(value) > -1) { continue; }\r\n\t\t\r\n\t\tvalue = process(value);\r\n\t\tif(value != null) {\r\n\t\t\tresult.push(value);\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\n\r\nfunction isProtoActionsRegistered(instance){\r\n\treturn instance.constructor.__protoActionsTaked == true;\r\n}\r\nfunction setProtoActionsAsRegistered(instance) {\r\n\tinstance.constructor.__protoActionsTaked = true;\r\n}\r\n\r\n\r\nexport default Base => Base.extend({\r\n\t_actionableMixin: true,\r\n\tinheritActions: false,\r\n\tActionClass: undefined,\r\n\r\n\t_initializeActionableActions(){\r\n\t\tlet protoActionsTaked = isProtoActionsRegistered(this);\r\n\t\tif (protoActionsTaked) return;\r\n\r\n\t\tlet instance = betterResult(this, 'actions', { args: [this], default: [] });\r\n\t\tlet inherited = [];\r\n\t\tif (this.inheritActions) {\r\n\t\t\tlet protoActions = getFromPrototypes(this, 'actions', {\r\n\t\t\t\texclude: this.actions,\r\n\t\t\t\tprocess: actions => betterResult({ actions }, 'actions', { args: [this], default: [] })\r\n\t\t\t});\r\n\t\t\tinherited.push(..._.flatten(protoActions));\r\n\t\t\tinherited = _.filter(inherited, f => f != null);\r\n\t\t}\r\n\t\tlet rawactions = [...inherited, ...instance];\r\n\r\n\t\tthis.registerActions(rawactions);\r\n\t\tsetProtoActionsAsRegistered(this);\r\n\r\n\t},\r\n\r\n\tbuildStoreAction: action => action,\r\n\tgetActions(options = {}){\r\n\t\tthis._initializeActionableActions();\r\n\t\tlet actions = ActionStore.getActions(this, _.extend({ instance: this }, options));\r\n\t\treturn actions;\r\n\t},\r\n\r\n\tregisterActions(actions){\r\n\t\tActionStore.registerActions(this, actions, {\r\n\t\t\tAction: this.ActionClass,\r\n\t\t\tbuildAction: raw => this.buildStoreAction(raw),\t\t\t\t\r\n\t\t});\r\n\t\t// if(this._actionableActionsInitialized || this._isActionsRegistered()) {\r\n\t\t// \tActionStore.registerActions(this, actions);\r\n\t\t// } else {\r\n\t\t// \tthis._actionsWaitingForRegister || (this._actionsWaitingForRegister = []);\r\n\t\t// \tthis._actionsWaitingForRegister.push(...actions);\r\n\t\t// }\r\n\t},\r\n\tregisterAction(...action){\r\n\t\tif(!action) return;\r\n\t\treturn this.registerActions(action);\r\n\t},\r\n\thasAction(arg, options){\r\n\t\tlet action = this.getAction(arg, options);\r\n\t\treturn !!action;\r\n\t},\r\n\tgetAction(arg, options){\r\n\t\tlet actions = this.getActions(options);\r\n\t\tlet iteratee = _.isString(arg) ? { name: arg } : { name: arg.name };\r\n\t\treturn _.findWhere(actions, iteratee);\r\n\t},\r\n\texecuteAction(action, ...rest){\r\n\t\tthis._initializeActionableActions();\r\n\t\treturn ActionStore.exec(this.actionsStoreName || this, action, this,  ...rest);\r\n\t},\r\n}, { ActionableMixin: true });\r\n","import _ from 'underscore';\r\n\r\nexport { default as Action } from './action.js';\r\nexport { default as ActionStore } from './store.js';\r\nexport { default as actionableMixin } from './actionable-mixin.js';\r\n\r\nexport function action(name, label, action, options = {}){\r\n\t// args: {}\r\n\tif (!_.isFunction(name) && _.isObject(name)) {\r\n\t\treturn name;\r\n\t} \r\n\t// args: \"\", ()\r\n\telse if (_.isFunction(label)) {\r\n\t\tlet o = { name, action: label };\r\n\t\treturn _.extend(o, action);\r\n\t} \r\n\t// args: (), {}\r\n\telse if (_.isFunction(name) && _.isObject(label)) {\r\n\r\n\t\treturn _.extend({ action: name }, label);\r\n\r\n\t}\r\n\t// args: \"\", \"\", (), {}\r\n\treturn _.extend({}, options, { name, label, action });\r\n}\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\n\r\nimport { View, CollectionView } from '../views';\r\nimport { isViewClass, buildViewByKey, mix } from 'bbmn-utils';\r\nimport { destroyViewMixin } from 'bbmn-mixins';\r\n\r\nexport const CloseButtonView = View.extend({\r\n\ttagName: 'button',\r\n\ttemplate: () => '<i></i>',\r\n});\r\n\r\nconst ButtonView = View.extend({\r\n\ttagName:'button',\r\n\ttemplate: _.template('<i></i><span><%= text %></span><i></i>'),\r\n\ttriggers:{\r\n\t\t'click':'click'\r\n\t},\r\n\ttemplateContext(){\r\n\t\treturn {\r\n\t\t\ttext: this.getOption('text')\r\n\t\t};\r\n\t}\r\n});\r\n\r\n\r\nexport const TextView = View.extend({\r\n\ttemplate: _.template('<%= text %>'),\r\n\ttemplateContext(){\r\n\t\treturn {\r\n\t\t\ttext: this.getOption('text', { args: [ this ]})\r\n\t\t};\r\n\t}\r\n});\r\n\r\nconst BaseModalView = mix(CollectionView).with(destroyViewMixin);\r\n\r\nexport const ModalView = BaseModalView.extend({\r\n\tconstructor({ promise } = {}){\r\n\t\tBaseModalView.apply(this, arguments);\r\n\t\tif (promise) {\r\n\t\t\tthis._isPromise = true;\r\n\t\t\tthis.promise = new Promise((resolve, reject) => {\r\n\t\t\t\tthis._resolve = resolve;\r\n\t\t\t\tthis._reject = reject;\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\twrapContent: true,\r\n\t\r\n\tchildViewContainer: '[data-modal-content]',\r\n\trenderAllCustoms: true,\r\n\t\r\n\trenderCollection: false,\r\n\tviewComparator: false,\r\n\r\n\ttemplateContext(){\r\n\t\treturn {\r\n\t\t\tshouldWrapContent: this.getOption('wrapContent') === true,\r\n\t\t};\r\n\t},\r\n\r\n\tevents:{\r\n\t\t'click'(event){\r\n\t\t\tif(this.getOption('preventRemove')) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet $el = $(event.target);\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tif ($el.closest('[data-modal-content]').length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.destroy();\r\n\t\t},\r\n\t\t'click [data-modal-close]'(event){\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t},\r\n\tcustoms:[\r\n\t\t(v) => v.createCloseButton(),\r\n\t\t(v) => v.takeOptionsView('header'),\r\n\t\t(v) => v.takeOptionsView('content'),\r\n\t\t(v) => v.takeOptionsView('footer'),\r\n\t],\r\n\tcreateCloseButton(){\r\n\t\tif (this.getOption('closeButton') === false || this.getOption('preventRemove')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet Button = this.getOption('CloseButtonView');\r\n\r\n\t\tif (!isViewClass(Button)) {\r\n\t\t\tthrow new Error('closeButtonView not defined, use `closeButton: false` or pass button view in options');\r\n\t\t}\r\n\r\n\t\treturn new Button({ attributes: { 'data-modal-close':'' } });\r\n\t},\r\n\tdefsOptionsForView(name, opts){\r\n\t\tlet defs = {};\r\n\t\tif (name == 'footer' && this._isPromise) {\r\n\t\t\tdefs = {\r\n\t\t\t\tresolve: this.getOption('confirmLabel'),\r\n\t\t\t\trejectSoft: this.getOption('cancelLabel'),\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn _.extend({}, opts, defs);\r\n\t},\r\n\ttakeOptionsView(key){\r\n\t\tlet tagName = ['header','footer'].indexOf(key) > -1 ? key : 'div';\r\n\t\tlet TextView = this.getOption('TextView');\r\n\t\tlet options = this.defsOptionsForView(key,{ tagName });\r\n\t\tlet view = buildViewByKey(this, key, { TextView, options });\r\n\r\n\t\tif(key === 'footer' && !view){\r\n\t\t\tif (this.getOption('promiseBar')) {\r\n\t\t\t\tview = new FooterView(options);\r\n\t\t\t\tthis.listenTo(view, {\r\n\t\t\t\t\t'resolve': () => {\r\n\t\t\t\t\t\tthis.triggerMethod('resolve', this.modalChildren.content);\r\n\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'reject': () => {\r\n\t\t\t\t\t\tthis.triggerMethod('reject', this.modalChildren.content);\r\n\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t!this.modalChildren && (this.modalChildren = {});\r\n\t\tthis.modalChildren[key] = view;\r\n\t\tif (key === 'content') {\r\n\t\t\tthis._initContentListeners(view);\r\n\t\t}\r\n\t\tif (this._isPromise && (key === 'footer' || key == 'content')) {\r\n\t\t\tthis._initPromiseListeners(view);\r\n\t\t}\r\n\t\treturn view;\r\n\t},\r\n\t_initPromiseListeners(view){\r\n\t\tthis.listenTo(view, {\r\n\t\t\t'resolve': arg => this.resolve(arg),\r\n\t\t\t'reject': arg => this.reject(arg),\t\t\t\r\n\t\t});\r\n\t},\r\n\t_initContentListeners(content){\r\n\t\tthis.listenTo(content, {\r\n\t\t\t'destroy': () => this.destroy(),\r\n\t\t\t'done': () => this.destroy(),\r\n\t\t});\r\n\t},\r\n\tresolve(arg){\r\n\t\tthis._resolve(arg);\r\n\t\tthis.promiseState = 'fulfilled';\r\n\t\tif (!this._isDestroying && !this._isDestroyed){\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t},\r\n\treject(arg){\r\n\t\tthis._reject(arg);\r\n\t\tthis.promiseState = 'rejected';\r\n\t\tif (!this._isDestroying && !this._isDestroyed){\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t},\r\n\tonDestroy(){\r\n\t\tif(this._isPromise && !this.promiseState) {\r\n\t\t\tthis.reject();\r\n\t\t}\r\n\t},\r\n\tattributes:{\r\n\t\t'data-modal': ''\r\n\t},\r\n});\r\n\r\n\r\nexport const FooterView = CollectionView.extend({\r\n\trenderAllCustoms: true,\r\n\ttagName:'footer',\r\n\tattributes:{\r\n\t\t'data-modal-content-footer':'confirm'\r\n\t},\r\n\tcustoms:[\r\n\t\tv => v.getResolveView(),\r\n\t\tv => v.getRejectView(),\r\n\t],\r\n\tgetResolveView(){\r\n\t\tlet text = this.getOption('resolveText');\r\n\t\tlet view = new ButtonView({\r\n\t\t\ttext,\r\n\t\t\tonClick: () => this.triggerClick(true)\r\n\t\t});\r\n\t\treturn view;\r\n\t},\r\n\tgetRejectView(){\r\n\t\tlet text = this.getOption('rejectText');\r\n\t\tlet view = new ButtonView({\r\n\t\t\ttext,\r\n\t\t\tonClick: () => this.triggerClick(false)\r\n\t\t});\r\n\t\treturn view;\r\n\t},\r\n\ttriggerClick(resolve){\r\n\t\tlet event = resolve ? 'resolve' : 'reject';\r\n\t\tlet arg = this.getOption(event + 'With');\r\n\t\tthis.trigger(event, arg);\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport { renderInNode, takeFirst } from 'bbmn-utils';\r\nimport ViewStack from '../view-stack';\r\nimport { CloseButtonView, ModalView, TextView } from './views';\r\n\r\n\r\nexport default {\r\n\t\r\n\ttemplate: _.template(`\r\n<div data-modal-bg></div>\r\n<% if(shouldWrapContent) {%><div data-modal-content-wrapper><%} %>\r\n<section data-modal-content></section>\r\n<% if(shouldWrapContent) {%></div><%} %>\r\n`),\r\n\r\n\tconfirmResolveText: 'confirm',\r\n\tconfirmRejectText: 'cancel',\r\n\tTextView,\r\n\tModalView,\r\n\tCloseButtonView,\r\n\r\n\tbuildView(options, showOptions = {}){\r\n\r\n\t\tlet ModalView = takeFirst('ModalView', options, showOptions, this);\r\n\t\tlet TextView = takeFirst('TextView', options, showOptions, this);\r\n\t\tlet CloseButtonView = takeFirst('CloseButtonView', options, showOptions, this);\t\t\r\n\t\t\r\n\t\toptions = _.extend({ \r\n\t\t\tTextView, \r\n\t\t\tCloseButtonView,\r\n\t\t\ttemplate: this.template,\r\n\t\t}, options);\r\n\r\n\t\treturn new ModalView(options);\r\n\t},\r\n\r\n\trender(view, stack, options = {}){\r\n\r\n\t\tlet el = _.result(this, 'container');\r\n\t\tif(el && el.jquery){\r\n\t\t\tel = el.get(0);\r\n\t\t}\r\n\t\toptions = _.extend({ \r\n\t\t\tel, replaceElement: true, destroyOnEmpty: true,\t\t\t\r\n\t\t}, options);\r\n\r\n\t\trenderInNode(view, options);\r\n\r\n\t\tif (stack) {\r\n\t\t\tlet { preventRemove } = options;\r\n\t\t\t_.defer(() => stack.add(view, { preventRemove }));\r\n\t\t}\r\n\t},\r\n\tcontainer: () => document.querySelector('body'),\r\n\tstackOptions: {\r\n\t\tremoveOnEsc: true,\r\n\t\tremoveOnOutsideClick: true,\r\n\t},\r\n\tgetStack(options){\r\n\t\tif (!this.stack) {\r\n\t\t\tlet stackOptions = this.stackOptions || options;\r\n\t\t\tthis.stack = new ViewStack(stackOptions);\r\n\t\t}\r\n\t\treturn this.stack;\r\n\t}\r\n};\r\n\r\n","import config from './config.js';\r\nimport _ from 'underscore';\r\nimport { FooterView } from './views';\r\nimport { takeFirst, isView } from 'bbmn-utils';\r\n\r\nfunction show(opts = {}, showOptions = {}){\r\n\tif(isView(opts)){\r\n\t\topts = {\r\n\t\t\tcontent: opts\r\n\t\t};\r\n\t}\r\n\tif(!opts.attributes){\r\n\t\topts.attributes = {\r\n\t\t\t'data-modal': opts.modalType || ''\r\n\t\t};\r\n\t}\r\n\r\n\tlet modal = config.buildView(opts, showOptions);\r\n\r\n\r\n\tconfig.render(modal, config.getStack(), showOptions);\r\n\r\n\tif (showOptions.returnAsPromise && opts.promise) {\r\n\t\treturn modal.promise;\r\n\t} else {\r\n\t\treturn modal;\r\n\t}\r\n\r\n\r\n}\r\n\r\n\r\nfunction normalizeConfirmFooter(opts = {}){\r\n\tif (!opts.footer) {\r\n\t\topts.footer = FooterView;\r\n\t}\r\n\r\n\tif(!opts.footerOptions) {\r\n\t\topts.footerOptions = {};\r\n\t}\r\n\r\n\tlet fopts = opts.footerOptions;\r\n\tfopts.resolveWith = takeFirst('resolveWith', fopts, opts);\r\n\tfopts.rejectWith = takeFirst('rejectWith', fopts, opts);\r\n\tfopts.resolveText = takeFirst('resolveText', fopts, opts) || config.confirmResolveText;\r\n\tfopts.rejectText = takeFirst('rejectText', fopts, opts) || config.confirmRejectText;\t\r\n\treturn opts;\r\n}\r\n\r\nfunction confirm(arg, showOptions = {}) {\r\n\tif (_.isString(arg)) {\r\n\t\targ = {\r\n\t\t\tcontent: arg\r\n\t\t};\r\n\t} else if (!_.isObject(arg)) {\r\n\t\targ = {};\r\n\t}\r\n\tif(arg.text && !arg.content) {\r\n\t\targ.content = arg.text;\r\n\t}\r\n\targ.promise = true;\r\n\tif(showOptions.returnAsPromise == null) {\r\n\t\tshowOptions.returnAsPromise = true;\r\n\t}\r\n\targ.modalType = 'confirm';\r\n\targ = normalizeConfirmFooter(arg);\r\n\r\n\treturn show(arg, showOptions);\r\n}\r\n\r\n\r\nexport default {\r\n\tconfig,\r\n\tshow,\r\n\tconfirm\r\n};\r\n","\r\nimport _ from 'underscore';\r\nimport { isView } from 'bbmn-utils';\r\n\r\nexport const initSelectorMixin = Base => Base.extend({\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeSelector();\r\n\t},\r\n\tgetSelector(){\r\n\t\treturn this.getOption('selector');\r\n\t},\t\r\n\tbuildChildView(child, ChildViewClass, childViewOptions = {}){\r\n\t\tlet selector = this.getSelector();\r\n\t\tif(selector) {\r\n\t\t\t_.extend(childViewOptions, {\r\n\t\t\t\tselectable: true,\r\n\t\t\t});\r\n\t\t}\r\n\t\tlet view = Base.prototype.buildChildView(child, ChildViewClass, childViewOptions);\r\n\t\tif(selector) {\r\n\t\t\tif (view.addCssClassModifier) {\r\n\t\t\t\tview.addCssClassModifier(m => selector.isSelected(m) ? 'selected' : '');\r\n\t\t\t}\r\n\t\t\tthis.listenTo(view, 'toggle:select', this._handleChildviewToggleSelect);\r\n\t\t}\r\n\t\treturn view;\r\n\t},\r\n\t_initializeSelector(){\r\n\t\tif (this._selectorMixinInitialized) return;\r\n\t\tlet selector = this.getSelector();\r\n\t\tif(selector){\r\n\t\t\tthis.listenTo(selector, 'change', changes => {\r\n\t\t\t\t_.invoke(changes.selected, 'trigger', 'change');\r\n\t\t\t\t_.invoke(changes.unselected, 'trigger', 'change');\r\n\t\t\t\tthis.triggerMethod('selector:change');\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis._selectorMixinInitialized = true;\r\n\t},\r\n\t_handleChildviewToggleSelect(arg1, arg2) {\r\n\t\tlet view = isView(arg1) ? arg1 : arg2;\r\n\t\tlet event = isView(arg1) ? arg2 : arg1;\r\n\t\t\r\n\t\tevent && event.stopPropagation && event.stopPropagation();\r\n\r\n\t\tlet selector = this.getSelector();\r\n\t\tif (!selector.isMultiple() || !this.lastClickedModel || !event.shiftKey) {\r\n\t\t\tthis.lastClickedModel = view.model;\r\n\t\t\tselector.toggle(view.model);\r\n\t\t} else {\r\n\t\t\tlet lastclicked = this.lastClickedModel;\r\n\t\t\tdelete this.lastClickedModel;\r\n\t\t\tselector.toggleRange(view.model, lastclicked);\r\n\t\t}\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\n\r\nimport { BaseClass, Events, isCollection } from 'bbmn-core';\r\nimport { Collection, Model } from 'backbone';\r\nimport { mix, mergeOptions } from 'bbmn-utils';\r\n\r\nconst trueFilter = () => true;\r\n\r\nconst BaseSelector = mix(BaseClass).with(Events);\r\n\r\nconst Selector = BaseSelector.extend({\r\n\tconstructor(options = {}){\r\n\t\tthis.options = _.clone(options);\r\n\t\tmergeOptions.call(this, options, 'source', 'extractValue', 'sourceFilter');\r\n\t\tthis._isMultiple = options.multiple === true;\r\n\t\tBaseSelector.apply(this, arguments);\r\n\t\tthis._initializeSource();\r\n\t\tthis._createCollections();\r\n\t\tthis._setupModel();\r\n\t},\r\n\tsourceFilter: trueFilter,\r\n\tsetSourceFilter(filter){\r\n\t\tif (!_.isFunction(filter)) {\r\n\t\t\tfilter = trueFilter;\r\n\t\t}\r\n\t\tif(filter != this.sourceFilter){\r\n\t\t\tthis.sourceFilter = filter;\r\n\t\t\tthis._updateAll();\r\n\t\t}\r\n\t},\r\n\tsetSourceModels(models){\r\n\t\tthis._updateAll(models);\r\n\t},\r\n\tgetSourceModels(){\r\n\t\treturn this.source.filter(this.sourceFilter);\r\n\t},\r\n\t_initializeSource(){\r\n\t\tif (!_.isObject(this.source)) {\r\n\t\t\tthis.source = new Collection();\r\n\t\t\treturn;\r\n\t\t} else if(isCollection(this.source)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tlet models = _.map(this.source, (value, ind) => {\r\n\t\t\tif(_.isObject(value)) {\r\n\t\t\t\treturn value;\r\n\t\t\t} else {\r\n\t\t\t\treturn {id : ind, value };\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.source = new Collection(models);\r\n\t\tif(this.options.extractValue == null) {\r\n\t\t\tthis.extractValue = model => model.id;\r\n\t\t}\r\n\t},\r\n\t_createCollections(){\r\n\t\tlet initialSelected = this.options.value == null ? [] : this.options.value;\r\n\t\tif(!_.isArray(initialSelected)) {\r\n\t\t\tinitialSelected = [initialSelected];\r\n\t\t}\r\n\t\tlet models = this.getSourceModels();\r\n\t\tthis.all = new Collection(models);\r\n\t\tthis.listenTo(this.source, 'update reset', this._updateAll);\r\n\r\n\t\tlet selected = _.reduce(initialSelected, (memo, initial) => {\r\n\t\t\tlet found = this.all.get(initial);\r\n\t\t\tif(found) {\r\n\t\t\t\tmemo.push(found);\r\n\t\t\t}\r\n\t\t\treturn memo;\r\n\t\t}, []);\r\n\t\tthis.selected = new Collection(selected);\r\n\t},\r\n\t_updateAll(col){\r\n\t\tlet models = col && col.models;\r\n\t\tif(!models) {\r\n\t\t\tmodels = this.getSourceModels();\r\n\t\t}\r\n\t\tthis.all.set(models, { remove: true, add: true, merge: true});\r\n\t},\r\n\t_setupModel(){\r\n\t\tthis.model = new Model();\r\n\t\tthis.model.clear = () => this.clear();\r\n\t\tthis.on('change', () => {\r\n\t\t\tthis.model.set('count', this.getCount());\r\n\t\t});\r\n\t},\r\n\r\n\tisSelected(arg){\r\n\t\treturn this.selected.has(arg);\r\n\t},\t\r\n\tisMultiple(){\r\n\t\treturn this._isMultiple;\r\n\t},\r\n\tgetCount(){\r\n\t\treturn this.selected.length;\r\n\t},\r\n\tgetCollection(){\r\n\t\treturn this.all;\r\n\t},\r\n\tgetCollections(){\r\n\t\treturn {\r\n\t\t\tcollection: this.all,\r\n\t\t\tselected: this.selected\r\n\t\t};\r\n\t},\r\n\r\n\t_trigger(event, model, { silent, silentChange, changes } = {}){\r\n\t\tif (silent) { return; }\r\n\t\tlet value = this.extractValue(model);\r\n\t\tthis.trigger(event, value);\r\n\t\tif (!silentChange) {\r\n\t\t\tlet mass = {\r\n\t\t\t\t[event]: [model]\r\n\t\t\t};\r\n\t\t\tif (changes && changes.unselected) {\r\n\t\t\t\tmass.unselected || (mass.unselected = []);\r\n\t\t\t\tmass.unselected.push(...changes.unselected);\r\n\t\t\t}\r\n\t\t\tif (changes && changes.selected) {\r\n\t\t\t\tmass.selected || (mass.selected = []);\r\n\t\t\t\tmass.selected.push(...changes.selected);\r\n\t\t\t}\r\n\t\t\tthis._triggerChange(mass);\r\n\t\t}\r\n\t},\r\n\t_triggerChange({ selected = [], unselected = [] } = {}){\r\n\t\tif (selected.length + unselected.length) {\r\n\t\t\tthis.trigger('change', { selected, unselected }, this.getCount());\r\n\t\t}\r\n\t},\r\n\tunselect(arg){\t\t\r\n\t\tlet model = this.all.get(arg);\r\n\t\tif(!model) return;\r\n\t\treturn this._unselect(model);\r\n\t},\r\n\t_unselect(model, options){\r\n\t\tlet exist = this.selected.has(model);\r\n\t\tif (!exist) return;\r\n\t\tlet affected = this.selected.remove(model);\r\n\t\tthis._trigger('unselected', model, options);\r\n\t\treturn affected;\r\n\t},\r\n\r\n\tselect(arg){\r\n\t\tlet model = this.all.get(arg);\r\n\t\tif(!model) return;\r\n\t\treturn this._select(model);\r\n\t},\r\n\t_select(model, options = {}){\r\n\t\tlet exist = this.selected.has(model);\r\n\t\tif (exist) return;\r\n\t\t\r\n\t\tlet affected;\r\n\r\n\t\tif (this.isMultiple()) {\r\n\t\t\taffected = this.selected.add(model);\r\n\t\t} else {\r\n\t\t\tlet current = this.selected.first();\r\n\t\t\tlet unselected = [];\r\n\t\t\tif (current == exist) { return; }\r\n\r\n\t\t\tif (current) {\r\n\t\t\t\tlet uns = this._unselect(current, _.extend({}, options, { silentChange: false }));\r\n\t\t\t\tunselected.push(uns);\r\n\t\t\t}\r\n\r\n\t\t\taffected = this.selected.set(model, { remove: true, merge:true, add:true });\r\n\t\t\toptions.changes || (options.changes = {});\r\n\t\t\toptions.changes.unselected || (options.changes.unselected = []);\r\n\t\t\toptions.changes.unselected.push(...unselected);\r\n\t\t}\r\n\t\tthis._trigger('selected', model, options);\r\n\t\treturn affected;\r\n\t},\r\n\r\n\ttoggle(arg){\r\n\t\tlet model = this.all.get(arg);\r\n\t\tif(!model) return;\r\n\t\treturn this._toggle(model);\r\n\t},\r\n\t_toggle(model, options){\r\n\t\tlet affected;\r\n\t\tlet key;\r\n\t\tlet result = { selected: [], unselected: [] };\r\n\t\tif(this.selected.has(model)){\r\n\t\t\taffected = this._unselect(model, options);\r\n\t\t\tkey = 'unselected';\r\n\t\t} \r\n\t\telse {\r\n\t\t\taffected = this._select(model, options);\r\n\t\t\tkey = 'selected';\r\n\t\t}\r\n\t\tresult[key].push(affected);\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_processRange(from, to, takeAction){\r\n\t\tfrom = this.all.get(from);\r\n\t\tto = this.all.get(to);\r\n\t\tif(!from || !to) return;\r\n\t\tlet _toIndex = this.all.indexOf(to);\r\n\t\tlet indexes = [this.all.indexOf(from), _toIndex];\r\n\t\tlet fromIndex = _.min(indexes);\t\t\r\n\t\tlet toIndex = _.max(indexes);\r\n\t\tlet processed = [];\r\n\t\tfor(let x = fromIndex; x <= toIndex; x++){\r\n\t\t\tif(x === _toIndex) continue;\r\n\r\n\t\t\tlet model = this.all.models[x];\r\n\t\t\tif(!model) continue;\r\n\t\t\tlet affected = takeAction(model);\r\n\t\t\tprocessed.push(affected);\r\n\t\t}\r\n\t\treturn processed;\r\n\t},\r\n\r\n\tselectRange(from, to) {\r\n\t\tlet result = { selected: [], unselected: [] };\r\n\t\tlet actionOptions = { silent: true };\r\n\t\tlet action = model => {\r\n\t\t\tlet affected = this._select(model, actionOptions);\r\n\t\t\tif (affected) {\r\n\t\t\t\tresult.selected.push(affected);\r\n\t\t\t}\r\n\t\t\treturn affected;\r\n\t\t};\r\n\t\tthis._processRange(from, to, action);\r\n\t\tthis._triggerChange(result);\r\n\t\treturn result;\r\n\t},\r\n\tunselectRange(from, to) {\r\n\t\tlet result = { selected: [], unselected: [] };\r\n\t\tlet actionOptions = { silent: true };\r\n\t\tlet action = model => {\r\n\t\t\tlet affected = this._unselect(model, actionOptions);\r\n\t\t\tif (affected) {\r\n\t\t\t\tresult.unselected.push(affected);\r\n\t\t\t}\r\n\t\t\treturn affected;\r\n\t\t};\r\n\t\tthis._processRange(from, to, action);\r\n\t\tthis._triggerChange(result);\r\n\t\treturn result;\r\n\t},\r\n\ttoggleRange(from, to) {\r\n\t\tlet result = { selected: [], unselected: [] };\r\n\t\tlet actionOptions = { silent: true };\r\n\t\tlet action = model => {\r\n\t\t\tlet toggled = this._toggle(model, actionOptions);\r\n\t\t\tresult.selected.push(...toggled.selected);\r\n\t\t\tresult.unselected.push(...toggled.unselected);\r\n\t\t\treturn toggled;\r\n\t\t};\r\n\t\tthis._processRange(from, to, action);\r\n\t\tthis._triggerChange(result);\r\n\t\treturn result;\r\n\t},\r\n\tclear(){\r\n\t\tlet result = {\r\n\t\t\tunselected: _.clone(this.selected.models),\r\n\t\t};\r\n\t\tthis.selected.reset();\r\n\t\tthis._triggerChange(result);\r\n\t},\r\n\r\n\tgetValue(){\r\n\t\tlet results = this.selected.map(model => this.extractValue(model));\r\n\t\tif (this.isMultiple()){\r\n\t\t\treturn results;\r\n\t\t} \r\n\t\telse {\r\n\t\t\treturn results[0];\r\n\t\t}\r\n\t},\r\n\r\n\textractValue(model) {\r\n\t\treturn model;\r\n\t}\r\n\r\n});\r\n\r\n\r\n\r\nexport * from './init-selector-mixin';\r\n\r\nexport default Selector;\r\n"],"names":["isPromisable","arg","Promise","_","isFunction","then","asArray","isArray","race","promises","valueToPromise","result","resolve","reject","registerProcess","Process","context","name","opts","process","extend","concurrent","concurrencyCheck","run","BaseClass","apply","arguments","_initDefaults","_initCancelation","_mergeOptions","Error","isObject","cid","uniqueId","errors","cancelPromise","cancel","options","omit","each","value","key","exposeSelf","previous","getProcessFromContext","promise","updateProcessInContext","args","_createLifeCyclePromise","_notCanceled","_begin","_beforeStart","_canBeStarted","_waitOtherPromises","triggerComplete","catch","triggerError","error","jsError","getJsError","_cancelationRace","_getHookResultAsPromise","contextMethod","invokeOnContext","all","hookName","procMethod","camelCase","procHook","undefined","cntxHook","triggerOnContext","onComplete","triggerEnd","push","onError","filter","f","getContextProcessKey","eventName","trigger","event","triggerArgs","triggerMethodOn","methodName","method","betterResult","register","defaultStartableOptions","contextState","keyValue","storeState","ensureState","processingName","processedName","restoreState","shouldThrow","other","status","defaultStartOptions","defaultStopOptions","Base","_initializeStartable","_startableInitialized","startable","getOption","start","stop","isNotIddle","isStarted","StartableMixin","BaseApp","mix","with","Events","startableMixin","clone","_startPromises","initialize","triggerMethod","map","item","call","callback","layoutView","isRendered","renderLayout","layout","buildLayout","region","getRegion","show","buildViewByKey","_region","buildRegion","Region","isClass","_buildRegion","RegionClass","regionClass","newOptions","el","replaceElement","Schema","property","modelSchema","order","schema","hash","model","default","functions","_getByKey","type","multiple","label","getDisplay","editOptions","valueOptions","getType","getLabel","compiled","val","defaults","allValues","toJSON","display","transform","sourceValues","isString","toBool","some","getFlag","isEmptyValue","ifEmpty","ignoreIfEmpty","ifNotEmpty","ignoreIfNotEmpty","depended","dependOn","split","findWhere","getDependedOn","silent","dependedValue","getProperty","set","properties","setProperties","PropertySchema","props","getProperties","size","createProperty","propertyName","setProperty","toArray","sort","p1","p2","getPropertiesArray","pluck","create","_createProperty","_setProperty","getValidation","arr","prop","resetValues","ClassStore","_createStore","createStore","instanceNameKey","ctorNameKey","items","isExists","onExists","getCreateStoreContext","rest","store","buildStore","setStore","generate","getStoreByCtor","getStoreByInstance","getStore","instance","getStoreByName","constructor","ctor","find","setStoreNameOn","getStoreName","ModelSchema","cache","Model","ModelSchemas","get","getSchema","getPropertySchema","getDisplayValue","_initializeRenderOnModelChange","romc","listenTo","render","BaseView","View","optionsMixin","cssClassModifiersMixin","ExtView","BaseCollectionVIew","CollectionView","customsMixin","emptyFetchMixin","improvedIndexesMixin","ExtCollectionVIew","templates","template","AtomText","addCssClassModifier","m","v","_hasAnyProperty","isFull","isLabeledText","getHeader","_getText","getTopText","getSmallText","getBottomText","arg1","arg2","defs","uopts","text","keys","values","reduce","memo","has","TextView","BackboneView","shouldEscapeValue","customValue","setValue","preventRender","applyPropertyValue","setNodeValue","asIs","toString","escape","innerHTML","getValue","getPropertyValue","useDisplay","_isDestroyed","_isDestroying","off","remove","rules","chunks","left","right","length","test","valueIn","indexOf","valueNotIn","shouldBeEqual","compare","shouldNotBeEqual","ruleValue","minLength","isNumber","maxLength","minValue","numValue","parseFloat","maxValue","pattern","RegExp","isRegExp","reIndex","sortBefore","a","b","index","rule","normalizeValidationContext","required","validate","getRuleContexts","founded","taken","found","message","check","ruleContext","skipIfInvalid","buildMessage","validateOptions","contexts","rulesPromise","removeRule","findIndex","removed","splice","setRule","setMessage","_waitFor","initializeToken","shouldRequestOnInitialize","getReady","token","refresh","ready","once","reflectChanges","clear","update","isLogged","hasToken","tokenOptions","_refreshing","currentAttrs","attributes","fetch","prevAttrs","afterReflectChanges","me","idAttribute","isEqual","nativeAjax","_nativeAjax","tokenizedAjax","headers","getAjaxHeaders","Token","ajaxHeaders","flows","initializeFlows","setExpiration","force","setFlow","endPoint","getToken","tokenAttribute","refreshTokenAttribute","data","userOptions","_fetching","json","parsed","parse","xhr","clearOnFail","handleError","fullhash","unset","shouldUnset","setHash","reflectOptions","reflectTokenChanges","Backbone","ajax","Authorization","Accept","updateAjaxHeaders","replaceBackboneAjax","storeToken","isExpired","getFlow","getRefreshTokenData","getRefreshToken","expiresAt","date","now","Date","isDate","seconds","minutes","hours","days","setDate","getDate","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","isNaN","valueOf","getExpiration","secondsOffset","username","password","grant_type","setNativeAjax","old","Stack","unremovableKey","stack","view","removeAll","_setupView","_stackChanged","preventRemove","getUnremovableKey","listenToOnce","_removeView","selfDestroy","last","getLast","destroy","destroyOnRemove","_destroyView","isViewUnremovable","_cleanUpView","pop","stopListening","change","_setDocumentListeners","_unsetDocumentListeners","eventElement","viewElement","getViewDomElement","$","contains","isElementOutsideOfView","getViewIfElementOutside","target","preventDefault","stopPropagation","keyCode","removeLast","_documentListeners","$doc","getDocument","_shouldRemoveOnEsc","_escapePressHandler","bind","escapePressHandler","on","_shouldRemoveOnOutsideClick","_outsideClickHandler","outsideClickHandler","document","destroyLast","_onKeyUp","_outsideClick","_disallowedKeys","allowedKey","FakeStore","id","String","removeItem","session","sessionStorage","Fake","local","localStorage","SECONDS","MINUTES","HOURS","DAYS","normValue","expireAt","datePattern","textDate","replace","jsonParse","raw","_this","JSON","_jsonParse","_createItem","getItem","_parse","checkExpire","_get","expired","_isExpired","getExpireAt","_normalizeValue","_set","offset","stringify","setItem","NotifyModel","_setupDelays","_setDelay","_clearTimeout","timeoutKey","delay","setTimeout","_setTimeout","Notifies","Collection","counts","getCount","notViewed","total","isViewed","viewed","mode","notify","notifies","wasShown","add","merge","normalizeOptions","wait","success","IconView","IconButtonView","NotifyView","getName","getTypeView","getMessageView","getStateView","destroyModel","markAsViewed","disappear","setViewed","isAttached","$el","animate","attr","dismissAccent","refreshCssClass","className","AtomTextView","byModel","Notifier","nextCollectionViewMixin","setFilter","unviewedFilter","collection","current","getFilter","allFilter","v1","v2","convertOptionsToNotify","pick","notifyId","notifyStore","parsedKey","match","letter","toLowerCase","byMethod","notifyOptions","getNotifyOptions","note","prototype","sync","createExec","actionInstance","actionMethod","exec","decline","isNotAllowed","onExecuteNotAllowed","onActionMissing","ActionModel","attrs","action","instanceProperties","Action","getByPath","hidden","BaseActionStore","buildAction","i","actions","actionsByNames","registerAction","BaseAction","registerActions","createArguments","_preInit","asModels","toModel","getAction","getFromPrototypes","exclude","__proto__","isProtoActionsRegistered","__protoActionsTaked","setProtoActionsAsRegistered","protoActionsTaked","inherited","inheritActions","protoActions","flatten","rawactions","_initializeActionableActions","ActionStore","getActions","ActionClass","buildStoreAction","iteratee","actionsStoreName","ActionableMixin","o","CloseButtonView","ButtonView","BaseModalView","destroyViewMixin","ModalView","_isPromise","_resolve","_reject","closest","createCloseButton","takeOptionsView","Button","isViewClass","tagName","defsOptionsForView","FooterView","modalChildren","content","_initContentListeners","_initPromiseListeners","promiseState","getResolveView","getRejectView","triggerClick","showOptions","takeFirst","jquery","destroyOnEmpty","defer","querySelector","stackOptions","ViewStack","isView","modalType","modal","config","buildView","getStack","returnAsPromise","normalizeConfirmFooter","footer","footerOptions","fopts","resolveWith","rejectWith","resolveText","confirmResolveText","rejectText","confirmRejectText","confirm","initSelectorMixin","_initializeSelector","child","ChildViewClass","childViewOptions","selector","getSelector","buildChildView","isSelected","_handleChildviewToggleSelect","_selectorMixinInitialized","invoke","changes","selected","unselected","isMultiple","lastClickedModel","shiftKey","toggle","lastclicked","toggleRange","trueFilter","BaseSelector","Selector","_isMultiple","_initializeSource","_createCollections","_setupModel","sourceFilter","_updateAll","models","source","isCollection","ind","extractValue","initialSelected","getSourceModels","initial","col","silentChange","mass","_triggerChange","_unselect","exist","affected","_trigger","_select","first","uns","_toggle","from","to","takeAction","_toIndex","indexes","fromIndex","min","toIndex","max","processed","x","actionOptions","_processRange","toggled","reset","results"],"mappings":"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"}