{"version":3,"file":"index.js","sources":["process/helpers.js","process/register.js","process/process.js","process/startable-mixin.js","app/index.js"],"sourcesContent":["import _ from 'underscore';\r\n\r\nexport function isPromisable(arg){\r\n\treturn arg instanceof Promise || _.isFunction(arg && arg.then);\r\n}\r\n\r\nexport function asArray(arg) {\r\n\tif(_.isArray(arg))\r\n\t\treturn arg;\r\n\telse if(arg == null || arg === '')\r\n\t\treturn [];\r\n\telse\r\n\t\treturn [arg];\r\n}\r\n\r\nexport function race(...promises){\r\n\treturn Promise.race(promises);\r\n}\r\n\r\nexport function valueToPromise(arg){\r\n\tif(!isPromisable(arg)) {\r\n\t\tlet result = arg;\r\n\t\targ = arg == null || arg === '' ? Promise.resolve() : Promise.reject(result);\r\n\t}\r\n\treturn arg;\t\t\r\n}\r\n","import _ from 'underscore';\r\nexport default function registerProcess (Process, context, name, opts) {\r\n\r\n\tcontext[name] = function(...args){\r\n\t\t\r\n\t\tlet process = new Process(context, name, _.extend({}, opts));\r\n\t\tlet concurrent = process.concurrencyCheck();\r\n\r\n\t\tif (concurrent)\r\n\t\t\treturn concurrent;\r\n\t\telse\r\n\t\t\treturn process.run(...args);\r\n\r\n\t};\r\n\r\n}\r\n","import _ from 'underscore';\r\nimport { triggerMethodOn, camelCase, betterResult as result } from 'bbmn-utils';\r\nimport { isPromisable, race, asArray, valueToPromise } from './helpers.js';\r\nimport { BaseClass } from 'bbmn-core';\r\n\r\nimport register from './register.js';\r\n\r\n\r\nconst Process = BaseClass.extend({\r\n\tconstructor(context, name, opts){\r\n\t\t\r\n\t\tBaseClass.apply(this, arguments);\r\n\r\n\t\tthis._initDefaults(name, context);\r\n\t\tthis._initCancelation();\r\n\t\tthis._mergeOptions(opts);\r\n\t},\r\n\r\n\r\n\t// initialize methods\r\n\r\n\t_initDefaults(name, context){\r\n\t\tif(name == null || name === '')\r\n\t\t\tthrow new Error('Process requires two arguments: name [string], context [object]. name missing');\r\n\t\t\r\n\t\tif(!_.isObject(context))\r\n\t\t\tthrow new Error('Process requires two arguments: name [string], context [object]. context is not an object');\r\n\r\n\t\tthis.cid = _.uniqueId('process');\r\n\t\tthis.name = name;\r\n\t\tthis.context = context;\r\n\t\tthis.errors = [];\r\n\t},\r\n\r\n\t_initCancelation(){\r\n\t\tthis.cancelPromise = new Promise((resolve, reject) => {\r\n\t\t\tthis.cancel = () => reject('cancel'); \r\n\t\t});\r\n\t},\r\n\t_mergeOptions(opts = {}){\r\n\t\tlet options = _.omit(opts, 'cid', 'name', 'context', 'cancelPromise', 'cancel', 'errors');\r\n\t\t_(options).each((value, key) => this[key] = value);\r\n\t},\r\n\r\n\t\r\n\tconcurrencyCheck(){\r\n\r\n\t\tlet previous = this.getProcessFromContext();\r\n\t\t//console.log(previous, this.context);\r\n\t\tif(!previous) return;\r\n\t\r\n\t\tlet concurrent = this.concurrent;\t\r\n\t\t\r\n\t\tif (concurrent === false) {\r\n\t\r\n\t\t\tthis.cancel();\r\n\t\r\n\t\t} else if (concurrent == 'first') {\r\n\t\r\n\t\t\treturn previous.promise;\r\n\t\r\n\t\t} else if (concurrent == 'last') {\r\n\t\r\n\t\t\tprevious.cancel();\r\n\t\r\n\t\t}\t\t\r\n\t},\r\n\r\n\r\n\t// life cycle methods\t\r\n\r\n\trun(...args){\r\n\t\tthis.updateProcessInContext(this);\r\n\t\tthis.args = args || [];\r\n\t\tthis.promise = this._createLifeCyclePromise();\r\n\t\treturn this.promise;\r\n\t},\r\n\r\n\r\n\t_createLifeCyclePromise(){\r\n\r\n\r\n\t\treturn this._notCanceled()\r\n\t\t\t.then(() => this._begin())\r\n\t\t\t.then(() => this._beforeStart())\r\n\t\t\t.then(() => this._canBeStarted())\r\n\t\t\t.then(() => this._waitOtherPromises())\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis.triggerComplete();\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t})\r\n\t\t\t.catch(error => {\r\n\t\t\t\tthis.triggerError(error);\r\n\t\t\t\tlet jsError;\r\n\t\t\t\tif(error instanceof Error) {\r\n\t\t\t\t\tthrow error;\r\n\t\t\t\t} else if ((jsError = this.getJsError())) {\r\n\t\t\t\t\tthrow jsError;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Promise.reject(this);\r\n\t\t\t\t}\r\n\t\t\t});\t\t\r\n\t},\r\n\r\n\r\n\r\n\r\n\t_notCanceled() {\r\n\t\treturn this._cancelationRace(Promise.resolve());\r\n\t},\r\n\t_begin(){\r\n\t\treturn this._getHookResultAsPromise('begin');\r\n\t},\r\n\t_beforeStart(){\r\n\t\treturn this._getHookResultAsPromise('before');\r\n\t},\r\n\t_canBeStarted(){\r\n\t\tlet contextMethod = 'can:not:' + this.name;\r\n\t\tlet promise = this.invokeOnContext(contextMethod);\r\n\t\tif(!isPromisable(promise)) {\r\n\t\t\tpromise = (promise == null || promise === '') \r\n\t\t\t\t? Promise.resolve()\r\n\t\t\t\t: Promise.reject(promise);\r\n\t\t}\r\n\t\treturn this._cancelationRace(promise);\r\n\t},\r\n\t_waitOtherPromises(){\r\n\t\tlet contextMethod = `get:${this.name}:promises`;\r\n\t\t\r\n\t\tlet promises = asArray(this.invokeOnContext(contextMethod));\r\n\r\n\t\treturn this._cancelationRace(Promise.all(promises));\r\n\t},\r\n\r\n\t_getHookResultAsPromise(hookName){\r\n\t\tlet procMethod = camelCase('on:' + hookName);\r\n\t\tlet procHook = _.isFunction(this[procMethod]) && this[procMethod](this.context, ...this.args) || undefined;\r\n\t\tlet result = valueToPromise(procHook).then(() => {\r\n\t\t\tlet cntxHook = this.triggerOnContext(hookName);\r\n\t\t\treturn valueToPromise(cntxHook);\r\n\t\t});\r\n\r\n\t\treturn this._cancelationRace(result);\r\n\r\n\t},\r\n\r\n\t// trigger methods\r\n\r\n\ttriggerComplete() { \r\n\r\n\t\tthis.updateProcessInContext(null);\r\n\r\n\t\tif (_.isFunction(this.onComplete))\r\n\t\t\tthis.onComplete(this.context, ...this.args);\r\n\r\n\t\tthis.triggerOnContext();\r\n\r\n\t\tthis.triggerEnd();\r\n\t\t\r\n\t\r\n\t},\r\n\ttriggerError(errors){\r\n\r\n\r\n\t\tthis.updateProcessInContext(null);\t\t\r\n\r\n\t\tif(!_.isArray(errors))\r\n\t\t\terrors = [errors];\r\n\r\n\t\tthis.errors.push(...errors);\r\n\r\n\t\t\r\n\t\tif (_.isFunction(this.onError))\r\n\t\t\tthis.onError(this.context, ...this.errors);\r\n\t\t\r\n\t\tthis.triggerOnContext('error', ...this.errors);\r\n\t\t\r\n\t\tthis.triggerEnd();\r\n\r\n\t\t\r\n\t},\r\n\ttriggerEnd(){\r\n\t\tthis.triggerOnContext('end');\r\n\t},\r\n\r\n\r\n\r\n\t// helpers methods\r\n\r\n\tgetJsError(context){\r\n\t\t!context && (context = this);\r\n\t\tif(context != this && (!_.isObject(context) || !_.isArray(context.errors)))\r\n\t\t\treturn;\r\n\r\n\t\treturn _(context.errors).filter(f => f instanceof Error)[0];\r\n\t},\t\r\n\r\n\t_cancelationRace(promise){\r\n\t\treturn race(this.cancelPromise, promise);\r\n\t},\r\n\r\n\r\n\tgetContextProcessKey(){\r\n\t\treturn camelCase(`_process:${this.name}:executing`);\r\n\t},\r\n\tgetProcessFromContext(){\r\n\t\tlet key = this.getContextProcessKey();\r\n\t\treturn this.context[key];\r\n\t},\r\n\tupdateProcessInContext(process){\r\n\t\tlet key = this.getContextProcessKey();\t\t\r\n\t\tthis.context[key] = process;\r\n\t},\r\n\r\n\r\n\r\n\ttriggerOnContext (eventName) {\r\n\t\r\n\t\tlet context = this.context; \r\n\t\tif(!_.isFunction(context.trigger))\r\n\t\t\treturn;\r\n\t\t\r\n\t\tlet event = (eventName ? eventName + ':' : '') + this.name;\r\n\t\t\r\n\t\treturn triggerMethodOn(context, event, this, ...this.args);\r\n\t\r\n\t},\r\n\r\n\tinvokeOnContext(methodName)\r\n\t{\r\n\t\tlet method = camelCase(methodName);\r\n\t\tlet context = this.context;\r\n\t\tlet args = this.args;\r\n\t\treturn result(context, method, { args });\r\n\r\n\t}\r\n\r\n}, {\r\n\tregister(context, name, opts) {\r\n\t\treturn register(this, context, name, opts);\r\n\t}\r\n});\r\n\r\n\r\n// Process.register = function(context, name, opts) {\r\n// \treturn register(this, context, name, opts);\r\n// };\r\n\r\nexport default Process;\r\n","import _ from 'underscore';\r\nimport Process from './process.js';\r\nimport { getOption } from 'bbmn-utils';\r\n\r\nconst defaultStartableOptions  = {\r\n\tconcurrent: false,\r\n\r\n\t//good place to supply own state collecting logic\r\n\tstoreState(){\r\n\r\n\t\tthis.contextState = [{\r\n\t\t\tkey: 'startable.status',\r\n\t\t\tvalue: this.context['startable.status']\r\n\t\t}];\r\n\r\n\r\n\t\t/*\r\n\r\n\t\tfor example: take all simple values from context\r\n\r\n\t\tfor(var key in this.context){\r\n\t\t\tlet value = this.context[key];\r\n\t\t\tif (value == null || !_.isObject(value.valueOf()))\r\n\t\t\t\tthis.contextState.push({ key, value });\r\n\t\t}\r\n\r\n\t\t*/\r\n\r\n\t},\r\n\trestoreState(){\r\n\t\t_(this.contextState || []).each(keyValue => {\r\n\t\t\tthis.context[keyValue.key] = keyValue.value;\r\n\t\t});\r\n\t},\r\n\tonBefore(...args){\r\n\t\tthis.storeState();\r\n\t\tthis.ensureState();\r\n\t\tthis.context['startable.status'] = this.processingName;\r\n\t\tthis.context['startable.start.lastArguments'] = args;\r\n\t},\r\n\tonComplete(){\r\n\t\tthis.context['startable.status'] = this.processedName;\r\n\t},\t\r\n\tonError(){\r\n\t\tthis.restoreState();\r\n\t},\r\n\tensureState(shouldThrow = true){\r\n\t\tlet other = this.name == 'start' ? 'stop' : 'start';\r\n\t\tlet error = this.name == 'start' ? 'not:stopped' : 'not:started';\r\n\t\tlet status = this.context['startable.status'];\r\n\t\tswitch(status){\r\n\t\tcase 'stopping':\r\n\t\tcase 'starting':\r\n\t\t\tif(shouldThrow) throw new Error('not:iddle');\r\n\t\t\telse return 'not:iddle';\r\n\t\tcase 'iddle':\r\n\t\t\tif(this.name == 'start') return;\r\n\t\t\telse if(shouldThrow) throw new Error(error);\r\n\t\t\telse return error;\r\n\t\tcase other:\r\n\t\t\tif(shouldThrow) throw new Error(error);\r\n\t\t\telse return error;\t\t\t\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst defaultStartOptions  = {\r\n\tprocessingName: 'starting',\r\n\tprocessedName: 'started'\r\n};\r\nconst defaultStopOptions  = {\r\n\tprocessingName: 'stopping',\r\n\tprocessedName: 'stopped'\r\n};\r\n\r\n\r\n\r\nexport default Base => Base.extend({\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeStartable();\r\n\t},\r\n\t_initializeStartable(){\r\n\t\tif (this._startableInitialized) return;\r\n\r\n\t\tlet startable = _.extend({}, defaultStartableOptions, getOption(this, 'startableOptions', {args:[this]}));\r\n\r\n\t\tlet start = _.extend({}, startable, defaultStartOptions, getOption(this, 'startOptions', {args:[this]}));\r\n\t\tlet stop = _.extend({}, startable, defaultStopOptions, getOption(this, 'stopOptions', {args:[this]}));\r\n\r\n\t\tProcess.register(this, 'start', start);\r\n\t\tProcess.register(this, 'stop', stop);\r\n\t\t\r\n\t\tthis._startableInitialized = true;\r\n\t},\r\n\tisStarted(){\r\n\t\treturn this['startable.status'] === 'started';\r\n\t},\r\n\tisStopped(){\r\n\t\treturn this['startable.status'] === 'stopped' || this['startable.status'] === 'iddle';\r\n\t},\r\n\tisNotIddle(){\r\n\t\treturn this['startable.status'] === 'stopping' || this['startable.status'] === 'starting';\r\n\t},\r\n\trestart(){\r\n\t\tif(this.isNotIddle())\r\n\t\t\tthrow new Error('Restart not allowed while startable instance is not iddle: ', this['startable.status']);\r\n\t\tlet stop = this.isStarted() ? this.stop() : Promise.resolve();\r\n\t\tlet args = this['startable.start.lastArguments'] || [];\r\n\t\treturn stop.then(() => this.start(...args));\r\n\t}\t\r\n},{ StartableMixin: true });\r\n","import _ from 'underscore';\r\nimport { BaseClass, Events, Region, isClass } from 'bbmn-core';\r\nimport { StartableMixin } from '../process/index.js';\r\nimport { mix, getOption, triggerMethod, buildViewByKey } from 'bbmn-utils';\r\n\r\nconst BaseApp = mix(BaseClass).with(Events, StartableMixin);\r\n\r\nexport default BaseApp.extend({\r\n\tconstructor(options = {}){\r\n\t\tthis.options = _.clone(options);\r\n\t\tthis._startPromises = [];\r\n\t\tBaseApp.apply(this, arguments);\r\n\t\tthis.initialize(options);\r\n\t\tthis.triggerMethod('initialize', options);\t\r\n\t},\r\n\ttriggerMethod,\r\n\tgetOption(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t},\r\n\tgetStartPromises(){\r\n\t\t\r\n\t\tif(!this._startPromises) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn _.map(this._startPromises, item =>{\r\n\t\t\tif (_.isFunction(item)) {\r\n\t\t\t\treturn item.call(this);\r\n\t\t\t} else {\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\taddStartPromise(...args){\r\n\t\tthis._startPromises.push(...args);\r\n\t},\r\n\tinitialize:() => {},\r\n\tdoOnResolve(promise, callback, ...args){\r\n\t\treturn promise.then(() => {\r\n\t\t\treturn callback.apply(this, args);\r\n\t\t});\r\n\t},\r\n\trenderLayout(options){\r\n\t\tif (!this.layoutView) {\r\n\t\t\tlet layout = this.buildLayout(options);\r\n\t\t\tif(!layout) { return; }\r\n\r\n\t\t\t//Mn v4 has this little bug, if layout is pointed to exist element and its equal reqion el render will not happens\r\n\t\t\tif(layout._isRendered && _.isFunction(layout.template)) {\r\n\t\t\t\tlayout._isRendered = false;\r\n\t\t\t}\r\n\r\n\t\t\tthis.layoutView = layout;\r\n\t\t}\r\n\t\tlet region = this.getRegion();\r\n\t\tregion.show(this.layoutView);\r\n\t},\r\n\tbuildLayout(options){\r\n\t\treturn buildViewByKey(this, 'layout', { options });\r\n\t},\r\n\tgetRegion(){\r\n\t\tif (this._region) return this._region;\r\n\t\tthis._region = this.buildRegion();\r\n\t\treturn this._region;\r\n\t},\r\n\t_buildRegion(region, options){\r\n\t\tif (region == null) {\r\n\t\t\treturn new Region(options);\r\n\t\t} else if (isClass(region, Region)) {\r\n\t\t\treturn new region(options);\r\n\t\t} else if (_.isFunction(region)) {\r\n\t\t\treturn this._buildRegion(region.call(this, this), options);\r\n\t\t} else if (_.isObject(region)) {\r\n\t\t\tlet RegionClass = region.regionClass || Region;\r\n\t\t\tlet newOptions = _.extend({}, _.omit(region, 'regionClass'));\r\n\t\t\tif(!newOptions.el) {\r\n\t\t\t\tnewOptions.el = options.el;\r\n\t\t\t}\r\n\t\t\tif(newOptions.replaceElement == null) {\r\n\t\t\t\tnewOptions.replaceElement = options.replaceElement;\r\n\t\t\t}\r\n\t\t\treturn new RegionClass(newOptions);\r\n\t\t}\r\n\t},\r\n\tbuildRegion(){\r\n\t\tlet el = this.getOption('appEl') || 'body';\r\n\t\tlet opts = { el, replaceElement: true };\r\n\t\treturn this._buildRegion(this.getOption('region', { args: [this] }), opts);\r\n\t},\r\n});\r\n"],"names":["isPromisable","arg","Promise","_","isFunction","then","asArray","isArray","race","promises","valueToPromise","result","resolve","reject","registerProcess","Process","context","name","opts","process","extend","concurrent","concurrencyCheck","run","BaseClass","apply","arguments","_initDefaults","_initCancelation","_mergeOptions","Error","isObject","cid","uniqueId","errors","cancelPromise","cancel","options","omit","each","value","key","previous","getProcessFromContext","promise","updateProcessInContext","args","_createLifeCyclePromise","_notCanceled","_begin","_beforeStart","_canBeStarted","_waitOtherPromises","triggerComplete","catch","triggerError","error","jsError","getJsError","_cancelationRace","_getHookResultAsPromise","contextMethod","invokeOnContext","all","hookName","procMethod","camelCase","procHook","undefined","cntxHook","triggerOnContext","onComplete","triggerEnd","push","onError","filter","f","getContextProcessKey","eventName","trigger","event","triggerMethodOn","methodName","method","register","defaultStartableOptions","contextState","keyValue","storeState","ensureState","processingName","processedName","restoreState","shouldThrow","other","status","defaultStartOptions","defaultStopOptions","Base","_initializeStartable","_startableInitialized","startable","getOption","start","stop","isNotIddle","isStarted","StartableMixin","BaseApp","mix","with","Events","clone","_startPromises","initialize","triggerMethod","map","item","call","callback","layoutView","layout","buildLayout","_isRendered","template","region","getRegion","show","buildViewByKey","_region","buildRegion","Region","isClass","_buildRegion","RegionClass","regionClass","newOptions","el","replaceElement"],"mappings":";;;;AAEO,SAASA,YAAT,CAAsBC,GAAtB,EAA0B;QACzBA,eAAeC,OAAf,IAA0BC,EAAEC,UAAF,CAAaH,OAAOA,IAAII,IAAxB,CAAjC;;;AAGD,AAAO,SAASC,OAAT,CAAiBL,GAAjB,EAAsB;KACzBE,EAAEI,OAAF,CAAUN,GAAV,CAAH,EACC,OAAOA,GAAP,CADD,KAEK,IAAGA,OAAO,IAAP,IAAeA,QAAQ,EAA1B,EACJ,OAAO,EAAP,CADI,KAGJ,OAAO,CAACA,GAAD,CAAP;;;AAGF,AAAO,SAASO,IAAT,GAA0B;mCAATC,QAAS;UAAA;;;QACzBP,QAAQM,IAAR,CAAaC,QAAb,CAAP;;;AAGD,AAAO,SAASC,cAAT,CAAwBT,GAAxB,EAA4B;KAC/B,CAACD,aAAaC,GAAb,CAAJ,EAAuB;MAClBU,SAASV,GAAb;QACMA,OAAO,IAAP,IAAeA,QAAQ,EAAvB,GAA4BC,QAAQU,OAAR,EAA5B,GAAgDV,QAAQW,MAAR,CAAeF,MAAf,CAAtD;;QAEMV,GAAP;;;ACvBc,SAASa,eAAT,CAA0BC,OAA1B,EAAmCC,OAAnC,EAA4CC,IAA5C,EAAkDC,IAAlD,EAAwD;;SAE9DD,IAAR,IAAgB,YAAiB;;MAE5BE,UAAU,IAAIJ,OAAJ,CAAYC,OAAZ,EAAqBC,IAArB,EAA2Bd,EAAEiB,MAAF,CAAS,EAAT,EAAaF,IAAb,CAA3B,CAAd;MACIG,aAAaF,QAAQG,gBAAR,EAAjB;;MAEID,UAAJ,EACC,OAAOA,UAAP,CADD,KAGC,OAAOF,QAAQI,GAAR,0BAAP;EARF;;;;;;;;;;;;;ACKD,IAAMR,UAAUS,UAAUJ,MAAV,CAAiB;YAAA,uBACpBJ,OADoB,EACXC,IADW,EACLC,IADK,EACA;;YAErBO,KAAV,CAAgB,IAAhB,EAAsBC,SAAtB;;OAEKC,aAAL,CAAmBV,IAAnB,EAAyBD,OAAzB;OACKY,gBAAL;OACKC,aAAL,CAAmBX,IAAnB;EAP+B;;;;;cAAA,yBAalBD,IAbkB,EAaZD,OAbY,EAaJ;MACxBC,QAAQ,IAAR,IAAgBA,SAAS,EAA5B,EACC,MAAM,IAAIa,KAAJ,CAAU,+EAAV,CAAN;;MAEE,CAAC3B,EAAE4B,QAAF,CAAWf,OAAX,CAAJ,EACC,MAAM,IAAIc,KAAJ,CAAU,2FAAV,CAAN;;OAEIE,GAAL,GAAW7B,EAAE8B,QAAF,CAAW,SAAX,CAAX;OACKhB,IAAL,GAAYA,IAAZ;OACKD,OAAL,GAAeA,OAAf;OACKkB,MAAL,GAAc,EAAd;EAvB+B;iBAAA,8BA0Bd;;;OACZC,aAAL,GAAqB,IAAIjC,OAAJ,CAAY,UAACU,OAAD,EAAUC,MAAV,EAAqB;SAChDuB,MAAL,GAAc;WAAMvB,OAAO,QAAP,CAAN;IAAd;GADoB,CAArB;EA3B+B;cAAA,2BA+BR;;;MAAVK,IAAU,uEAAH,EAAG;;MACnBmB,UAAUlC,EAAEmC,IAAF,CAAOpB,IAAP,EAAa,KAAb,EAAoB,MAApB,EAA4B,SAA5B,EAAuC,eAAvC,EAAwD,QAAxD,EAAkE,QAAlE,CAAd;IACEmB,OAAF,EAAWE,IAAX,CAAgB,UAACC,KAAD,EAAQC,GAAR;UAAgB,OAAKA,GAAL,IAAYD,KAA5B;GAAhB;EAjC+B;iBAAA,8BAqCd;;MAEbE,WAAW,KAAKC,qBAAL,EAAf;;MAEG,CAACD,QAAJ,EAAc;;MAEVrB,aAAa,KAAKA,UAAtB;;MAEIA,eAAe,KAAnB,EAA0B;;QAEpBe,MAAL;GAFD,MAIO,IAAIf,cAAc,OAAlB,EAA2B;;UAE1BqB,SAASE,OAAhB;GAFM,MAIA,IAAIvB,cAAc,MAAlB,EAA0B;;YAEvBe,MAAT;;EAvD8B;;;;;IAAA,iBA+DpB;OACNS,sBAAL,CAA4B,IAA5B;;oCADMC,IAAK;OAAA;;;OAENA,IAAL,GAAYA,QAAQ,EAApB;OACKF,OAAL,GAAe,KAAKG,uBAAL,EAAf;SACO,KAAKH,OAAZ;EAnE+B;wBAAA,qCAuEP;;;SAGjB,KAAKI,YAAL,GACL3C,IADK,CACA;UAAM,OAAK4C,MAAL,EAAN;GADA,EAEL5C,IAFK,CAEA;UAAM,OAAK6C,YAAL,EAAN;GAFA,EAGL7C,IAHK,CAGA;UAAM,OAAK8C,aAAL,EAAN;GAHA,EAIL9C,IAJK,CAIA;UAAM,OAAK+C,kBAAL,EAAN;GAJA,EAKL/C,IALK,CAKA,YAAM;UACNgD,eAAL;UACOnD,QAAQU,OAAR,EAAP;GAPK,EASL0C,KATK,CASC,iBAAS;UACVC,YAAL,CAAkBC,KAAlB;OACIC,gBAAJ;OACGD,iBAAiB1B,KAApB,EAA2B;UACpB0B,KAAN;IADD,MAEO,IAAKC,UAAU,OAAKC,UAAL,EAAf,EAAmC;UACnCD,OAAN;IADM,MAEA;WACCvD,QAAQW,MAAR,CAAe,MAAf,CAAP;;GAjBI,CAAP;EA1E+B;aAAA,0BAmGjB;SACP,KAAK8C,gBAAL,CAAsBzD,QAAQU,OAAR,EAAtB,CAAP;EApG+B;OAAA,oBAsGxB;SACA,KAAKgD,uBAAL,CAA6B,OAA7B,CAAP;EAvG+B;aAAA,0BAyGlB;SACN,KAAKA,uBAAL,CAA6B,QAA7B,CAAP;EA1G+B;cAAA,2BA4GjB;MACVC,gBAAgB,aAAa,KAAK5C,IAAtC;MACI2B,UAAU,KAAKkB,eAAL,CAAqBD,aAArB,CAAd;MACG,CAAC7D,aAAa4C,OAAb,CAAJ,EAA2B;aACfA,WAAW,IAAX,IAAmBA,YAAY,EAAhC,GACP1C,QAAQU,OAAR,EADO,GAEPV,QAAQW,MAAR,CAAe+B,OAAf,CAFH;;SAIM,KAAKe,gBAAL,CAAsBf,OAAtB,CAAP;EApH+B;mBAAA,gCAsHZ;MACfiB,yBAAuB,KAAK5C,IAA5B,cAAJ;;MAEIR,WAAWH,QAAQ,KAAKwD,eAAL,CAAqBD,aAArB,CAAR,CAAf;;SAEO,KAAKF,gBAAL,CAAsBzD,QAAQ6D,GAAR,CAAYtD,QAAZ,CAAtB,CAAP;EA3H+B;wBAAA,mCA8HRuD,QA9HQ,EA8HC;;;MAC5BC,aAAaC,UAAU,QAAQF,QAAlB,CAAjB;MACIG,WAAWhE,EAAEC,UAAF,CAAa,KAAK6D,UAAL,CAAb,KAAkC,KAAKA,UAAL,eAAiB,KAAKjD,OAAtB,2BAAkC,KAAK8B,IAAvC,GAAlC,IAAkFsB,SAAjG;MACIzD,SAASD,eAAeyD,QAAf,EAAyB9D,IAAzB,CAA8B,YAAM;OAC5CgE,WAAW,OAAKC,gBAAL,CAAsBN,QAAtB,CAAf;UACOtD,eAAe2D,QAAf,CAAP;GAFY,CAAb;;SAKO,KAAKV,gBAAL,CAAsBhD,MAAtB,CAAP;EAtI+B;;;;;gBAAA,6BA4Id;;OAEZkC,sBAAL,CAA4B,IAA5B;;MAEI1C,EAAEC,UAAF,CAAa,KAAKmE,UAAlB,CAAJ,EACC,KAAKA,UAAL,cAAgB,KAAKvD,OAArB,2BAAiC,KAAK8B,IAAtC;;OAEIwB,gBAAL;;OAEKE,UAAL;EArJ+B;aAAA,wBAyJnBtC,MAzJmB,EAyJZ;;;OAGdW,sBAAL,CAA4B,IAA5B;;MAEG,CAAC1C,EAAEI,OAAF,CAAU2B,MAAV,CAAJ,EACCA,SAAS,CAACA,MAAD,CAAT;;kBAEIA,MAAL,EAAYuC,IAAZ,kCAAoBvC,MAApB;;MAGI/B,EAAEC,UAAF,CAAa,KAAKsE,OAAlB,CAAJ,EACC,KAAKA,OAAL,cAAa,KAAK1D,OAAlB,2BAA8B,KAAKkB,MAAnC;;OAEIoC,gBAAL,cAAsB,OAAtB,2BAAkC,KAAKpC,MAAvC;;OAEKsC,UAAL;EAzK+B;WAAA,wBA6KpB;OACNF,gBAAL,CAAsB,KAAtB;EA9K+B;;;;;WAAA,sBAqLrBtD,OArLqB,EAqLb;GACjBA,OAAD,KAAaA,UAAU,IAAvB;MACGA,WAAW,IAAX,KAAoB,CAACb,EAAE4B,QAAF,CAAWf,OAAX,CAAD,IAAwB,CAACb,EAAEI,OAAF,CAAUS,QAAQkB,MAAlB,CAA7C,CAAH,EACC;;SAEM/B,EAAEa,QAAQkB,MAAV,EAAkByC,MAAlB,CAAyB;UAAKC,aAAa9C,KAAlB;GAAzB,EAAkD,CAAlD,CAAP;EA1L+B;iBAAA,4BA6Lfc,OA7Le,EA6LP;SACjBpC,KAAK,KAAK2B,aAAV,EAAyBS,OAAzB,CAAP;EA9L+B;qBAAA,kCAkMV;SACdsB,wBAAsB,KAAKjD,IAA3B,gBAAP;EAnM+B;sBAAA,mCAqMT;MAClBwB,MAAM,KAAKoC,oBAAL,EAAV;SACO,KAAK7D,OAAL,CAAayB,GAAb,CAAP;EAvM+B;uBAAA,kCAyMTtB,OAzMS,EAyMD;MAC1BsB,MAAM,KAAKoC,oBAAL,EAAV;OACK7D,OAAL,CAAayB,GAAb,IAAoBtB,OAApB;EA3M+B;iBAAA,4BAgNd2D,SAhNc,EAgNH;;MAExB9D,UAAU,KAAKA,OAAnB;MACG,CAACb,EAAEC,UAAF,CAAaY,QAAQ+D,OAArB,CAAJ,EACC;;MAEGC,QAAQ,CAACF,YAAYA,YAAY,GAAxB,GAA8B,EAA/B,IAAqC,KAAK7D,IAAtD;;SAEOgE,kCAAgBjE,OAAhB,EAAyBgE,KAAzB,EAAgC,IAAhC,2BAAyC,KAAKlC,IAA9C,GAAP;EAxN+B;gBAAA,2BA4NhBoC,UA5NgB,EA6NhC;MACKC,SAASjB,UAAUgB,UAAV,CAAb;MACIlE,UAAU,KAAKA,OAAnB;MACI8B,OAAO,KAAKA,IAAhB;SACOnC,aAAOK,OAAP,EAAgBmE,MAAhB,EAAwB,EAAErC,UAAF,EAAxB,CAAP;;CAjOc,EAqOb;SAAA,oBACO9B,OADP,EACgBC,IADhB,EACsBC,IADtB,EAC4B;SACtBkE,gBAAS,IAAT,EAAepE,OAAf,EAAwBC,IAAxB,EAA8BC,IAA9B,CAAP;;CAvOc,CAAhB;;ACJA,IAAMmE,0BAA2B;aACpB,KADoB;;;WAAA,wBAIpB;;OAENC,YAAL,GAAoB,CAAC;QACf,kBADe;UAEb,KAAKtE,OAAL,CAAa,kBAAb;GAFY,CAApB;;;;;;;;;;EAN+B;aAAA,0BAyBlB;;;IACX,KAAKsE,YAAL,IAAqB,EAAvB,EAA2B/C,IAA3B,CAAgC,oBAAY;SACtCvB,OAAL,CAAauE,SAAS9C,GAAtB,IAA6B8C,SAAS/C,KAAtC;GADD;EA1B+B;SAAA,sBA8Bf;OACXgD,UAAL;OACKC,WAAL;OACKzE,OAAL,CAAa,kBAAb,IAAmC,KAAK0E,cAAxC;;oCAHW5C,IAAK;OAAA;;;OAIX9B,OAAL,CAAa,+BAAb,IAAgD8B,IAAhD;EAlC+B;WAAA,wBAoCpB;OACN9B,OAAL,CAAa,kBAAb,IAAmC,KAAK2E,aAAxC;EArC+B;QAAA,qBAuCvB;OACHC,YAAL;EAxC+B;YAAA,yBA0CD;MAAnBC,WAAmB,uEAAL,IAAK;;MAC1BC,QAAQ,KAAK7E,IAAL,IAAa,OAAb,GAAuB,MAAvB,GAAgC,OAA5C;MACIuC,QAAQ,KAAKvC,IAAL,IAAa,OAAb,GAAuB,aAAvB,GAAuC,aAAnD;MACI8E,SAAS,KAAK/E,OAAL,CAAa,kBAAb,CAAb;UACO+E,MAAP;QACK,UAAL;QACK,UAAL;QACIF,WAAH,EAAgB,MAAM,IAAI/D,KAAJ,CAAU,WAAV,CAAN,CAAhB,KACK,OAAO,WAAP;QACD,OAAL;QACI,KAAKb,IAAL,IAAa,OAAhB,EAAyB,OAAzB,KACK,IAAG4E,WAAH,EAAgB,MAAM,IAAI/D,KAAJ,CAAU0B,KAAV,CAAN,CAAhB,KACA,OAAOA,KAAP;QACDsC,KAAL;QACID,WAAH,EAAgB,MAAM,IAAI/D,KAAJ,CAAU0B,KAAV,CAAN,CAAhB,KACK,OAAOA,KAAP;;;CAzDR;;AA8DA,IAAMwC,sBAAuB;iBACZ,UADY;gBAEb;CAFhB;AAIA,IAAMC,qBAAsB;iBACX,UADW;gBAEZ;CAFhB;;AAOA,sBAAe;QAAQC,KAAK9E,MAAL,CAAY;aAAA,yBACrB;QACPK,KAAL,CAAW,IAAX,EAAiBC,SAAjB;QACKyE,oBAAL;GAHiC;sBAAA,kCAKZ;OACjB,KAAKC,qBAAT,EAAgC;;OAE5BC,YAAYlG,EAAEiB,MAAF,CAAS,EAAT,EAAaiE,uBAAb,EAAsCiB,UAAU,IAAV,EAAgB,kBAAhB,EAAoC,EAACxD,MAAK,CAAC,IAAD,CAAN,EAApC,CAAtC,CAAhB;;OAEIyD,QAAQpG,EAAEiB,MAAF,CAAS,EAAT,EAAaiF,SAAb,EAAwBL,mBAAxB,EAA6CM,UAAU,IAAV,EAAgB,cAAhB,EAAgC,EAACxD,MAAK,CAAC,IAAD,CAAN,EAAhC,CAA7C,CAAZ;OACI0D,OAAOrG,EAAEiB,MAAF,CAAS,EAAT,EAAaiF,SAAb,EAAwBJ,kBAAxB,EAA4CK,UAAU,IAAV,EAAgB,aAAhB,EAA+B,EAACxD,MAAK,CAAC,IAAD,CAAN,EAA/B,CAA5C,CAAX;;WAEQsC,QAAR,CAAiB,IAAjB,EAAuB,OAAvB,EAAgCmB,KAAhC;WACQnB,QAAR,CAAiB,IAAjB,EAAuB,MAAvB,EAA+BoB,IAA/B;;QAEKJ,qBAAL,GAA6B,IAA7B;GAhBiC;WAAA,uBAkBvB;UACH,KAAK,kBAAL,MAA6B,SAApC;GAnBiC;WAAA,uBAqBvB;UACH,KAAK,kBAAL,MAA6B,SAA7B,IAA0C,KAAK,kBAAL,MAA6B,OAA9E;GAtBiC;YAAA,wBAwBtB;UACJ,KAAK,kBAAL,MAA6B,UAA7B,IAA2C,KAAK,kBAAL,MAA6B,UAA/E;GAzBiC;SAAA,qBA2BzB;;;OACL,KAAKK,UAAL,EAAH,EACC,MAAM,IAAI3E,KAAJ,CAAU,6DAAV,EAAyE,KAAK,kBAAL,CAAzE,CAAN;OACG0E,OAAO,KAAKE,SAAL,KAAmB,KAAKF,IAAL,EAAnB,GAAiCtG,QAAQU,OAAR,EAA5C;OACIkC,OAAO,KAAK,+BAAL,KAAyC,EAApD;UACO0D,KAAKnG,IAAL,CAAU;WAAM,OAAKkG,KAAL,iCAAczD,IAAd,EAAN;IAAV,CAAP;;EAhCqB,EAkCrB,EAAE6D,gBAAgB,IAAlB,EAlCqB,CAAR;CAAf;;ACxEA,IAAMC,UAAUC,IAAIrF,SAAJ,EAAesF,IAAf,CAAoBC,MAApB,EAA4BJ,cAA5B,CAAhB;;AAEA,UAAeC,QAAQxF,MAAR,CAAe;YAAA,yBACJ;MAAbiB,OAAa,uEAAH,EAAG;;OACnBA,OAAL,GAAelC,EAAE6G,KAAF,CAAQ3E,OAAR,CAAf;OACK4E,cAAL,GAAsB,EAAtB;UACQxF,KAAR,CAAc,IAAd,EAAoBC,SAApB;OACKwF,UAAL,CAAgB7E,OAAhB;OACK8E,aAAL,CAAmB,YAAnB,EAAiC9E,OAAjC;EAN4B;;6BAAA;UAAA,0BASlB;SACHiE,4BAAU,IAAV,oCAAmB5E,SAAnB,GAAP;EAV4B;iBAAA,8BAYX;;;MAEd,CAAC,KAAKuF,cAAT,EAAyB;;;;SAIlB9G,EAAEiH,GAAF,CAAM,KAAKH,cAAX,EAA2B,gBAAO;OACpC9G,EAAEC,UAAF,CAAaiH,IAAb,CAAJ,EAAwB;WAChBA,KAAKC,IAAL,CAAU,KAAV,CAAP;IADD,MAEO;WACCD,IAAP;;GAJK,CAAP;EAlB4B;gBAAA,6BA0BL;;;yBAClBJ,cAAL,EAAoBxC,IAApB;EA3B4B;;aA6BlB,sBAAM,EA7BY;YAAA,uBA8BjB7B,OA9BiB,EA8BR2E,QA9BQ,EA8BU;oCAALzE,IAAK;OAAA;;;;;SAC/BF,QAAQvC,IAAR,CAAa,YAAM;UAClBkH,SAAS9F,KAAT,CAAe,MAAf,EAAqBqB,IAArB,CAAP;GADM,CAAP;EA/B4B;aAAA,wBAmChBT,OAnCgB,EAmCR;MAChB,CAAC,KAAKmF,UAAV,EAAsB;OACjBC,SAAS,KAAKC,WAAL,CAAiBrF,OAAjB,CAAb;OACG,CAACoF,MAAJ,EAAY;;;;;OAGTA,OAAOE,WAAP,IAAsBxH,EAAEC,UAAF,CAAaqH,OAAOG,QAApB,CAAzB,EAAwD;WAChDD,WAAP,GAAqB,KAArB;;;QAGIH,UAAL,GAAkBC,MAAlB;;MAEGI,SAAS,KAAKC,SAAL,EAAb;SACOC,IAAP,CAAY,KAAKP,UAAjB;EAhD4B;YAAA,uBAkDjBnF,OAlDiB,EAkDT;SACZ2F,eAAe,IAAf,EAAqB,QAArB,EAA+B,EAAE3F,gBAAF,EAA/B,CAAP;EAnD4B;UAAA,uBAqDlB;MACN,KAAK4F,OAAT,EAAkB,OAAO,KAAKA,OAAZ;OACbA,OAAL,GAAe,KAAKC,WAAL,EAAf;SACO,KAAKD,OAAZ;EAxD4B;aAAA,wBA0DhBJ,MA1DgB,EA0DRxF,OA1DQ,EA0DA;MACxBwF,UAAU,IAAd,EAAoB;UACZ,IAAIM,MAAJ,CAAW9F,OAAX,CAAP;GADD,MAEO,IAAI+F,QAAQP,MAAR,EAAgBM,MAAhB,CAAJ,EAA6B;UAC5B,IAAIN,MAAJ,CAAWxF,OAAX,CAAP;GADM,MAEA,IAAIlC,EAAEC,UAAF,CAAayH,MAAb,CAAJ,EAA0B;UACzB,KAAKQ,YAAL,CAAkBR,OAAOP,IAAP,CAAY,IAAZ,EAAkB,IAAlB,CAAlB,EAA2CjF,OAA3C,CAAP;GADM,MAEA,IAAIlC,EAAE4B,QAAF,CAAW8F,MAAX,CAAJ,EAAwB;OAC1BS,cAAcT,OAAOU,WAAP,IAAsBJ,MAAxC;OACIK,aAAarI,EAAEiB,MAAF,CAAS,EAAT,EAAajB,EAAEmC,IAAF,CAAOuF,MAAP,EAAe,aAAf,CAAb,CAAjB;OACG,CAACW,WAAWC,EAAf,EAAmB;eACPA,EAAX,GAAgBpG,QAAQoG,EAAxB;;OAEED,WAAWE,cAAX,IAA6B,IAAhC,EAAsC;eAC1BA,cAAX,GAA4BrG,QAAQqG,cAApC;;UAEM,IAAIJ,WAAJ,CAAgBE,UAAhB,CAAP;;EA1E2B;YAAA,yBA6EhB;MACRC,KAAK,KAAKnC,SAAL,CAAe,OAAf,KAA2B,MAApC;MACIpF,OAAO,EAAEuH,MAAF,EAAMC,gBAAgB,IAAtB,EAAX;SACO,KAAKL,YAAL,CAAkB,KAAK/B,SAAL,CAAe,QAAf,EAAyB,EAAExD,MAAM,CAAC,IAAD,CAAR,EAAzB,CAAlB,EAA8D5B,IAA9D,CAAP;;CAhFa,CAAf;;;;;;;;;;;"}