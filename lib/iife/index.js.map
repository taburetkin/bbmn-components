{"version":3,"file":"index.js","sources":["process/helpers.js","process/register.js","process/process.js","process/startable-mixin.js","app/index.js","model-schemas/schema.js","model-schemas/property-schema.js","model-schemas/model-schema.js","model-schemas/store.js","views/index.js","validator/rules.js","validator/validate.js","validator/index.js","user/index.js","bearer-token/index.js","view-stack/index.js"],"sourcesContent":["import _ from 'underscore';\r\n\r\nexport function isPromisable(arg){\r\n\treturn arg instanceof Promise || _.isFunction(arg && arg.then);\r\n}\r\n\r\nexport function asArray(arg) {\r\n\tif(_.isArray(arg))\r\n\t\treturn arg;\r\n\telse if(arg == null || arg === '')\r\n\t\treturn [];\r\n\telse\r\n\t\treturn [arg];\r\n}\r\n\r\nexport function race(...promises){\r\n\treturn Promise.race(promises);\r\n}\r\n\r\nexport function valueToPromise(arg){\r\n\tif(!isPromisable(arg)) {\r\n\t\tlet result = arg;\r\n\t\targ = arg == null || arg === '' ? Promise.resolve() : Promise.reject(result);\r\n\t}\r\n\treturn arg;\t\t\r\n}\r\n","import _ from 'underscore';\r\nexport default function registerProcess (Process, context, name, opts) {\r\n\r\n\tcontext[name] = function(...args){\r\n\t\t\r\n\t\tlet process = new Process(context, name, _.extend({}, opts));\r\n\t\tlet concurrent = process.concurrencyCheck();\r\n\r\n\t\tif (concurrent)\r\n\t\t\treturn concurrent;\r\n\t\telse\r\n\t\t\treturn process.run(...args);\r\n\r\n\t};\r\n\r\n}\r\n","import _ from 'underscore';\r\nimport { triggerMethodOn, camelCase, betterResult as result } from 'bbmn-utils';\r\nimport { isPromisable, race, asArray, valueToPromise } from './helpers.js';\r\nimport { BaseClass } from 'bbmn-core';\r\n\r\nimport register from './register.js';\r\n\r\n\r\nconst Process = BaseClass.extend({\r\n\tconstructor(context, name, opts){\r\n\t\t\r\n\t\tBaseClass.apply(this, arguments);\r\n\r\n\t\tthis._initDefaults(name, context);\r\n\t\tthis._initCancelation();\r\n\t\tthis._mergeOptions(opts);\r\n\t},\r\n\r\n\r\n\t// initialize methods\r\n\r\n\t_initDefaults(name, context){\r\n\t\tif(name == null || name === '')\r\n\t\t\tthrow new Error('Process requires two arguments: name [string], context [object]. name missing');\r\n\t\t\r\n\t\tif(!_.isObject(context))\r\n\t\t\tthrow new Error('Process requires two arguments: name [string], context [object]. context is not an object');\r\n\r\n\t\tthis.cid = _.uniqueId('process');\r\n\t\tthis.name = name;\r\n\t\tthis.context = context;\r\n\t\tthis.errors = [];\r\n\t},\r\n\r\n\t_initCancelation(){\r\n\t\tthis.cancelPromise = new Promise((resolve, reject) => {\r\n\t\t\tthis.cancel = () => reject('cancel'); \r\n\t\t});\r\n\t},\r\n\t_mergeOptions(opts = {}){\r\n\t\tlet options = _.omit(opts, 'cid', 'name', 'context', 'cancelPromise', 'cancel', 'errors');\r\n\t\t_(options).each((value, key) => this[key] = value);\r\n\t},\r\n\r\n\t\r\n\tconcurrencyCheck(){\r\n\r\n\t\tlet previous = this.getProcessFromContext();\r\n\t\t//console.log(previous, this.context);\r\n\t\tif(!previous) return;\r\n\t\r\n\t\tlet concurrent = this.concurrent;\t\r\n\t\t\r\n\t\tif (concurrent === false) {\r\n\t\r\n\t\t\tthis.cancel();\r\n\t\r\n\t\t} else if (concurrent == 'first') {\r\n\t\r\n\t\t\treturn previous.promise;\r\n\t\r\n\t\t} else if (concurrent == 'last') {\r\n\t\r\n\t\t\tprevious.cancel();\r\n\t\r\n\t\t}\t\t\r\n\t},\r\n\r\n\r\n\t// life cycle methods\t\r\n\r\n\trun(...args){\r\n\t\tthis.updateProcessInContext(this);\r\n\t\tthis.args = args || [];\r\n\t\tthis.promise = this._createLifeCyclePromise();\r\n\t\treturn this.promise;\r\n\t},\r\n\r\n\r\n\t_createLifeCyclePromise(){\r\n\r\n\r\n\t\treturn this._notCanceled()\r\n\t\t\t.then(() => this._begin())\r\n\t\t\t.then(() => this._beforeStart())\r\n\t\t\t.then(() => this._canBeStarted())\r\n\t\t\t.then(() => this._waitOtherPromises())\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis.triggerComplete();\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t})\r\n\t\t\t.catch(error => {\r\n\t\t\t\tthis.triggerError(error);\r\n\t\t\t\tlet jsError;\r\n\t\t\t\tif(error instanceof Error) {\r\n\t\t\t\t\tthrow error;\r\n\t\t\t\t} else if ((jsError = this.getJsError())) {\r\n\t\t\t\t\tthrow jsError;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Promise.reject(this);\r\n\t\t\t\t}\r\n\t\t\t});\t\t\r\n\t},\r\n\r\n\r\n\r\n\r\n\t_notCanceled() {\r\n\t\treturn this._cancelationRace(Promise.resolve());\r\n\t},\r\n\t_begin(){\r\n\t\treturn this._getHookResultAsPromise('begin');\r\n\t},\r\n\t_beforeStart(){\r\n\t\treturn this._getHookResultAsPromise('before');\r\n\t},\r\n\t_canBeStarted(){\r\n\t\tlet contextMethod = 'can:not:' + this.name;\r\n\t\tlet promise = this.invokeOnContext(contextMethod);\r\n\t\tif(!isPromisable(promise)) {\r\n\t\t\tpromise = (promise == null || promise === '') \r\n\t\t\t\t? Promise.resolve()\r\n\t\t\t\t: Promise.reject(promise);\r\n\t\t}\r\n\t\treturn this._cancelationRace(promise);\r\n\t},\r\n\t_waitOtherPromises(){\r\n\t\tlet contextMethod = `get:${this.name}:promises`;\r\n\t\t\r\n\t\tlet promises = asArray(this.invokeOnContext(contextMethod));\r\n\r\n\t\treturn this._cancelationRace(Promise.all(promises));\r\n\t},\r\n\r\n\t_getHookResultAsPromise(hookName){\r\n\t\tlet procMethod = camelCase('on:' + hookName);\r\n\t\tlet procHook = _.isFunction(this[procMethod]) && this[procMethod](this.context, ...this.args) || undefined;\r\n\t\tlet result = valueToPromise(procHook).then(() => {\r\n\t\t\tlet cntxHook = this.triggerOnContext(hookName);\r\n\t\t\treturn valueToPromise(cntxHook);\r\n\t\t});\r\n\r\n\t\treturn this._cancelationRace(result);\r\n\r\n\t},\r\n\r\n\t// trigger methods\r\n\r\n\ttriggerComplete() { \r\n\r\n\t\tthis.updateProcessInContext(null);\r\n\r\n\t\tif (_.isFunction(this.onComplete))\r\n\t\t\tthis.onComplete(this.context, ...this.args);\r\n\r\n\t\tthis.triggerOnContext();\r\n\r\n\t\tthis.triggerEnd();\r\n\t\t\r\n\t\r\n\t},\r\n\ttriggerError(errors){\r\n\r\n\r\n\t\tthis.updateProcessInContext(null);\t\t\r\n\r\n\t\tif(!_.isArray(errors))\r\n\t\t\terrors = [errors];\r\n\r\n\t\tthis.errors.push(...errors);\r\n\r\n\t\t\r\n\t\tif (_.isFunction(this.onError))\r\n\t\t\tthis.onError(this.context, ...this.errors);\r\n\t\t\r\n\t\tthis.triggerOnContext('error', ...this.errors);\r\n\t\t\r\n\t\tthis.triggerEnd();\r\n\r\n\t\t\r\n\t},\r\n\ttriggerEnd(){\r\n\t\tthis.triggerOnContext('end');\r\n\t},\r\n\r\n\r\n\r\n\t// helpers methods\r\n\r\n\tgetJsError(context){\r\n\t\t!context && (context = this);\r\n\t\tif(context != this && (!_.isObject(context) || !_.isArray(context.errors)))\r\n\t\t\treturn;\r\n\r\n\t\treturn _(context.errors).filter(f => f instanceof Error)[0];\r\n\t},\t\r\n\r\n\t_cancelationRace(promise){\r\n\t\treturn race(this.cancelPromise, promise);\r\n\t},\r\n\r\n\r\n\tgetContextProcessKey(){\r\n\t\treturn camelCase(`_process:${this.name}:executing`);\r\n\t},\r\n\tgetProcessFromContext(){\r\n\t\tlet key = this.getContextProcessKey();\r\n\t\treturn this.context[key];\r\n\t},\r\n\tupdateProcessInContext(process){\r\n\t\tlet key = this.getContextProcessKey();\t\t\r\n\t\tthis.context[key] = process;\r\n\t},\r\n\r\n\r\n\r\n\ttriggerOnContext (eventName) {\r\n\t\r\n\t\tlet context = this.context; \r\n\t\tif(!_.isFunction(context.trigger))\r\n\t\t\treturn;\r\n\t\t\r\n\t\tlet event = (eventName ? eventName + ':' : '') + this.name;\r\n\t\t\r\n\t\treturn triggerMethodOn(context, event, this, ...this.args);\r\n\t\r\n\t},\r\n\r\n\tinvokeOnContext(methodName)\r\n\t{\r\n\t\tlet method = camelCase(methodName);\r\n\t\tlet context = this.context;\r\n\t\tlet args = this.args;\r\n\t\treturn result(context, method, { args });\r\n\r\n\t}\r\n\r\n}, {\r\n\tregister(context, name, opts) {\r\n\t\treturn register(this, context, name, opts);\r\n\t}\r\n});\r\n\r\n\r\n// Process.register = function(context, name, opts) {\r\n// \treturn register(this, context, name, opts);\r\n// };\r\n\r\nexport default Process;\r\n","import _ from 'underscore';\r\nimport Process from './process.js';\r\nimport { getOption } from 'bbmn-utils';\r\n\r\nconst defaultStartableOptions  = {\r\n\tconcurrent: false,\r\n\r\n\t//good place to supply own state collecting logic\r\n\tstoreState(){\r\n\r\n\t\tthis.contextState = [{\r\n\t\t\tkey: 'startable.status',\r\n\t\t\tvalue: this.context['startable.status']\r\n\t\t}];\r\n\r\n\r\n\t\t/*\r\n\r\n\t\tfor example: take all simple values from context\r\n\r\n\t\tfor(var key in this.context){\r\n\t\t\tlet value = this.context[key];\r\n\t\t\tif (value == null || !_.isObject(value.valueOf()))\r\n\t\t\t\tthis.contextState.push({ key, value });\r\n\t\t}\r\n\r\n\t\t*/\r\n\r\n\t},\r\n\trestoreState(){\r\n\t\t_(this.contextState || []).each(keyValue => {\r\n\t\t\tthis.context[keyValue.key] = keyValue.value;\r\n\t\t});\r\n\t},\r\n\tonBefore(...args){\r\n\t\tthis.storeState();\r\n\t\tthis.ensureState();\r\n\t\tthis.context['startable.status'] = this.processingName;\r\n\t\tthis.context['startable.start.lastArguments'] = args;\r\n\t},\r\n\tonComplete(){\r\n\t\tthis.context['startable.status'] = this.processedName;\r\n\t},\t\r\n\tonError(){\r\n\t\tthis.restoreState();\r\n\t},\r\n\tensureState(shouldThrow = true){\r\n\t\tlet other = this.name == 'start' ? 'stop' : 'start';\r\n\t\tlet error = this.name == 'start' ? 'not:stopped' : 'not:started';\r\n\t\tlet status = this.context['startable.status'];\r\n\t\tswitch(status){\r\n\t\tcase 'stopping':\r\n\t\tcase 'starting':\r\n\t\t\tif(shouldThrow) throw new Error('not:iddle');\r\n\t\t\telse return 'not:iddle';\r\n\t\tcase 'iddle':\r\n\t\t\tif(this.name == 'start') return;\r\n\t\t\telse if(shouldThrow) throw new Error(error);\r\n\t\t\telse return error;\r\n\t\tcase other:\r\n\t\t\tif(shouldThrow) throw new Error(error);\r\n\t\t\telse return error;\t\t\t\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst defaultStartOptions  = {\r\n\tprocessingName: 'starting',\r\n\tprocessedName: 'started'\r\n};\r\nconst defaultStopOptions  = {\r\n\tprocessingName: 'stopping',\r\n\tprocessedName: 'stopped'\r\n};\r\n\r\n\r\n\r\nexport default Base => Base.extend({\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeStartable();\r\n\t},\r\n\t_initializeStartable(){\r\n\t\tif (this._startableInitialized) return;\r\n\r\n\t\tlet startable = _.extend({}, defaultStartableOptions, getOption(this, 'startableOptions', {args:[this]}));\r\n\r\n\t\tlet start = _.extend({}, startable, defaultStartOptions, getOption(this, 'startOptions', {args:[this]}));\r\n\t\tlet stop = _.extend({}, startable, defaultStopOptions, getOption(this, 'stopOptions', {args:[this]}));\r\n\r\n\t\tProcess.register(this, 'start', start);\r\n\t\tProcess.register(this, 'stop', stop);\r\n\t\t\r\n\t\tthis._startableInitialized = true;\r\n\t},\r\n\tisStarted(){\r\n\t\treturn this['startable.status'] === 'started';\r\n\t},\r\n\tisStopped(){\r\n\t\treturn this['startable.status'] === 'stopped' || this['startable.status'] === 'iddle';\r\n\t},\r\n\tisNotIddle(){\r\n\t\treturn this['startable.status'] === 'stopping' || this['startable.status'] === 'starting';\r\n\t},\r\n\trestart(){\r\n\t\tif(this.isNotIddle())\r\n\t\t\tthrow new Error('Restart not allowed while startable instance is not iddle: ', this['startable.status']);\r\n\t\tlet stop = this.isStarted() ? this.stop() : Promise.resolve();\r\n\t\tlet args = this['startable.start.lastArguments'] || [];\r\n\t\treturn stop.then(() => this.start(...args));\r\n\t}\t\r\n},{ StartableMixin: true });\r\n","import _ from 'underscore';\r\nimport { BaseClass, Events, Region, isClass } from 'bbmn-core';\r\nimport { startableMixin } from '../process/index.js';\r\nimport { mix, getOption, triggerMethod, buildViewByKey } from 'bbmn-utils';\r\n\r\nconst BaseApp = mix(BaseClass).with(Events, startableMixin);\r\n\r\nexport default BaseApp.extend({\r\n\tconstructor(options = {}){\r\n\t\tthis.options = _.clone(options);\r\n\t\tthis._startPromises = [];\r\n\t\tBaseApp.apply(this, arguments);\r\n\t\tthis.initialize(options);\r\n\t\tthis.triggerMethod('initialize', options);\t\r\n\t},\r\n\ttriggerMethod,\r\n\tgetOption(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t},\r\n\tgetStartPromises(){\r\n\t\t\r\n\t\tif(!this._startPromises) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn _.map(this._startPromises, item =>{\r\n\t\t\tif (_.isFunction(item)) {\r\n\t\t\t\treturn item.call(this);\r\n\t\t\t} else {\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\taddStartPromise(...args){\r\n\t\tthis._startPromises.push(...args);\r\n\t},\r\n\tinitialize:() => {},\r\n\tdoOnResolve(promise, callback, ...args){\r\n\t\treturn promise.then(() => {\r\n\t\t\treturn callback.apply(this, args);\r\n\t\t});\r\n\t},\r\n\trenderLayout(options){\r\n\t\tif (!this.layoutView) {\r\n\t\t\tlet layout = this.buildLayout(options);\r\n\t\t\tif(!layout) { return; }\r\n\t\t\tthis.layoutView = layout;\r\n\t\t}\r\n\t\tlet region = this.getRegion();\r\n\t\tregion.show(this.layoutView);\r\n\t\treturn this.layoutView;\r\n\t},\r\n\tbuildLayout(options){\r\n\t\treturn buildViewByKey(this, 'layout', { options });\r\n\t},\r\n\tgetRegion(){\r\n\t\tif (this._region) return this._region;\r\n\t\tthis._region = this.buildRegion();\r\n\t\treturn this._region;\r\n\t},\r\n\t_buildRegion(region, options){\r\n\t\tif (region == null) {\r\n\t\t\treturn new Region(options);\r\n\t\t} else if (isClass(region, Region)) {\r\n\t\t\treturn new region(options);\r\n\t\t} else if (_.isFunction(region)) {\r\n\t\t\treturn this._buildRegion(region.call(this, this), options);\r\n\t\t} else if (_.isObject(region)) {\r\n\t\t\tlet RegionClass = region.regionClass || Region;\r\n\t\t\tlet newOptions = _.extend({}, _.omit(region, 'regionClass'));\r\n\t\t\tif(!newOptions.el) {\r\n\t\t\t\tnewOptions.el = options.el;\r\n\t\t\t}\r\n\t\t\tif(newOptions.replaceElement == null) {\r\n\t\t\t\tnewOptions.replaceElement = options.replaceElement;\r\n\t\t\t}\r\n\t\t\treturn new RegionClass(newOptions);\r\n\t\t}\r\n\t},\r\n\tbuildRegion(){\r\n\t\tlet el = this.getOption('appEl') || 'body';\r\n\t\tlet opts = { el, replaceElement: true };\r\n\t\treturn this._buildRegion(this.getOption('region', { args: [this] }), opts);\r\n\t},\r\n});\r\n","import { BaseClass } from 'bbmn-core';\r\nimport { getOption } from 'bbmn-utils';\r\n\r\nconst Schema = BaseClass.extend({\r\n\tgetOption: function(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t}\r\n});\r\nexport default Schema;\r\n","import _ from 'underscore';\r\nimport { betterResult, flat, unflat } from 'bbmn-utils';\r\nimport Schema from './schema.js';\r\n\r\n\r\nexport default Schema.extend({\r\n\tconstructor(options = {}){\r\n\t\tSchema.apply(this, arguments);\r\n\t\tlet { name, property, modelSchema, order = 0 } = options;\r\n\t\tthis.name = name;\r\n\t\tthis.schema = _.extend({}, property);\t\r\n\t\tthis.modelSchema = modelSchema;\r\n\t\tif (this.schema.order != null)\r\n\t\t\torder = this.schema.order;\r\n\t\tthis.order = order;\r\n\t},\r\n\t_getByKey(key, options = {}){\r\n\t\tlet hash = betterResult(this.schema, key, { args: [options], default: {} });\r\n\t\treturn unflat(flat(hash));\r\n\t},\r\n\tgetValidation(options) {\r\n\t\treturn this._getByKey('validation', options);\r\n\t},\r\n\tgetType(options) {\r\n\t\tlet type = this._getByKey('value', options);\r\n\t\tif(!('multiple' in type)) {\r\n\t\t\ttype.multiple = false;\r\n\t\t}\r\n\t\treturn type;\r\n\t},\r\n\tgetDisplay(options){\r\n\t\treturn this._getByKey('display', options);\r\n\t},\r\n\tgetLabel(value, allValues){\r\n\t\tlet label = this.getDisplay().label;\r\n\t\treturn betterResult({ label },'label', { args: [value, allValues] });\r\n\t},\r\n\tgetEdit(options = {}){\r\n\t\tlet valueOptions = this.getType(options);\r\n\t\tlet editOptions = this._getByKey('edit', options);\r\n\t\tlet label = this.getLabel(options.value, options.allValue);\r\n\t\tlet compiled = _.extend({ name: this.name, label }, options, { valueOptions, editOptions });\r\n\t\treturn compiled;\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\nimport Schema from './schema.js';\r\nimport PropertySchema from './property-schema.js';\r\nimport { isEmptyValue } from 'bbmn-utils';\r\n\r\nexport default Schema.extend({\r\n\tconstructor(properties = {}){\r\n\t\tthis.properties = {};\r\n\t\tSchema.apply(this,arguments);\r\n\t\tthis.setProperties(properties);\r\n\t},\r\n\tpropertySchema: PropertySchema,\r\n\t_createProperty(property){\r\n\t\tlet props = this.getProperties();\r\n\t\tlet order = _.size(props);\r\n\t\tlet Schema = this.getOption('propertySchema');\r\n\t\tlet options = { name: property.name, property, modelSchema: this, order };\r\n\t\treturn this.createProperty(Schema, options);\r\n\t},\r\n\tcreateProperty(Schema, options){\r\n\t\treturn new Schema(options);\r\n\t},\r\n\tsetProperties(properties){\r\n\t\treturn _.map(properties, (property, name) => {\r\n\t\t\tif(!_.isObject(property)) { return; }\r\n\r\n\t\t\tlet propertyName = _.isString(name) ? name : property.name;\r\n\t\t\tif (isEmptyValue(propertyName)) {\r\n\t\t\t\tthrow new Error('property name missing: ' + name);\r\n\t\t\t}\t\t\t\r\n\t\t\treturn this.setProperty(propertyName, property);\r\n\r\n\t\t});\r\n\t},\r\n\tgetProperties(){\r\n\t\treturn this.properties;\r\n\t},\r\n\tgetPropertiesArray(){\r\n\t\tlet props = this.getProperties();\r\n\t\treturn _.toArray(props)\r\n\t\t\t.sort((p1,p2) => p1.order - p2.order);\t\t\r\n\t},\r\n\tgetPropertiesNames(){\r\n\t\tlet props = this.getPropertiesArray();\r\n\t\treturn _.pluck(props, 'name');\r\n\t},\r\n\tgetProperty(name, { create = false } = {}){\r\n\t\tlet properties = this.getProperties() || {};\r\n\t\tlet property = properties[name];\r\n\t\tif(property || !create) {\r\n\t\t\treturn property;\r\n\t\t}\r\n\t\tproperty = this._createProperty(name);\r\n\t\treturn this.setProperty(name, property);\r\n\t},\r\n\t_setProperty(name, property){\r\n\t\tif(!_.isObject(property)){\r\n\t\t\tthrow new Error('property is not an object', property);\r\n\t\t}\r\n\t\tif(isEmptyValue(name)){\r\n\t\t\tthrow new Error('property has no name', property);\r\n\t\t}\r\n\r\n\t\tif (isEmptyValue(property.name)) {\r\n\t\t\tproperty.name = name;\r\n\t\t}\r\n\r\n\t\tif(!(property instanceof PropertySchema)){\r\n\t\t\tproperty = this._createProperty(property);\r\n\t\t}\r\n\r\n\t\tlet properties = this.getProperties();\r\n\t\tproperties[property.name] = property;\r\n\r\n\t\treturn property;\r\n\t},\r\n\tsetProperty(name, property) {\r\n\t\tif(_.isObject(name)){\r\n\t\t\tproperty = name;\r\n\t\t\tname = property.name;\r\n\t\t}\r\n\t\treturn this._setProperty(name, property);\r\n\t},\r\n\tgetValidation(name) {\r\n\t\tlet property = this.getProperty(name);\r\n\t\treturn property && property.getValidation() || {};\r\n\t},\r\n\tgetType(name) {\r\n\t\tlet property = this.getProperty(name);\r\n\t\treturn property && property.getType() || {};\r\n\t},\r\n\tgetLabel(name){\r\n\t\tlet property = this.getProperty(name);\r\n\t\treturn property && property.getLabel() || '';\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport ModelSchema from './model-schema.js';\r\n\r\nconst store = {\r\n\tschemas: {},\r\n\tgetStoreName(arg){\r\n\t\tif(_.isString(arg) && arg !== '') {\r\n\t\t\treturn arg;\r\n\t\t}\r\n\r\n\t\tif (_.isFunction(arg)) {\r\n\t\t\tlet store = this.getStoreByCtor(arg);\r\n\t\t\tif (store) {\r\n\t\t\t\treturn store.name;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn _.uniqueId('modelSchema');\t\t\r\n\t},\r\n\tgetStoreByCtor(ctor){\r\n\t\treturn _.find(this.schemas, f => f.ctor === ctor);\t\t\r\n\t},\r\n\tisNotInitialized(arg){\r\n\t\treturn !this.getStore(arg);\r\n\t},\r\n\tinitialize(name, schema = {}) {\r\n\t\tif (!this.isNotInitialized(name)) {\r\n\t\t\tthrow new Error('Schema already initialized');\r\n\t\t}\r\n\t\tlet ctor = _.isFunction(name) && name || undefined;\r\n\t\tname = this.getStoreName(name);\r\n\r\n\t\tif(name in this.schemas) { return; }\r\n\r\n\t\tif(!(schema instanceof ModelSchema) && _.isObject(schema)){\r\n\t\t\tschema = new ModelSchema(schema);\r\n\t\t} else {\r\n\t\t\tschema = new ModelSchema({});\r\n\t\t}\r\n\t\tthis.schemas[name] = {\r\n\t\t\tname, ctor, schema\r\n\t\t};\r\n\t\treturn schema;\r\n\t},\r\n\tgetStore(arg){\r\n\t\tif (_.isString(arg)) {\r\n\t\t\treturn this.schemas[arg];\r\n\t\t} else if (_.isFunction(arg)) {\r\n\t\t\treturn this.getStoreByCtor(arg);\r\n\t\t}\r\n\t},\r\n\tget(arg) {\r\n\t\tlet cache = this.getStore(arg);\r\n\t\treturn cache && cache.schema || undefined;\r\n\t}\r\n};\r\n\r\n\r\nexport default store;\r\n","import { View, CollectionView } from 'backbone.marionette';\r\nimport { mix } from 'bbmn-utils';\r\nimport { cssClassModifiersMixin, customsMixin, nextCollectionViewMixin, emptyFetchMixin, improvedIndexesMixin } from 'bbmn-mixins';\r\n\r\nconst ExtView = mix(View).with(cssClassModifiersMixin);\r\nconst ExtCollectionVIew = mix(CollectionView).with(customsMixin, nextCollectionViewMixin, emptyFetchMixin, improvedIndexesMixin);\r\nexport {\r\n\tExtView as View,\r\n\tExtCollectionVIew as CollectionView\r\n};\r\n","import _ from 'underscore';\r\nimport { isEmptyValue as isEmpty } from 'bbmn-utils';\r\n\r\nconst rules = [\r\n\t{\r\n\t\tname: 'required',\r\n\t\tmessage: 'required',\r\n\t\tvalidate: (value) => {\r\n\t\t\tif (isEmpty(value)) {\r\n\t\t\t\treturn 'required';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: 'email',\r\n\t\tmessage: 'not a email',\r\n\t\tvalidate: (value) => {\r\n\t\t\t\r\n\t\t\tif(isEmpty(value)) { return; }\r\n\r\n\t\t\tif (!_.isString(value)) {\r\n\t\t\t\treturn 'type:mismatch';\r\n\t\t\t}\r\n\r\n\t\t\tlet chunks = value.split('@');\r\n\t\t\tlet left = chunks[0];\r\n\t\t\tlet right = chunks[1];\r\n\t\t\r\n\t\t\tif(\r\n\t\t\t\tchunks.length != 2\r\n\t\t\t\t|| !/^[a-z0-9\\-_.+]+$/gmi.test(left)\r\n\t\t\t\t|| !/^[a-z0-9\\-_]+\\.[a-z0-9\\-_]+(\\.[a-z0-9\\-_]+)*$/gmi.test(right)\r\n\t\t\t) {\r\n\t\t\t\treturn 'pattern:mismatch';\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'valueIn',\r\n\t\tmessage: 'given value is not one of allowed values',\r\n\t\tvalidate: (value, { valueIn } = {}) => {\r\n\t\t\tif(_.isArray(valueIn) && valueIn.indexOf(value) === -1) {\r\n\t\t\t\treturn 'value:not:in';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'valueNotIn',\r\n\t\tmessage: 'given value is one of forbiden values',\r\n\t\tvalidate: (value, { valueNotIn } = {}) => {\r\n\t\t\tif(_.isArray(valueNotIn) && valueNotIn.indexOf(value) > -1) {\r\n\t\t\t\treturn 'value:in';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'shouldBeEqual',\r\n\t\tmessage: 'given value is not equal',\r\n\t\tvalidate: (value, { shouldBeEqual, allValues } = {}) => {\r\n\t\t\t\r\n\t\t\tlet compare = _.isFunction(shouldBeEqual) \r\n\t\t\t\t? shouldBeEqual(allValues) \r\n\t\t\t\t: shouldBeEqual;\r\n\r\n\t\t\tif (value !== compare) {\r\n\t\t\t\treturn 'value:not:equal';\r\n\t\t\t}\r\n\t\t}\r\n\t},\t\r\n\t{\r\n\t\tname:'shouldNotBeEqual',\r\n\t\tmessage: 'given value is forbiden',\r\n\t\tvalidate: (value, { shouldNotBeEqual, allValues } = {}) => {\r\n\r\n\t\t\tlet compare = _.isFunction(shouldNotBeEqual) \r\n\t\t\t\t? shouldNotBeEqual(allValues) \r\n\t\t\t\t: shouldNotBeEqual;\r\n\r\n\t\t\tif (value !== compare) {\r\n\t\t\t\treturn 'value:equal';\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif(_.isFunction(shouldNotBeEqual)) {\r\n\t\t\t\treturn value !== shouldNotBeEqual(allValues);\r\n\t\t\t} else {\r\n\t\t\t\treturn value !== shouldNotBeEqual;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'minLength',\r\n\t\tmessage: ({ ruleValue } = {}) => 'length is less than ' + ruleValue,\r\n\t\tvalidate: (value, { minLength } = {}) => {\r\n\t\t\tif (_.isNumber(minLength) && (value || '').toString().length < minLength) {\r\n\t\t\t\treturn 'min:length';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'maxLength',\r\n\t\tmessage: ({ ruleValue } = {}) => 'length is greater than ' + ruleValue,\r\n\t\tvalidate: (value, { maxLength } = {}) => {\r\n\t\t\tif (_.isNumber(maxLength) && (value || '').toString().length > maxLength) {\r\n\t\t\t\treturn 'max:length';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'minValue',\r\n\t\tmessage: ({ ruleValue } = {}) => 'value is less than ' + ruleValue,\r\n\t\tvalidate: (value, { minValue } = {}) => {\r\n\t\t\tif (_.isNumber(minValue)) {\r\n\t\t\t\tlet numValue = parseFloat(value, 10);\r\n\t\t\t\tif (isEmpty(numValue) || numValue < minValue) {\r\n\t\t\t\t\treturn 'min:value';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'maxValue',\r\n\t\tmessage: ({ ruleValue } = {}) => 'value is greater than ' + ruleValue,\r\n\t\tvalidate: (value, { maxValue } = {}) => {\r\n\t\t\tif (_.isNumber(maxValue)) {\r\n\t\t\t\tlet numValue = parseFloat(value, 10);\r\n\t\t\t\tif (isEmpty(numValue) || numValue > maxValue) {\r\n\t\t\t\t\treturn 'max:value';\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname:'pattern',\r\n\t\tmessage: 'value is not in pattern',\r\n\t\tvalidate: (value, { pattern } = {}) => {\r\n\t\t\tvalue = (value || '').toString();\r\n\r\n\t\t\tif(_.isString(pattern) && !isEmpty(pattern)) {\r\n\t\t\t\tpattern = new RegExp(pattern);\r\n\t\t\t}\r\n\t\t\tif(!_.isRegExp(pattern)) { return; }\r\n\r\n\t\t\tif (!pattern.test(value)) {\r\n\t\t\t\treturn 'pattern';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: 'validate',\r\n\t\tvalidate: (value, options = {}) => {\r\n\t\t\tlet { ruleValue } = options;\r\n\t\t\tif(!_.isFunction(ruleValue)) return;\r\n\t\t\treturn ruleValue(value, options);\r\n\t\t},\r\n\t},\t\r\n];\r\n\r\nreIndex(false);\r\n\r\nexport function reIndex(sortBefore = true) {\r\n\tif (sortBefore) {\r\n\t\trules.sort((a,b) => a.index - b.index);\r\n\t}\r\n\t_.each(rules, (rule, index) => {\r\n\t\trule.index = index;\r\n\t});\r\n}\r\n\r\nexport default rules;\r\n","import _ from 'underscore';\r\nimport rules from './rules.js';\r\nimport { isEmptyValue } from 'bbmn-utils';\r\n\r\nfunction normalizeValidationContext(context){\r\n\tif (context === 'required') {\r\n\t\treturn { required: true };\r\n\t} else if(_.isFunction(context)) {\r\n\t\treturn { validate: context };\r\n\t} else if(_.isObject(context)) {\r\n\t\treturn context;\r\n\t}\r\n}\r\n\r\nfunction getRuleContexts(rule = {}){\r\n\tlet founded = _.reduce(rule, (taken, ruleValue, name) => {\r\n\t\tlet found = _.findWhere(rules, { name });\r\n\t\tif(!found) return taken;\r\n\r\n\t\tlet message = rule[name + 'Message'];\r\n\t\ttaken.push({\r\n\t\t\trule: found,\r\n\t\t\truleValue,\r\n\t\t\tmessage,\r\n\t\t\tindex: found.index\r\n\t\t});\r\n\r\n\t\treturn taken;\r\n\r\n\t}, []);\r\n\tfounded.sort((a,b) => a.index - b.index);\r\n\treturn founded;\r\n}\r\n\r\nfunction check(value, ruleContext = {}) {\r\n\t\r\n\tlet { rule = {}, ruleValue, allValues, errors = [] } = ruleContext;\r\n\tif (rule.skipIfInvalid && errors.length) {\r\n\t\treturn Promise.reject();\r\n\t}\r\n\tlet message = ruleContext.message || rule.message;\r\n\tlet buildMessage = _.isFunction(message) ? message : ({ error } = {}) => isEmptyValue(message) ? error : message;\r\n\r\n\tlet validate = rule.validate;\r\n\tlet validateOptions = {\r\n\t\truleName: rule.name,\r\n\t\truleValue,\r\n\t\t[rule.name]: ruleValue,\r\n\t\tallValues,\r\n\t\tmessage: buildMessage({ value, allValues, ruleValue }),\r\n\t\terrors,\r\n\t};\r\n\tif (!_.isFunction(validate)) return Promise.resolve(value);\r\n\r\n\t\r\n\tlet result = validate(value, validateOptions);\r\n\r\n\tif (!result) {\r\n\t\treturn Promise.resolve(value);\r\n\t} else if(result && _.isFunction(result.then)) {\r\n\t\treturn result.then(\r\n\t\t\t() => Promise.resolve(value),\r\n\t\t\t(error) => Promise.reject(buildMessage({ error, value, allValues, ruleValue }))\r\n\t\t);\r\n\t} else {\r\n\t\treturn Promise.reject(buildMessage({ error: result, value, allValues, ruleValue }));\r\n\t}\r\n}\r\n\r\n\r\n\r\nexport default function validate(value, rule, { allValues = {} } = {}){\r\n\trule = normalizeValidationContext(rule);\r\n\tlet contexts = getRuleContexts(rule);\r\n\t\r\n\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet errors = [];\r\n\r\n\t\tlet rulesPromise = _.reduce(contexts, (promise, ruleContext) => {\r\n\r\n\t\t\tpromise = promise.then(() => {\r\n\t\t\t\treturn check(value, _.extend({}, ruleContext, { allValues, errors }));\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tif(error != null)\r\n\t\t\t\t\terrors.push(error);\r\n\t\t\t});\r\n\r\n\t\t\treturn promise;\r\n\r\n\t\t}, Promise.resolve(value));\r\n\r\n\t\trulesPromise.then(() => {\r\n\t\t\tif(errors.length){\r\n\t\t\t\treject(errors);\r\n\t\t\t} else {\r\n\t\t\t\tresolve(value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\n\r\n\r\n","import _ from 'underscore';\r\n\r\nimport rules, { reIndex } from './rules.js';\r\n\r\nimport { isEmptyValue } from 'bbmn-utils';\r\n\r\nimport validate from './validate.js';\r\n\r\nfunction removeRule(name){\r\n\tlet found = _.findIndex(rules, { name });\r\n\tif (found === -1) return;\r\n\tlet removed = rules.splice(found, 1);\r\n\treIndex();\r\n\treturn removed;\r\n}\r\n\r\nfunction setRule(rule){\r\n\tif (rule.index == null) {\r\n\t\trule.index = rules.length;\r\n\t}\r\n\trules.push(rule);\r\n\treIndex();\r\n\treturn rule;\r\n}\r\n\r\nexport default {\r\n\tsetRule(name, rule = {}){\r\n\t\tif(_.isObject(name)) {\r\n\t\t\trule = name;\r\n\t\t\tname = rule.name;\r\n\t\t}\r\n\r\n\t\tif(isEmptyValue(name)) {\r\n\t\t\tthrow new Error('rule name not specified');\r\n\t\t}\r\n\r\n\t\tif(rule == null){\r\n\t\t\treturn removeRule(name);\r\n\t\t} else if (!_.isObject(rule)) {\r\n\t\t\tthrow new Error('validation rule must be an object');\r\n\t\t} else {\r\n\t\t\tif (rule.name != name) {\r\n\t\t\t\trule.name = name;\r\n\t\t\t}\r\n\t\t\treturn setRule(rule);\r\n\t\t}\r\n\t},\r\n\tremoveRule(name) {\r\n\t\treturn removeRule(name);\r\n\t},\r\n\tgetRule(name){\r\n\t\treturn _.findWhere(rules, { name });\r\n\t},\r\n\tsetMessage(name, message){\r\n\t\tif(!_.isString(name) || isEmptyValue(name)) {\r\n\t\t\tthrow new Error('name must be not empty string');\r\n\t\t}\r\n\t\tif(!(_.isString(message) || _.isFunction(message))) {\r\n\t\t\tthrow new Error('message must be not empty string or a function returning a string');\r\n\t\t}\r\n\t\tlet rule = _.findWhere(rules, { name });\r\n\t\tif (!rule) { return; }\r\n\t\trule.message = message;\r\n\t},\r\n\tsetMessages(hash = {}){\r\n\t\t_.each(hash, (message, name) => this.setMessage(name, message));\r\n\t},\r\n\tvalidate,\r\n\t_rules: rules,\r\n};\r\n","import { Model } from 'bbmn-core';\r\nimport _ from 'underscore';\r\n\r\n/*\r\nBy default expects token on initialize\r\nnew User({...}, { token });\r\nyou can use bbmn-components bearer-token for that\r\nor something else\r\nbut token should have this defined properties:\r\n\ttoken.ready - promise\r\n\ttoken.hasToken() - should return true or flase\r\n\ttoken.update() - invokes on user change event, should receive refreshed token\r\n\r\n*/\r\nexport default Model.extend({\r\n\t\r\n\tshouldRequestOnInitialize: true,\r\n\r\n\tconstructor(hash, opts){\r\n\t\tthis._waitFor = [];\r\n\t\tthis.initializeToken(opts);\r\n\t\tModel.apply(this, arguments);\r\n\r\n\t\tif (this.shouldRequestOnInitialize) {\r\n\t\t\tthis.getReady();\r\n\t\t}\r\n\t},\r\n\tinitializeToken(opts = {}){\r\n\t\tlet { token } = opts;\r\n\t\tif (!token) return;\r\n\t\tthis.listenTo(token, 'changed', this.refresh);\r\n\t\tthis.token = token;\r\n\t\ttoken.ready && this._waitFor.push(token.ready);\r\n\t},\r\n\tgetReady(){\r\n\t\tif(this.ready) return this.ready;\r\n\t\t\r\n\r\n\t\tthis.ready = new Promise((resolve) => {\r\n\t\t\tthis.once('changed', () => resolve());\r\n\t\t\tPromise.all(this._waitFor).then(\r\n\t\t\t\t() => this.refresh(),\r\n\t\t\t\t() => this.reflectChanges({ clear: true })\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\treturn this.ready;\r\n\t},\r\n\tlogoff(){\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tthis.once('changed', () => resolve());\r\n\t\t\tif (this.token) {\r\n\t\t\t\tthis.token.update();\r\n\t\t\t} else {\r\n\t\t\t\tthis.reflectChanges({ clear: true });\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t//override this for getting auth status\r\n\tisLogged(){\r\n\t\treturn this.get('authenticated') === true;\r\n\t},\r\n\trefresh(){\r\n\t\tif(!this.token.hasToken()){\r\n\t\t\tthis.reflectChanges({ clear: true });\r\n\t\t\treturn Promise.resolve();\r\n\t\t} else {\r\n\t\t\treturn this.fetch().then(() => {\r\n\t\t\t\tthis.reflectChanges();\r\n\t\t\t}, () => {\t\t\t\t\r\n\t\t\t\tthis.reflectChanges({ store: false });\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\treflectChanges(opts = {}){\r\n\t\tlet { silent, clear, store = true } = opts;\r\n\t\tclear && this.clear();\r\n\t\tstore && this.store(clear);\r\n\t\t!silent && this.trigger('changed',this);\r\n\t},\r\n\tisMe(arg){\r\n\t\tlet me = this.get(this.idAttribute);\r\n\t\treturn _.isEqual(me, arg);\r\n\t},\r\n\t// implement by your own\r\n\tstore(){},\r\n});\r\n","import _ from 'underscore';\r\n\r\nimport { Model, ajax as _nativeAjax } from 'bbmn-core';\r\nimport Backbone from 'backbone';\r\n\r\nlet nativeAjax = _nativeAjax;\r\n\r\nconst tokenizedAjax = function(...args){\r\n\tlet options;\r\n\r\n\tif(args && args.length == 1 && _.isObject(args[0])){\r\n\t\toptions = args[0];\r\n\t}\r\n\tif(args && args.length == 2 && !_.isObject(args[0]) && _.isObject(args[1])){\r\n\t\toptions = args[1];\r\n\t}\r\n\r\n\toptions && (options.headers = _.extend({}, options.headers, this.getAjaxHeaders()));\r\n\r\n\treturn nativeAjax.apply(null, args);\r\n};\r\n\r\n\r\nconst Token = Model.extend({\r\n\r\n\ttokenAttribute: 'access_token',\r\n\trefreshTokenAttribute: 'refresh_token',\r\n\tendPoint: 'auth/token',\r\n\tsecondsOffset: 0,\r\n\r\n\tshouldRequestOnInitialize: true,\r\n\r\n\tconstructor(){\r\n\t\tthis.ajaxHeaders = {};\r\n\t\tthis.flows = {};\r\n\t\tthis.initializeFlows();\r\n\t\tthis.setExpiration(null);\r\n\r\n\t\tModel.apply(this, arguments);\r\n\r\n\t\tif (this.shouldRequestOnInitialize) {\r\n\t\t\tthis.getReady();\r\n\t\t}\r\n\t},\r\n\r\n\tgetReady(){\r\n\t\tif(this.ready) return this.ready;\r\n\t\t\r\n\t\tif (!this.hasToken()) {\r\n\t\t\tthis.ready = Promise.resolve();\r\n\t\t} else {\r\n\t\t\tthis.ready = this.refresh({force: true}).catch(() => {\r\n\t\t\t\tthis.update(null);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.ready;\r\n\t},\r\n\t\r\n\r\n\tinitializeFlows(){\r\n\r\n\t\tthis.setFlow('password', {\r\n\t\t\turl: this.endPoint,\r\n\t\t\tmethod: 'POST'\r\n\t\t});\r\n\t\tthis.setFlow('refresh', {\r\n\t\t\turl: this.endPoint,\r\n\t\t\tmethod: 'POST'\r\n\t\t});\r\n\r\n\t},\r\n\tgetFlow(key){\r\n\t\treturn _.clone(this.flows[key] || {});\r\n\t},\r\n\tsetFlow(key, value){\r\n\t\tthis.flows[key] = value;\r\n\t},\r\n\r\n\r\n\r\n\thasToken(){\r\n\t\treturn this.getToken() != null;\r\n\t},\r\n\tgetToken(){\r\n\t\treturn this.get(this.tokenAttribute);\r\n\t},\r\n\r\n\tgetRefreshToken(){\r\n\t\treturn this.get(this.refreshTokenAttribute);\r\n\t},\r\n\r\n\tgetAjaxHeaders(){\t\t\r\n\t\treturn this.ajaxHeaders;\r\n\t},\t\r\n\r\n\tparse(data){\r\n\t\treturn data;\r\n\t},\r\n\r\n\tfetch(options = {}){\r\n\t\tif(this._fetching) return this._fetching;\t\t\r\n\t\tthis._fetching = nativeAjax(options).then(\r\n\t\t\t(json) => {\r\n\r\n\t\t\t\tlet parsed = this.parse(_.clone(json));\r\n\t\t\t\tthis.update(parsed);\r\n\t\t\t\tdelete this._fetching;\r\n\t\t\t\treturn Promise.resolve(json);\r\n\t\t\t}, \r\n\t\t\t(xhr) => {\r\n\t\t\t\t\r\n\t\t\t\tdelete this._fetching;\r\n\t\t\t\t\r\n\t\t\t\toptions.clearOnFail !== false \r\n\t\t\t\t\t&& this.update(null);\r\n\r\n\t\t\t\tlet error = this.handleError(xhr);\r\n\t\t\t\tif(error){\r\n\r\n\t\t\t\t\treturn Promise.reject(error);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Promise.reject(xhr);\r\n\t\t\t\t}\r\n\t\t\t});\t\r\n\t\treturn this._fetching;\r\n\t},\r\n\thandleError(){},\r\n\tupdate(hash, opts = {}){\r\n\t\tlet { silent } = opts;\r\n\t\tif (hash == null) {\r\n\r\n\t\t\tthis.clear(opts);\r\n\r\n\t\t} else {\r\n\t\t\tlet fullhash = _.extend({}, this.attributes, hash);\r\n\t\t\tlet unset = [];\r\n\t\t\tlet shouldUnset = !!opts.unset;\r\n\t\t\tlet setHash = _(fullhash).reduce((memo, value, key) => {\r\n\t\t\t\tif (key in hash) {\r\n\t\t\t\t\tmemo[key] = value;\r\n\t\t\t\t} else if (shouldUnset) {\r\n\t\t\t\t\tunset.push(key);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmemo[key] = undefined;\r\n\t\t\t\t}\r\n\t\t\t\treturn memo;\r\n\t\t\t}, {});\r\n\r\n\t\t\tsetHash = this.parse(setHash);\r\n\t\t\tthis.set(setHash, { silent });\r\n\t\t\t_(unset).each(key => this.unset(key, { silent }));\r\n\t\t}\r\n\r\n\t\tthis.reflectTokenChanges();\r\n\r\n\t},\r\n\r\n\treplaceBackboneAjax(){\t\t\r\n\t\tif(!this.hasToken())\r\n\t\t\tBackbone.ajax = nativeAjax;\r\n\t\telse\r\n\t\t\tBackbone.ajax = (...args) => this.ajax(...args);\r\n\t},\r\n\tupdateAjaxHeaders(token){\r\n\t\ttoken || (token = this.getToken());\r\n\t\tlet headers = this.getAjaxHeaders();\r\n\t\tif (token) {\r\n\t\t\theaders.Authorization = 'Bearer ' + token;\r\n\t\t\theaders.Accept = 'application/json';\r\n\t\t} else {\r\n\t\t\tdelete headers.Authorization;\r\n\t\t}\r\n\t},\r\n\r\n\t//implement by your own\r\n\tstoreToken(){},\r\n\r\n\treflectTokenChanges(opts = {}){\r\n\t\tlet { silent, store = true } = opts;\r\n\t\tthis.updateAjaxHeaders();\r\n\t\tthis.replaceBackboneAjax();\r\n\t\tif (store)\r\n\t\t\tthis.storeToken();\r\n\t\tif (!silent)\r\n\t\t\tthis.trigger('changed');\r\n\t},\r\n\r\n\tajax(...args){\r\n\t\treturn this.refresh().then(\r\n\t\t\t() => tokenizedAjax.apply(this, args),\r\n\t\t\terror => Promise.reject(error)\r\n\t\t);\r\n\t},\t\r\n\trefresh(opts = {}){\t\t\r\n\r\n\t\t// if token is fresh enough and there is no force refresh\r\n\t\t// pass\r\n\t\tif (!this.isExpired() && !opts.force) {\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t\tlet options = this.getFlow('refresh');\r\n\t\toptions.data = this.getRefreshTokenData();\r\n\t\treturn this.fetch(options);\r\n\t},\r\n\tgetRefreshTokenData(){\r\n\t\treturn {\r\n\t\t\t'grant_type':'refresh_token',\r\n\t\t\t'refresh_token': this.getRefreshToken(),\r\n\t\t};\r\n\t},\r\n\r\n\tsetExpiration(arg){\r\n\r\n\t\tif (arg === null) {\r\n\t\t\tthis.expiresAt = null;\r\n\t\t}\r\n\r\n\t\tlet date;\r\n\t\tlet now = new Date();\r\n\r\n\t\tif (_.isDate(arg)) {\r\n\t\t\tdate = arg;\r\n\t\t} else if(_.isObject(arg)) {\r\n\t\t\tdate = new Date();\r\n\t\t\t\r\n\t\t\tlet { seconds, minutes, hours, days } = arg;\r\n\t\t\tdate.setDate(date.getDate() + (days || 0));\r\n\t\t\tdate.setHours(date.getHours() + (hours || 0));\r\n\t\t\tdate.setMinutes(date.getMinutes() + (minutes || 0));\r\n\t\t\tdate.setSeconds(date.getSeconds() + (seconds || 0));\r\n\t\t}\r\n\r\n\t\tif(!_.isDate(date) || isNaN(date.valueOf()) || date < now) {\r\n\t\t\tdate = new Date();\r\n\t\t\tdate.setSeconds(now.getSeconds() + 90);\r\n\t\t}\r\n\r\n\t\tthis.expiresAt = date;\r\n\t},\r\n\tgetExpiration(){\r\n\t\treturn this.expiresAt;\r\n\t},\r\n\tisExpired(){\r\n\t\tlet date = this.getExpiration();\r\n\t\tif(!_.isDate(date) || isNaN(date.valueOf()))\r\n\t\t\treturn true;\r\n\t\treturn date.valueOf() < Date.now() + (this.secondsOffset * 1000);\r\n\t},\r\n\tlogin(username, password){\r\n\r\n\t\tlet options = this.getFlow('password');\r\n\t\toptions.data = { grant_type:'password', username, password };\r\n\t\toptions.clearOnFail = false;\r\n\t\treturn this.fetch(options);\r\n\r\n\t},\r\n\r\n});\r\n\r\nToken.setNativeAjax = function(arg){\r\n\tlet old = nativeAjax;\r\n\tnativeAjax = arg;\r\n\treturn old;\r\n};\r\n\r\nexport default Token;\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\n\r\nimport { Events, BaseClass } from 'bbmn-core';\r\nimport { triggerMethod, getOption, mergeOptions, mix } from 'bbmn-utils';\r\n\r\nconst Stack = mix(BaseClass).with(Events).extend({\r\n\r\n\tdestroyOnRemove: true,\r\n\tremoveOnOutsideClick: true,\r\n\tremoveOnEsc: true,\r\n\tclearBeforeAdd: false,\r\n\r\n\tconstructor(options){\r\n\t\tthis.cid = _.uniqueId('stack');\r\n\t\tthis.unremovableKey = `_${this.cid}_preventRemove`;\r\n\t\tthis.options = options;\r\n\t\tthis.stack = [];\r\n\t\tBaseClass.apply(this, arguments);\t\t\t\r\n\t},\r\n\r\n\r\n\r\n\r\n\tadd(view, options){\r\n\t\tif(!_.isObject(view)) { return; }\r\n\t\tif (this.getOption('clearBeforeAdd')) {\r\n\t\t\tthis.removeAll();\r\n\t\t}\r\n\t\tthis.triggerMethod('before:add');\r\n\r\n\t\tthis.stack.push(view);\r\n\t\tthis._setupView(view, options);\r\n\r\n\t\tthis._stackChanged(1, view);\r\n\r\n\t},\r\n\t_setupView(view, { preventRemove } = {}){\r\n\t\tif (preventRemove) {\r\n\t\t\tlet key = this.getUnremovableKey();\r\n\t\t\tview[key] = true;\r\n\t\t}\r\n\t\tthis.listenToOnce(view, 'destroy', () => this._removeView(view, { selfDestroy: true }));\t\t\r\n\t},\t\r\n\r\n\tgetLast(){\r\n\t\treturn _.last(this.stack);\r\n\t},\r\n\r\n\r\n\tremoveLast(){\r\n\t\tlet view = this.getLast();\r\n\t\tthis.remove(view);\r\n\t},\r\n\tdestroyLast(){\r\n\t\tlet view = this.getLast();\r\n\t\tthis.remove(view, { destroy: true });\r\n\t},\r\n\tremove(view, { destroy } = {}){\r\n\t\tlet destroyOnRemove = this.getOption('destroyOnRemove');\r\n\t\tlet removed = this._removeView(view);\r\n\t\tif (removed && (destroy || destroyOnRemove)) {\r\n\t\t\tthis._destroyView(view);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeView(view, { selfDestroy } = {}){\r\n\t\tif (!_.isObject(view)) { return; }\r\n\r\n\t\tif (this.isViewUnremovable(view, selfDestroy)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._cleanUpView(view);\r\n\r\n\t\tlet index = this.stack.indexOf(view);\r\n\t\tif (index === -1) return;\r\n\r\n\t\tif (index == this.stack.length - 1)\r\n\t\t\tthis.stack.pop();\r\n\t\telse\r\n\t\t\tthis.stack.splice(index, 1);\r\n\t\t\t\r\n\t\tthis._stackChanged(-1);\r\n\r\n\t\treturn view;\r\n\t},\r\n\r\n\t_cleanUpView(view){\r\n\t\tthis.stopListening(view);\r\n\t\tdelete view[this.getUnremovableKey()];\r\n\t},\r\n\r\n\t_destroyView(view) {\r\n\t\tif (_.isObject(view) && _.isFunction(view.destroy)) { \r\n\t\t\tview.destroy();\r\n\t\t}\r\n\t},\r\n\r\n\t_stackChanged(change, view){\r\n\t\tif (change > 0) {\r\n\t\t\tthis._setDocumentListeners();\t\t\t\r\n\t\t\tthis.triggerMethod('add', view);\r\n\t\t} else {\r\n\t\t\tthis._unsetDocumentListeners();\t\t\t\r\n\t\t\tthis.triggerMethod('remove', view);\r\n\t\t}\r\n\r\n\t},\r\n\r\n\r\n\t/*\r\n\t\tUnremovable view methods\r\n\t\tsometimes you want to prevent view to be removed from the stack\t\t\r\n\t*/\r\n\tgetUnremovableKey(){\r\n\t\treturn this.getOption('unremovableKey');\r\n\t},\r\n\t// options is for internal use only.\r\n\t// self destroy flag filled when a view destroyed outside the stack\r\n\tisViewUnremovable(view, { selfDestroy } = {}){\r\n\t\tif (selfDestroy) return false;\r\n\t\tlet key = this.getUnremovableKey();\r\n\t\treturn view[key];\r\n\t},\t\t\r\n\r\n\t/*\r\n\t\tDOM listeners logic\r\n\t\t- esc handler\r\n\t\t- outside click handler\r\n\t*/\r\n\tgetViewDomElement(view){\r\n\t\treturn view && view.el;\r\n\t},\r\n\tisElementOutsideOfView(eventElement, view){\r\n\t\tlet viewElement = this.getViewDomElement(view);\r\n\t\tif (!viewElement) return;\r\n\t\treturn !$.contains(viewElement, eventElement);\r\n\t},\r\n\tgetViewIfElementOutside(eventElement){\r\n\t\tlet view = this.getLast();\r\n\t\tif (!view) return;\r\n\t\tif(this.isElementOutsideOfView(eventElement, view)) {\r\n\t\t\treturn view;\r\n\t\t}\r\n\t},\r\n\toutsideClickHandler(event){\r\n\t\tif (!this.stack.length) { return; }\r\n\r\n\t\tlet view = this.getViewIfElementOutside(event.target);\r\n\t\tif (!view) { return; }\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\t\tthis.remove(view);\r\n\r\n\t},\r\n\tescapePressHandler(event){\r\n\t\tif (!this.stack.length || event.keyCode !== 27 ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\t\tthis.removeLast();\r\n\r\n\t},\r\n\r\n\t_setDocumentListeners(){\r\n\t\tif (this._documentListeners || !this.stack.length) return;\r\n\t\tlet $doc = this.getDocument();\r\n\t\tif (this._shouldRemoveOnEsc()) {\t\t\t\r\n\t\t\tthis._escapePressHandler = _.bind(this.escapePressHandler, this);\r\n\t\t\t$doc.on('keyup', this._escapePressHandler);\r\n\t\t\tthis.triggerMethod('dom:listeners:escape:on');\r\n\t\t}\r\n\t\tif (this._shouldRemoveOnOutsideClick()) {\r\n\t\t\tthis._outsideClickHandler = _.bind(this.outsideClickHandler, this);\r\n\t\t\t$doc.on('click', this._outsideClickHandler);\r\n\t\t\tthis.triggerMethod('dom:listeners:click:on');\r\n\t\t}\r\n\t\tthis.triggerMethod('dom:listeners:on');\r\n\t\tthis._documentListeners = true;\r\n\t},\r\n\t_unsetDocumentListeners(){\r\n\t\tif (!(this._documentListeners && !this.stack.length)) return;\r\n\t\tlet $doc = this.getDocument();\r\n\t\tif (this._escapePressHandler) {\r\n\t\t\t$doc.off('keyup', this._escapePressHandler);\r\n\t\t\tdelete this._escapePressHandler;\r\n\t\t\tthis.triggerMethod('dom:listeners:escape:off');\r\n\t\t}\r\n\t\tif(this._outsideClickHandler) {\r\n\t\t\t$doc.off('click', this._outsideClickHandler);\r\n\t\t\tdelete this._outsideClickHandler;\r\n\t\t\tthis.triggerMethod('dom:listeners:click:off');\r\n\t\t}\r\n\t\tthis.triggerMethod('dom:listeners:off');\r\n\t\tthis._documentListeners = false;\r\n\t},\r\n\t_shouldRemoveOnEsc(){\r\n\t\treturn this.getOption('removeOnEsc') === true;\r\n\t},\r\n\t_shouldRemoveOnOutsideClick(){\r\n\t\treturn this.getOption('removeOnOutsideClick') === true;\r\n\t},\r\n\r\n\r\n\t/* helpers */\r\n\r\n\tmergeOptions,\r\n\ttriggerMethod,\r\n\tgetOption() { return getOption(this, ...arguments); },\r\n\r\n\tgetDocument(){\r\n\t\treturn this.$doc || $(document);\r\n\t},\r\n\tisDestroyed(){\r\n\t\treturn this._isDestroyed || this._isDestroying;\r\n\t},\r\n\tremoveAll(){\r\n\t\twhile(this.stack.length){\r\n\t\t\tthis.destroyLast();\r\n\t\t}\r\n\t},\r\n\tdestroy(){\r\n\t\tif(this._isDestroyed || this._isDestroying) { return; }\t\t\r\n\t\tthis._isDestroying = true;\r\n\r\n\t\tthis.triggerMethod('before:destroy');\r\n\r\n\t\tthis.removeAll();\r\n\r\n\t\tlet $doc = this.getDocument();\r\n\t\t$doc.off('keyup', this._onKeyUp);\r\n\t\t$doc.off('click', this._outsideClick);\r\n\r\n\t\tthis._isDestroyed = true;\r\n\t\tthis.triggerMethod('destroy');\r\n\t},\r\n\r\n\r\n});\r\n\r\nexport default Stack;\r\n"],"names":["isPromisable","arg","Promise","_","isFunction","then","asArray","isArray","race","promises","valueToPromise","result","resolve","reject","registerProcess","Process","context","name","opts","process","extend","concurrent","concurrencyCheck","run","BaseClass","apply","arguments","_initDefaults","_initCancelation","_mergeOptions","Error","isObject","cid","uniqueId","errors","cancelPromise","cancel","options","omit","each","value","key","previous","getProcessFromContext","promise","updateProcessInContext","args","_createLifeCyclePromise","_notCanceled","_begin","_beforeStart","_canBeStarted","_waitOtherPromises","triggerComplete","catch","triggerError","error","jsError","getJsError","_cancelationRace","_getHookResultAsPromise","contextMethod","invokeOnContext","all","hookName","procMethod","camelCase","procHook","undefined","cntxHook","triggerOnContext","onComplete","triggerEnd","push","onError","filter","f","getContextProcessKey","eventName","trigger","event","triggerMethodOn","methodName","method","register","defaultStartableOptions","contextState","keyValue","storeState","ensureState","processingName","processedName","restoreState","shouldThrow","other","status","defaultStartOptions","defaultStopOptions","Base","_initializeStartable","_startableInitialized","startable","getOption","start","stop","isNotIddle","isStarted","StartableMixin","BaseApp","mix","with","Events","startableMixin","clone","_startPromises","initialize","triggerMethod","map","item","call","callback","layoutView","layout","buildLayout","region","getRegion","show","buildViewByKey","_region","buildRegion","Region","isClass","_buildRegion","RegionClass","regionClass","newOptions","el","replaceElement","Schema","property","modelSchema","order","schema","hash","betterResult","default","unflat","flat","_getByKey","type","multiple","allValues","label","getDisplay","valueOptions","getType","editOptions","getLabel","allValue","compiled","properties","setProperties","PropertySchema","props","getProperties","size","createProperty","propertyName","isString","isEmptyValue","setProperty","toArray","sort","p1","p2","getPropertiesArray","pluck","create","_createProperty","_setProperty","getProperty","getValidation","store","getStoreByCtor","ctor","find","schemas","getStore","isNotInitialized","getStoreName","ModelSchema","cache","ExtView","View","cssClassModifiersMixin","ExtCollectionVIew","CollectionView","customsMixin","nextCollectionViewMixin","emptyFetchMixin","improvedIndexesMixin","rules","isEmpty","chunks","split","left","right","length","test","valueIn","indexOf","valueNotIn","shouldBeEqual","compare","shouldNotBeEqual","ruleValue","minLength","isNumber","toString","maxLength","minValue","numValue","parseFloat","maxValue","pattern","RegExp","isRegExp","reIndex","sortBefore","a","b","index","rule","normalizeValidationContext","required","validate","getRuleContexts","founded","reduce","taken","found","findWhere","message","check","ruleContext","skipIfInvalid","buildMessage","validateOptions","contexts","rulesPromise","removeRule","findIndex","removed","splice","setRule","setMessage","Model","_waitFor","initializeToken","shouldRequestOnInitialize","getReady","token","listenTo","refresh","ready","once","reflectChanges","clear","update","get","hasToken","fetch","silent","me","idAttribute","isEqual","nativeAjax","_nativeAjax","tokenizedAjax","headers","getAjaxHeaders","Token","ajaxHeaders","flows","initializeFlows","setExpiration","force","setFlow","endPoint","getToken","tokenAttribute","refreshTokenAttribute","data","_fetching","json","parsed","parse","xhr","clearOnFail","handleError","fullhash","attributes","unset","shouldUnset","setHash","memo","set","reflectTokenChanges","Backbone","ajax","Authorization","Accept","updateAjaxHeaders","replaceBackboneAjax","storeToken","isExpired","getFlow","getRefreshTokenData","getRefreshToken","expiresAt","date","now","Date","isDate","seconds","minutes","hours","days","setDate","getDate","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","isNaN","valueOf","getExpiration","secondsOffset","username","password","grant_type","setNativeAjax","old","Stack","unremovableKey","stack","view","removeAll","_setupView","_stackChanged","preventRemove","getUnremovableKey","listenToOnce","_removeView","selfDestroy","last","getLast","remove","destroy","destroyOnRemove","_destroyView","isViewUnremovable","_cleanUpView","pop","stopListening","change","_setDocumentListeners","_unsetDocumentListeners","eventElement","viewElement","getViewDomElement","$","contains","isElementOutsideOfView","getViewIfElementOutside","target","preventDefault","stopPropagation","keyCode","removeLast","_documentListeners","$doc","getDocument","_shouldRemoveOnEsc","_escapePressHandler","bind","escapePressHandler","on","_shouldRemoveOnOutsideClick","_outsideClickHandler","outsideClickHandler","off","document","_isDestroyed","_isDestroying","destroyLast","_onKeyUp","_outsideClick"],"mappings":"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"}